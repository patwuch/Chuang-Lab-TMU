<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>tn_dengue_cleaning – Chuang Lab TMU</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/tmu-logo.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-1328d16024fb3741a6a12ba29620befe.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Chuang Lab TMU</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../module1/docs/index.qmd"> 
<span class="menu-text">Module 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../module2/docs/index.qmd"> 
<span class="menu-text">Module 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../module3/docs/index.qmd"> 
<span class="menu-text">Module 3</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../module4/docs/index.qmd"> 
<span class="menu-text">Module 4</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<div id="cell-0" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">'''Import basic libraries'''</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Point</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Import dengue datafile</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>dengue <span class="op">=</span> pd.read_csv(<span class="st">"C:/Users/Patrick/Downloads/Dengue_Daily.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-1" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import basic libraries</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Point</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_project_root(current: Path, marker: <span class="bu">str</span> <span class="op">=</span> <span class="st">".git"</span>):</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> parent <span class="kw">in</span> current.resolve().parents:</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (parent <span class="op">/</span> marker).exists():</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> parent</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> current.resolve()  <span class="co"># fallback</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>PROJECT_ROOT <span class="op">=</span> find_project_root(Path.cwd())</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>RAW_DIR <span class="op">=</span> PROJECT_ROOT <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"raw"</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>INTERIM_DIR <span class="op">=</span> PROJECT_ROOT <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"interim"</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>PROCESSED_DIR <span class="op">=</span> PROJECT_ROOT <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"processed"</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in dengue data</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>dengue <span class="op">=</span> pd.read_csv(RAW_DIR <span class="op">/</span> <span class="st">"TW_DENGUE"</span> <span class="op">/</span> <span class="st">"Dengue_Daily.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Script to Clean Up Data</p>
<div id="cell-3" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking shape of dengue file</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dengue.shape)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Drop imported cases and reset index</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>dengue_local <span class="op">=</span> dengue[dengue[<span class="st">'是否境外移入'</span>]<span class="op">==</span><span class="st">'否'</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking shape of local dengue cases</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dengue_local.shape)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(107248, 26)
(102296, 26)</code></pre>
</div>
</div>
<div id="cell-4" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Directory containing the CSV files directly</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>base_dir <span class="op">=</span> RAW_DIR <span class="op">/</span> <span class="st">"TW_DENGUE"</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through files directly in the directory</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> file_path <span class="kw">in</span> base_dir.iterdir():</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> file_path.is_file() <span class="kw">and</span> file_path.suffix <span class="op">==</span> <span class="st">".csv"</span>:</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a variable name from the filename (remove extension, replace spaces/special chars with underscores)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        var_name <span class="op">=</span> file_path.stem.replace(<span class="st">" "</span>, <span class="st">"_"</span>).replace(<span class="st">"-"</span>, <span class="st">"_"</span>).replace(<span class="st">"（"</span>, <span class="st">""</span>).replace(<span class="st">"）"</span>, <span class="st">""</span>).replace(<span class="st">"("</span>, <span class="st">""</span>).replace(<span class="st">")"</span>, <span class="st">""</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> encoding <span class="kw">in</span> [<span class="st">"utf-8"</span>, <span class="st">"big5"</span>]:</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                <span class="bu">globals</span>()[var_name] <span class="op">=</span> pd.read_csv(file_path, encoding<span class="op">=</span>encoding)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"Loaded </span><span class="sc">{</span>file_path<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> into variable '</span><span class="sc">{</span>var_name<span class="sc">}</span><span class="ss">' using </span><span class="sc">{</span>encoding<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"Failed to read </span><span class="sc">{</span>file_path<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> with </span><span class="sc">{</span>encoding<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Failed to read BSA_AGE_TN_2015.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded BSA_AGE_TN_2015.csv into variable 'BSA_AGE_TN_2015' using big5.
Loaded BSA_AGE_TN_2023.csv into variable 'BSA_AGE_TN_2023' using utf-8.
Failed to read BSA_DEM_TN_2015.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded BSA_DEM_TN_2015.csv into variable 'BSA_DEM_TN_2015' using big5.
Loaded BSA_DEM_TN_2023.csv into variable 'BSA_DEM_TN_2023' using utf-8.
Failed to read BSA_POP_TN_2015.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded BSA_POP_TN_2015.csv into variable 'BSA_POP_TN_2015' using big5.
Loaded BSA_POP_TN_2023.csv into variable 'BSA_POP_TN_2023' using utf-8.
Loaded Dengue_Daily.csv into variable 'Dengue_Daily' using utf-8.
Loaded VIL_AGE_TN_2015.csv into variable 'VIL_AGE_TN_2015' using utf-8.
Loaded VIL_AGE_TN_2023.csv into variable 'VIL_AGE_TN_2023' using utf-8.
Loaded VIL_POP_TN_2015.csv into variable 'VIL_POP_TN_2015' using utf-8.
Loaded VIL_POP_TN_2023.csv into variable 'VIL_POP_TN_2023' using utf-8.</code></pre>
</div>
</div>
<div id="cell-5" class="cell" data-execution_count="124">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Tainan shapefile</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>tn_bsa_shp <span class="op">=</span> gpd.read_file(<span class="vs">r'D:</span><span class="er">\</span><span class="vs">Projects</span><span class="er">\</span><span class="vs">TMU</span><span class="er">\</span><span class="vs">gee_dengue</span><span class="dv">\d</span><span class="vs">ata</span><span class="er">\</span><span class="vs">external</span><span class="dv">\S</span><span class="vs">HP_TN'</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>tn_bsa_shp <span class="op">=</span> tn_bsa_shp.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>tn_bsa_shp.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'lightblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Visualization of tn_bsa_shp"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Longitude"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Latitude"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tn_dengue_cleaning_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-6" class="cell" data-execution_count="125">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Columns to merge</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>age_cols <span class="op">=</span> [<span class="st">'A0A9_CNT'</span>, <span class="st">'A0A9_M_CNT'</span>, <span class="st">'A0A9_F_CNT'</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">'A10A19_CNT'</span>, <span class="st">'A10A19_M_CNT'</span>, <span class="st">'A10A19_F_CNT'</span>, <span class="st">'A20A29_CNT'</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">'A20A29_M_CNT'</span>, <span class="st">'A20A29_F_CNT'</span>, <span class="st">'A30A39_CNT'</span>, <span class="st">'A30A39_M_CNT'</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">'A30A39_F_CNT'</span>, <span class="st">'A40A49_CNT'</span>, <span class="st">'A40A49_M_CNT'</span>, <span class="st">'A40A49_F_CNT'</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'A50A59_CNT'</span>, <span class="st">'A50A59_M_CNT'</span>, <span class="st">'A50A59_F_CNT'</span>, <span class="st">'A60A69_CNT'</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'A60A69_M_CNT'</span>, <span class="st">'A60A69_F_CNT'</span>, <span class="st">'A70A79_CNT'</span>, <span class="st">'A70A79_M_CNT'</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'A70A79_F_CNT'</span>, <span class="st">'A80A89_CNT'</span>, <span class="st">'A80A89_M_CNT'</span>, <span class="st">'A80A89_F_CNT'</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'A90A99_CNT'</span>, <span class="st">'A90A99_M_CNT'</span>, <span class="st">'A90A99_F_CNT'</span>, <span class="st">'A100UP_10_CNT'</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'A100UP_M_10_CNT'</span>, <span class="st">'A100UP_F_10_CNT'</span>]</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>pop_cols <span class="op">=</span> [<span class="st">'H_CNT'</span>, <span class="st">'P_CNT'</span>, <span class="st">'M_CNT'</span>, <span class="st">'F_CNT'</span>]</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to merge with prefix</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merge_with_prefix(base_df, merge_df, cols, year_prefix):</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    temp_df <span class="op">=</span> merge_df[[<span class="st">'CODEBASE'</span>] <span class="op">+</span> cols].copy()</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    temp_df <span class="op">=</span> temp_df.rename(columns<span class="op">=</span>{col: <span class="ss">f'</span><span class="sc">{</span>year_prefix<span class="sc">}{</span>col<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> col <span class="kw">in</span> cols})</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> base_df.merge(temp_df, on<span class="op">=</span><span class="st">'CODEBASE'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge AGE 2023</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>tn_bsa_shp <span class="op">=</span> merge_with_prefix(tn_bsa_shp, BSA_AGE_TN_2023, age_cols, <span class="st">'Y2023_'</span>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge AGE 2015</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>tn_bsa_shp <span class="op">=</span> merge_with_prefix(tn_bsa_shp, BSA_AGE_TN_2015, age_cols, <span class="st">'Y2015_'</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge POP 2023</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>tn_bsa_shp <span class="op">=</span> merge_with_prefix(tn_bsa_shp, BSA_POP_TN_2023, pop_cols, <span class="st">'Y2023_'</span>)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge POP 2015</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>tn_bsa_shp <span class="op">=</span> merge_with_prefix(tn_bsa_shp, BSA_POP_TN_2015, pop_cols, <span class="st">'Y2015_'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-7" class="cell" data-execution_count="127">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tally infections per region code</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>dengue_2015_counts <span class="op">=</span> local_tn_Dengue_2015[<span class="st">'最小統計區'</span>].value_counts().reset_index()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>dengue_2015_counts.columns <span class="op">=</span> [<span class="st">'CODEBASE'</span>, <span class="st">'Y2015_dengue'</span>]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>dengue_2023_counts <span class="op">=</span> local_tn_Dengue_2023[<span class="st">'最小統計區'</span>].value_counts().reset_index()</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>dengue_2023_counts.columns <span class="op">=</span> [<span class="st">'CODEBASE'</span>, <span class="st">'Y2023_dengue'</span>]</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the counts into the shapefile GeoDataFrame</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>tn_bsa_shp <span class="op">=</span> tn_bsa_shp.merge(dengue_2015_counts, on<span class="op">=</span><span class="st">'CODEBASE'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>tn_bsa_shp <span class="op">=</span> tn_bsa_shp.merge(dengue_2023_counts, on<span class="op">=</span><span class="st">'CODEBASE'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Fill NaN with 0 (regions with zero cases)</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>tn_bsa_shp[<span class="st">'Y2015_dengue'</span>] <span class="op">=</span> tn_bsa_shp[<span class="st">'Y2015_dengue'</span>].fillna(<span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>tn_bsa_shp[<span class="st">'Y2023_dengue'</span>] <span class="op">=</span> tn_bsa_shp[<span class="st">'Y2023_dengue'</span>].fillna(<span class="dv">0</span>).astype(<span class="bu">int</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-8" class="cell" data-execution_count="129">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">list</span>(tn_bsa_shp.columns))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>['U_ID', 'CODEBASE', 'CODE1', 'CODE2', 'TOWN_ID', 'TOWN', 'COUNTY_ID', 'COUNTY', 'X', 'Y', 'AREA', 'geometry', 'Y2023_A0A9_CNT', 'Y2023_A0A9_M_CNT', 'Y2023_A0A9_F_CNT', 'Y2023_A10A19_CNT', 'Y2023_A10A19_M_CNT', 'Y2023_A10A19_F_CNT', 'Y2023_A20A29_CNT', 'Y2023_A20A29_M_CNT', 'Y2023_A20A29_F_CNT', 'Y2023_A30A39_CNT', 'Y2023_A30A39_M_CNT', 'Y2023_A30A39_F_CNT', 'Y2023_A40A49_CNT', 'Y2023_A40A49_M_CNT', 'Y2023_A40A49_F_CNT', 'Y2023_A50A59_CNT', 'Y2023_A50A59_M_CNT', 'Y2023_A50A59_F_CNT', 'Y2023_A60A69_CNT', 'Y2023_A60A69_M_CNT', 'Y2023_A60A69_F_CNT', 'Y2023_A70A79_CNT', 'Y2023_A70A79_M_CNT', 'Y2023_A70A79_F_CNT', 'Y2023_A80A89_CNT', 'Y2023_A80A89_M_CNT', 'Y2023_A80A89_F_CNT', 'Y2023_A90A99_CNT', 'Y2023_A90A99_M_CNT', 'Y2023_A90A99_F_CNT', 'Y2023_A100UP_10_CNT', 'Y2023_A100UP_M_10_CNT', 'Y2023_A100UP_F_10_CNT', 'Y2015_A0A9_CNT', 'Y2015_A0A9_M_CNT', 'Y2015_A0A9_F_CNT', 'Y2015_A10A19_CNT', 'Y2015_A10A19_M_CNT', 'Y2015_A10A19_F_CNT', 'Y2015_A20A29_CNT', 'Y2015_A20A29_M_CNT', 'Y2015_A20A29_F_CNT', 'Y2015_A30A39_CNT', 'Y2015_A30A39_M_CNT', 'Y2015_A30A39_F_CNT', 'Y2015_A40A49_CNT', 'Y2015_A40A49_M_CNT', 'Y2015_A40A49_F_CNT', 'Y2015_A50A59_CNT', 'Y2015_A50A59_M_CNT', 'Y2015_A50A59_F_CNT', 'Y2015_A60A69_CNT', 'Y2015_A60A69_M_CNT', 'Y2015_A60A69_F_CNT', 'Y2015_A70A79_CNT', 'Y2015_A70A79_M_CNT', 'Y2015_A70A79_F_CNT', 'Y2015_A80A89_CNT', 'Y2015_A80A89_M_CNT', 'Y2015_A80A89_F_CNT', 'Y2015_A90A99_CNT', 'Y2015_A90A99_M_CNT', 'Y2015_A90A99_F_CNT', 'Y2015_A100UP_10_CNT', 'Y2015_A100UP_M_10_CNT', 'Y2015_A100UP_F_10_CNT', 'Y2023_H_CNT', 'Y2023_P_CNT', 'Y2023_M_CNT', 'Y2023_F_CNT', 'Y2015_H_CNT', 'Y2015_P_CNT', 'Y2015_M_CNT', 'Y2015_F_CNT', 'Y2015_dengue', 'Y2023_dengue']</code></pre>
</div>
</div>
<div id="cell-9" class="cell" data-execution_count="210">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Tainan shapefile</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>tn_vil_shp <span class="op">=</span> gpd.read_file(<span class="vs">r'D:</span><span class="er">\</span><span class="vs">Projects</span><span class="er">\</span><span class="vs">TMU</span><span class="er">\</span><span class="vs">gee_dengue</span><span class="dv">\d</span><span class="vs">ata</span><span class="er">\</span><span class="vs">external</span><span class="ch">\10</span><span class="vs">tnvillage'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>tn_vil_shp <span class="op">=</span> tn_vil_shp.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>tn_vil_shp.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'lightblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Visualization of tn_vil_shp"</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Longitude"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Latitude"</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tn_dengue_cleaning_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-10" class="cell" data-execution_count="153">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>VIL_AGE_TN_2015 <span class="op">=</span> VIL_AGE_TN_2015.rename(columns<span class="op">=</span>{<span class="st">'V_ID'</span>: <span class="st">'VILLAGE_ID'</span>})</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>VIL_POP_TN_2015 <span class="op">=</span> VIL_POP_TN_2015.rename(columns<span class="op">=</span>{<span class="st">'V_ID'</span>: <span class="st">'VILLAGE_ID'</span>})</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>VIL_AGE_TN_2023 <span class="op">=</span> VIL_AGE_TN_2023.rename(columns<span class="op">=</span>{<span class="st">'V_ID'</span>: <span class="st">'VILLAGE_ID'</span>})</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>VIL_POP_TN_2023 <span class="op">=</span> VIL_POP_TN_2023.rename(columns<span class="op">=</span>{<span class="st">'V_ID'</span>: <span class="st">'VILLAGE_ID'</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-11" class="cell" data-execution_count="196">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>VIL_AGE_TN_2023</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="196">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">COUNTY_ID</th>
<th data-quarto-table-cell-role="th">COUNTY</th>
<th data-quarto-table-cell-role="th">TOWN_ID</th>
<th data-quarto-table-cell-role="th">TOWN</th>
<th data-quarto-table-cell-role="th">VILLAGE_ID</th>
<th data-quarto-table-cell-role="th">VILLAGE</th>
<th data-quarto-table-cell-role="th">A0A9_CNT</th>
<th data-quarto-table-cell-role="th">A0A9_M_CNT</th>
<th data-quarto-table-cell-role="th">A0A9_F_CNT</th>
<th data-quarto-table-cell-role="th">A10A19_CNT</th>
<th data-quarto-table-cell-role="th">A10A19_M_CNT</th>
<th data-quarto-table-cell-role="th">A10A19_F_CNT</th>
<th data-quarto-table-cell-role="th">A20A29_CNT</th>
<th data-quarto-table-cell-role="th">A20A29_M_CNT</th>
<th data-quarto-table-cell-role="th">A20A29_F_CNT</th>
<th data-quarto-table-cell-role="th">A30A39_CNT</th>
<th data-quarto-table-cell-role="th">A30A39_M_CNT</th>
<th data-quarto-table-cell-role="th">A30A39_F_CNT</th>
<th data-quarto-table-cell-role="th">A40A49_CNT</th>
<th data-quarto-table-cell-role="th">A40A49_M_CNT</th>
<th data-quarto-table-cell-role="th">A40A49_F_CNT</th>
<th data-quarto-table-cell-role="th">A50A59_CNT</th>
<th data-quarto-table-cell-role="th">A50A59_M_CNT</th>
<th data-quarto-table-cell-role="th">A50A59_F_CNT</th>
<th data-quarto-table-cell-role="th">A60A69_CNT</th>
<th data-quarto-table-cell-role="th">A60A69_M_CNT</th>
<th data-quarto-table-cell-role="th">A60A69_F_CNT</th>
<th data-quarto-table-cell-role="th">A70A79_CNT</th>
<th data-quarto-table-cell-role="th">A70A79_M_CNT</th>
<th data-quarto-table-cell-role="th">A70A79_F_CNT</th>
<th data-quarto-table-cell-role="th">A80A89_CNT</th>
<th data-quarto-table-cell-role="th">A80A89_M_CNT</th>
<th data-quarto-table-cell-role="th">A80A89_F_CNT</th>
<th data-quarto-table-cell-role="th">A90A99_CNT</th>
<th data-quarto-table-cell-role="th">A90A99_M_CNT</th>
<th data-quarto-table-cell-role="th">A90A99_F_CNT</th>
<th data-quarto-table-cell-role="th">A100UP_CNT</th>
<th data-quarto-table-cell-role="th">A100UP_M_CNT</th>
<th data-quarto-table-cell-role="th">A100UP_F_CNT</th>
<th data-quarto-table-cell-role="th">INFO_TIME</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>縣市代碼</td>
<td>縣市名稱</td>
<td>鄉鎮市區代碼</td>
<td>鄉鎮市區名稱</td>
<td>村里代碼</td>
<td>村里名稱</td>
<td>0-9歲人口數</td>
<td>0-9歲男性人口數</td>
<td>0-9歲女性人口數</td>
<td>10-19歲人口數</td>
<td>10-19歲男性人口數</td>
<td>10-19歲女性人口數</td>
<td>20-29歲人口數</td>
<td>20-29歲男性人口數</td>
<td>20-29歲女性人口數</td>
<td>30-39歲人口數</td>
<td>30-39歲男性人口數</td>
<td>30-39歲女性人口數</td>
<td>40-49歲人口數</td>
<td>40-49歲男性人口數</td>
<td>40-49歲女性人口數</td>
<td>50-59歲人口數</td>
<td>50-59歲男性人口數</td>
<td>50-59歲女性人口數</td>
<td>60-69歲人口數</td>
<td>60-69歲男性人口數</td>
<td>60-69歲女性人口數</td>
<td>70-79歲人口數</td>
<td>70-79歲男性人口數</td>
<td>70-79歲女性人口數</td>
<td>80-89歲人口數</td>
<td>80-89歲男性人口數</td>
<td>80-89歲女性人口數</td>
<td>90-99歲人口數</td>
<td>90-99歲男性人口數</td>
<td>90-99歲女性人口數</td>
<td>100歲以上人口數</td>
<td>100歲以上男性人口數</td>
<td>100歲以上女性人口數</td>
<td>資料時間</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>67000</td>
<td>臺南市</td>
<td>67000010</td>
<td>新營區</td>
<td>67000010-001</td>
<td>忠政里</td>
<td>328</td>
<td>173</td>
<td>155</td>
<td>375</td>
<td>171</td>
<td>204</td>
<td>546</td>
<td>309</td>
<td>237</td>
<td>647</td>
<td>329</td>
<td>318</td>
<td>712</td>
<td>340</td>
<td>372</td>
<td>704</td>
<td>338</td>
<td>366</td>
<td>935</td>
<td>409</td>
<td>526</td>
<td>578</td>
<td>268</td>
<td>310</td>
<td>259</td>
<td>116</td>
<td>143</td>
<td>46</td>
<td>13</td>
<td>33</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>112Y12M</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>67000</td>
<td>臺南市</td>
<td>67000010</td>
<td>新營區</td>
<td>67000010-002</td>
<td>民權里</td>
<td>256</td>
<td>138</td>
<td>118</td>
<td>229</td>
<td>125</td>
<td>104</td>
<td>266</td>
<td>137</td>
<td>129</td>
<td>296</td>
<td>152</td>
<td>144</td>
<td>358</td>
<td>161</td>
<td>197</td>
<td>400</td>
<td>188</td>
<td>212</td>
<td>359</td>
<td>174</td>
<td>185</td>
<td>289</td>
<td>141</td>
<td>148</td>
<td>155</td>
<td>69</td>
<td>86</td>
<td>44</td>
<td>18</td>
<td>26</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>112Y12M</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>67000</td>
<td>臺南市</td>
<td>67000010</td>
<td>新營區</td>
<td>67000010-003</td>
<td>三仙里</td>
<td>168</td>
<td>78</td>
<td>90</td>
<td>245</td>
<td>133</td>
<td>112</td>
<td>355</td>
<td>184</td>
<td>171</td>
<td>382</td>
<td>196</td>
<td>186</td>
<td>452</td>
<td>205</td>
<td>247</td>
<td>453</td>
<td>222</td>
<td>231</td>
<td>476</td>
<td>238</td>
<td>238</td>
<td>356</td>
<td>158</td>
<td>198</td>
<td>187</td>
<td>76</td>
<td>111</td>
<td>26</td>
<td>6</td>
<td>20</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>112Y12M</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>67000</td>
<td>臺南市</td>
<td>67000010</td>
<td>新營區</td>
<td>67000010-007</td>
<td>大宏里</td>
<td>312</td>
<td>173</td>
<td>139</td>
<td>412</td>
<td>211</td>
<td>201</td>
<td>291</td>
<td>154</td>
<td>137</td>
<td>391</td>
<td>197</td>
<td>194</td>
<td>462</td>
<td>211</td>
<td>251</td>
<td>450</td>
<td>217</td>
<td>233</td>
<td>514</td>
<td>247</td>
<td>267</td>
<td>369</td>
<td>185</td>
<td>184</td>
<td>174</td>
<td>66</td>
<td>108</td>
<td>46</td>
<td>19</td>
<td>27</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>112Y12M</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">645</th>
<td>67000</td>
<td>臺南市</td>
<td>67000370</td>
<td>中西區</td>
<td>67000370-044</td>
<td>兌悅里</td>
<td>190</td>
<td>90</td>
<td>100</td>
<td>259</td>
<td>136</td>
<td>123</td>
<td>467</td>
<td>266</td>
<td>201</td>
<td>516</td>
<td>276</td>
<td>240</td>
<td>667</td>
<td>368</td>
<td>299</td>
<td>722</td>
<td>369</td>
<td>353</td>
<td>701</td>
<td>375</td>
<td>326</td>
<td>427</td>
<td>213</td>
<td>214</td>
<td>234</td>
<td>90</td>
<td>144</td>
<td>34</td>
<td>15</td>
<td>19</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>112Y12M</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">646</th>
<td>67000</td>
<td>臺南市</td>
<td>67000370</td>
<td>中西區</td>
<td>67000370-045</td>
<td>淺草里</td>
<td>113</td>
<td>62</td>
<td>51</td>
<td>158</td>
<td>70</td>
<td>88</td>
<td>256</td>
<td>128</td>
<td>128</td>
<td>329</td>
<td>167</td>
<td>162</td>
<td>468</td>
<td>228</td>
<td>240</td>
<td>477</td>
<td>228</td>
<td>249</td>
<td>444</td>
<td>219</td>
<td>225</td>
<td>313</td>
<td>157</td>
<td>156</td>
<td>100</td>
<td>34</td>
<td>66</td>
<td>34</td>
<td>14</td>
<td>20</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>112Y12M</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">647</th>
<td>67000</td>
<td>臺南市</td>
<td>67000370</td>
<td>中西區</td>
<td>67000370-046</td>
<td>府前里</td>
<td>88</td>
<td>34</td>
<td>54</td>
<td>91</td>
<td>37</td>
<td>54</td>
<td>201</td>
<td>108</td>
<td>93</td>
<td>252</td>
<td>133</td>
<td>119</td>
<td>323</td>
<td>162</td>
<td>161</td>
<td>339</td>
<td>162</td>
<td>177</td>
<td>374</td>
<td>195</td>
<td>179</td>
<td>246</td>
<td>121</td>
<td>125</td>
<td>115</td>
<td>51</td>
<td>64</td>
<td>21</td>
<td>3</td>
<td>18</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>112Y12M</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">648</th>
<td>67000</td>
<td>臺南市</td>
<td>67000370</td>
<td>中西區</td>
<td>67000370-047</td>
<td>南廠里</td>
<td>158</td>
<td>76</td>
<td>82</td>
<td>210</td>
<td>117</td>
<td>93</td>
<td>392</td>
<td>207</td>
<td>185</td>
<td>501</td>
<td>279</td>
<td>222</td>
<td>609</td>
<td>332</td>
<td>277</td>
<td>707</td>
<td>360</td>
<td>347</td>
<td>737</td>
<td>373</td>
<td>364</td>
<td>473</td>
<td>218</td>
<td>255</td>
<td>239</td>
<td>84</td>
<td>155</td>
<td>49</td>
<td>16</td>
<td>33</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>112Y12M</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">649</th>
<td>67000</td>
<td>臺南市</td>
<td>67000370</td>
<td>中西區</td>
<td>67000370-048</td>
<td>西和里</td>
<td>273</td>
<td>149</td>
<td>124</td>
<td>345</td>
<td>181</td>
<td>164</td>
<td>548</td>
<td>291</td>
<td>257</td>
<td>591</td>
<td>279</td>
<td>312</td>
<td>825</td>
<td>373</td>
<td>452</td>
<td>832</td>
<td>396</td>
<td>436</td>
<td>573</td>
<td>270</td>
<td>303</td>
<td>353</td>
<td>146</td>
<td>207</td>
<td>177</td>
<td>70</td>
<td>107</td>
<td>30</td>
<td>13</td>
<td>17</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>112Y12M</td>
</tr>
</tbody>
</table>

<p>650 rows × 40 columns</p>
</div>
</div>
</div>
<div id="cell-12" class="cell" data-execution_count="212">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>tn_vil_shp[<span class="st">'merge_key'</span>] <span class="op">=</span> tn_vil_shp[<span class="st">'TOWN_ID'</span>] <span class="op">+</span> <span class="st">'-'</span> <span class="op">+</span> tn_vil_shp[<span class="st">'VILLAGE_ID'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-13" class="cell" data-execution_count="213">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>columns_to_transfer <span class="op">=</span> [<span class="st">'A0A9_CNT'</span>, <span class="st">'A0A9_M_CNT'</span>, <span class="st">'A0A9_F_CNT'</span>, <span class="st">'A10A19_CNT'</span>, <span class="st">'A10A19_M_CNT'</span>,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'A10A19_F_CNT'</span>, <span class="st">'A20A29_CNT'</span>, <span class="st">'A20A29_M_CNT'</span>, <span class="st">'A20A29_F_CNT'</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'A30A39_CNT'</span>, <span class="st">'A30A39_M_CNT'</span>, <span class="st">'A30A39_F_CNT'</span>, <span class="st">'A40A49_CNT'</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'A40A49_M_CNT'</span>, <span class="st">'A40A49_F_CNT'</span>, <span class="st">'A50A59_CNT'</span>, <span class="st">'A50A59_M_CNT'</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'A50A59_F_CNT'</span>, <span class="st">'A60A69_CNT'</span>, <span class="st">'A60A69_M_CNT'</span>, <span class="st">'A60A69_F_CNT'</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'A70A79_CNT'</span>, <span class="st">'A70A79_M_CNT'</span>, <span class="st">'A70A79_F_CNT'</span>, <span class="st">'A80A89_CNT'</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'A80A89_M_CNT'</span>, <span class="st">'A80A89_F_CNT'</span>, <span class="st">'A90A99_CNT'</span>, <span class="st">'A90A99_M_CNT'</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'A90A99_F_CNT'</span>, <span class="st">'A100UP_CNT'</span>, <span class="st">'A100UP_M_CNT'</span>, <span class="st">'A100UP_F_CNT'</span>]</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># For 2023</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>vil_2023 <span class="op">=</span> VIL_AGE_TN_2023[[<span class="st">'VILLAGE_ID'</span>] <span class="op">+</span> columns_to_transfer].copy()</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>vil_2023.rename(columns<span class="op">=</span>{col: <span class="ss">f'Y2023_</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> col <span class="kw">in</span> columns_to_transfer}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>tn_vil_shp <span class="op">=</span> tn_vil_shp.merge(</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    vil_2023,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span><span class="st">'merge_key'</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span><span class="st">'VILLAGE_ID'</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    suffixes<span class="op">=</span>(<span class="st">''</span>, <span class="st">'_drop'</span>)  <span class="co"># Prevent _x, _y clutter</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>tn_vil_shp.drop(columns<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> tn_vil_shp.columns <span class="cf">if</span> col.endswith(<span class="st">'_drop'</span>)], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co"># For 2015</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>vil_2015 <span class="op">=</span> VIL_AGE_TN_2015[[<span class="st">'VILLAGE_ID'</span>] <span class="op">+</span> columns_to_transfer].copy()</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>vil_2015.rename(columns<span class="op">=</span>{col: <span class="ss">f'Y2015_</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> col <span class="kw">in</span> columns_to_transfer}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>tn_vil_shp <span class="op">=</span> tn_vil_shp.merge(</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    vil_2015,</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span><span class="st">'merge_key'</span>,</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span><span class="st">'VILLAGE_ID'</span>,</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    suffixes<span class="op">=</span>(<span class="st">''</span>, <span class="st">'_drop'</span>)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>tn_vil_shp.drop(columns<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> tn_vil_shp.columns <span class="cf">if</span> col.endswith(<span class="st">'_drop'</span>)], inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-14" class="cell" data-execution_count="214">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tn_vil_shp.columns</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="214">
<pre><code>Index(['ID', 'OBJECTID_1', 'VILLAGE', 'TOWN', 'COUNTY', 'VILLAGE_ID',
       'TOWN_ID', 'COUNTY_ID', 'TV_ALL', 'VILLCODE', 'ORI_VILLAG', 'AREA',
       'MAX_X', 'MAX_Y', 'MIN_X', 'MIN_Y', 'X', 'Y', 'V_ID', 'SORT',
       'COUNTYNAME', 'TOWNNAME', 'OBJECTID', 'ORIG_FID', 'Shape_Leng',
       'Shape_Le_1', 'Shape_Area', 'ET_ID', 'geometry', 'merge_key',
       'Y2023_A0A9_CNT', 'Y2023_A0A9_M_CNT', 'Y2023_A0A9_F_CNT',
       'Y2023_A10A19_CNT', 'Y2023_A10A19_M_CNT', 'Y2023_A10A19_F_CNT',
       'Y2023_A20A29_CNT', 'Y2023_A20A29_M_CNT', 'Y2023_A20A29_F_CNT',
       'Y2023_A30A39_CNT', 'Y2023_A30A39_M_CNT', 'Y2023_A30A39_F_CNT',
       'Y2023_A40A49_CNT', 'Y2023_A40A49_M_CNT', 'Y2023_A40A49_F_CNT',
       'Y2023_A50A59_CNT', 'Y2023_A50A59_M_CNT', 'Y2023_A50A59_F_CNT',
       'Y2023_A60A69_CNT', 'Y2023_A60A69_M_CNT', 'Y2023_A60A69_F_CNT',
       'Y2023_A70A79_CNT', 'Y2023_A70A79_M_CNT', 'Y2023_A70A79_F_CNT',
       'Y2023_A80A89_CNT', 'Y2023_A80A89_M_CNT', 'Y2023_A80A89_F_CNT',
       'Y2023_A90A99_CNT', 'Y2023_A90A99_M_CNT', 'Y2023_A90A99_F_CNT',
       'Y2023_A100UP_CNT', 'Y2023_A100UP_M_CNT', 'Y2023_A100UP_F_CNT',
       'Y2015_A0A9_CNT', 'Y2015_A0A9_M_CNT', 'Y2015_A0A9_F_CNT',
       'Y2015_A10A19_CNT', 'Y2015_A10A19_M_CNT', 'Y2015_A10A19_F_CNT',
       'Y2015_A20A29_CNT', 'Y2015_A20A29_M_CNT', 'Y2015_A20A29_F_CNT',
       'Y2015_A30A39_CNT', 'Y2015_A30A39_M_CNT', 'Y2015_A30A39_F_CNT',
       'Y2015_A40A49_CNT', 'Y2015_A40A49_M_CNT', 'Y2015_A40A49_F_CNT',
       'Y2015_A50A59_CNT', 'Y2015_A50A59_M_CNT', 'Y2015_A50A59_F_CNT',
       'Y2015_A60A69_CNT', 'Y2015_A60A69_M_CNT', 'Y2015_A60A69_F_CNT',
       'Y2015_A70A79_CNT', 'Y2015_A70A79_M_CNT', 'Y2015_A70A79_F_CNT',
       'Y2015_A80A89_CNT', 'Y2015_A80A89_M_CNT', 'Y2015_A80A89_F_CNT',
       'Y2015_A90A99_CNT', 'Y2015_A90A99_M_CNT', 'Y2015_A90A99_F_CNT',
       'Y2015_A100UP_CNT', 'Y2015_A100UP_M_CNT', 'Y2015_A100UP_F_CNT'],
      dtype='object')</code></pre>
</div>
</div>
<div id="cell-15" class="cell" data-execution_count="215">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Copy and rename columns with 'Y2015_' prefix</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>cols_to_add <span class="op">=</span> [<span class="st">'H_CNT'</span>, <span class="st">'P_CNT'</span>, <span class="st">'M_CNT'</span>, <span class="st">'F_CNT'</span>]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns with prefix</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>VIL_POP_2015_renamed <span class="op">=</span> VIL_POP_TN_2015[[<span class="st">'VILLAGE_ID'</span>] <span class="op">+</span> cols_to_add].copy()</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>VIL_POP_2015_renamed <span class="op">=</span> VIL_POP_2015_renamed.rename(</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>{col: <span class="ss">f'Y2015_</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> col <span class="kw">in</span> cols_to_add}</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Merge (avoid extra 'VILLAGE_ID' clutter)</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>tn_vil_shp <span class="op">=</span> tn_vil_shp.merge(</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    VIL_POP_2015_renamed,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span><span class="st">'merge_key'</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span><span class="st">'VILLAGE_ID'</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    suffixes<span class="op">=</span>(<span class="st">''</span>, <span class="st">'_drop'</span>)  <span class="co"># avoid _x, _y</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Drop extra columns from right-side dataframe</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>tn_vil_shp.drop(columns<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> tn_vil_shp.columns <span class="cf">if</span> col.endswith(<span class="st">'_drop'</span>) <span class="kw">or</span> col <span class="op">==</span> <span class="st">'VILLAGE_ID'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-16" class="cell" data-execution_count="218">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Copy and rename columns with 'Y2023_' prefix</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>cols_to_add <span class="op">=</span> [<span class="st">'H_CNT'</span>, <span class="st">'P_CNT'</span>, <span class="st">'M_CNT'</span>, <span class="st">'F_CNT'</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns with prefix</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>VIL_POP_2023_renamed <span class="op">=</span> VIL_POP_TN_2023[[<span class="st">'VILLAGE_ID'</span>] <span class="op">+</span> cols_to_add].copy()</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>VIL_POP_2023_renamed <span class="op">=</span> VIL_POP_2023_renamed.rename(</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>{col: <span class="ss">f'Y2023_</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> col <span class="kw">in</span> cols_to_add}</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Merge (avoid extra 'VILLAGE_ID' clutter)</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>tn_vil_shp <span class="op">=</span> tn_vil_shp.merge(</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    VIL_POP_2023_renamed,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span><span class="st">'merge_key'</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span><span class="st">'VILLAGE_ID'</span>,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    suffixes<span class="op">=</span>(<span class="st">''</span>, <span class="st">'_drop'</span>)  <span class="co"># avoid _x, _y</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Drop extra columns from right-side dataframe</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>tn_vil_shp.drop(columns<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> tn_vil_shp.columns <span class="cf">if</span> col.endswith(<span class="st">'_drop'</span>) <span class="kw">or</span> col <span class="op">==</span> <span class="st">'VILLAGE_ID'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-17" class="cell" data-execution_count="221">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>tn_vil_shp</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="221">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">OBJECTID_1</th>
<th data-quarto-table-cell-role="th">VILLAGE</th>
<th data-quarto-table-cell-role="th">TOWN</th>
<th data-quarto-table-cell-role="th">COUNTY</th>
<th data-quarto-table-cell-role="th">TOWN_ID</th>
<th data-quarto-table-cell-role="th">COUNTY_ID</th>
<th data-quarto-table-cell-role="th">TV_ALL</th>
<th data-quarto-table-cell-role="th">VILLCODE</th>
<th data-quarto-table-cell-role="th">ORI_VILLAG</th>
<th data-quarto-table-cell-role="th">AREA</th>
<th data-quarto-table-cell-role="th">MAX_X</th>
<th data-quarto-table-cell-role="th">MAX_Y</th>
<th data-quarto-table-cell-role="th">MIN_X</th>
<th data-quarto-table-cell-role="th">MIN_Y</th>
<th data-quarto-table-cell-role="th">X</th>
<th data-quarto-table-cell-role="th">Y</th>
<th data-quarto-table-cell-role="th">V_ID</th>
<th data-quarto-table-cell-role="th">SORT</th>
<th data-quarto-table-cell-role="th">COUNTYNAME</th>
<th data-quarto-table-cell-role="th">TOWNNAME</th>
<th data-quarto-table-cell-role="th">OBJECTID</th>
<th data-quarto-table-cell-role="th">ORIG_FID</th>
<th data-quarto-table-cell-role="th">Shape_Leng</th>
<th data-quarto-table-cell-role="th">Shape_Le_1</th>
<th data-quarto-table-cell-role="th">Shape_Area</th>
<th data-quarto-table-cell-role="th">ET_ID</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">merge_key</th>
<th data-quarto-table-cell-role="th">Y2023_A0A9_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A0A9_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A0A9_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A10A19_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A10A19_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A10A19_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A20A29_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A20A29_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A20A29_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A30A39_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A30A39_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A30A39_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A40A49_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A40A49_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A40A49_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A50A59_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A50A59_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A50A59_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A60A69_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A60A69_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A60A69_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A70A79_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A70A79_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A70A79_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A80A89_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A80A89_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A80A89_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A90A99_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A90A99_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A90A99_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A100UP_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A100UP_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A100UP_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A0A9_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A0A9_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A0A9_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A10A19_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A10A19_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A10A19_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A20A29_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A20A29_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A20A29_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A30A39_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A30A39_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A30A39_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A40A49_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A40A49_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A40A49_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A50A59_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A50A59_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A50A59_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A60A69_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A60A69_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A60A69_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A70A79_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A70A79_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A70A79_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A80A89_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A80A89_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A80A89_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A90A99_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A90A99_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A90A99_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A100UP_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A100UP_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A100UP_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_H_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_P_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_H_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_P_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_F_CNT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>None</td>
<td>4377</td>
<td>內角里</td>
<td>白河區</td>
<td>臺南市</td>
<td>67000030</td>
<td>67000</td>
<td>白河區內角里</td>
<td>A6703-022-00</td>
<td>None</td>
<td>5.060602e+06</td>
<td>194875.6094</td>
<td>2.590210e+06</td>
<td>191611.3157</td>
<td>2.587656e+06</td>
<td>193316.0265</td>
<td>2.588919e+06</td>
<td>67000030-022</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>10371.873803</td>
<td>5.060602e+06</td>
<td>4375</td>
<td>POLYGON ((120.43652 23.41263, 120.43654 23.412...</td>
<td>67000030-022</td>
<td>20</td>
<td>17</td>
<td>3</td>
<td>33</td>
<td>21</td>
<td>12</td>
<td>53</td>
<td>35</td>
<td>18</td>
<td>68</td>
<td>42</td>
<td>26</td>
<td>92</td>
<td>57</td>
<td>35</td>
<td>93</td>
<td>60</td>
<td>33</td>
<td>135</td>
<td>85</td>
<td>50</td>
<td>80</td>
<td>41</td>
<td>39</td>
<td>68</td>
<td>29</td>
<td>39</td>
<td>18</td>
<td>5</td>
<td>13</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>36</td>
<td>22</td>
<td>14</td>
<td>53</td>
<td>32</td>
<td>21</td>
<td>93</td>
<td>53</td>
<td>40</td>
<td>105</td>
<td>57</td>
<td>48</td>
<td>96</td>
<td>60</td>
<td>36</td>
<td>138</td>
<td>84</td>
<td>54</td>
<td>112</td>
<td>64</td>
<td>48</td>
<td>104</td>
<td>52</td>
<td>52</td>
<td>58</td>
<td>20</td>
<td>38</td>
<td>8</td>
<td>2</td>
<td>6</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>334</td>
<td>803</td>
<td>446</td>
<td>357</td>
<td>306</td>
<td>660</td>
<td>392</td>
<td>268</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>None</td>
<td>4378</td>
<td>蓮潭里</td>
<td>白河區</td>
<td>臺南市</td>
<td>67000030</td>
<td>67000</td>
<td>白河區蓮潭里</td>
<td>A6703-017-00</td>
<td>None</td>
<td>4.085859e+06</td>
<td>190565.6738</td>
<td>2.590189e+06</td>
<td>187096.4815</td>
<td>2.588026e+06</td>
<td>188850.9894</td>
<td>2.589012e+06</td>
<td>67000030-017</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>10117.167850</td>
<td>4.085859e+06</td>
<td>4376</td>
<td>POLYGON ((120.40732 23.41229, 120.40751 23.412...</td>
<td>67000030-017</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>53</td>
<td>26</td>
<td>27</td>
<td>94</td>
<td>48</td>
<td>46</td>
<td>128</td>
<td>73</td>
<td>55</td>
<td>140</td>
<td>73</td>
<td>67</td>
<td>122</td>
<td>74</td>
<td>48</td>
<td>170</td>
<td>98</td>
<td>72</td>
<td>132</td>
<td>81</td>
<td>51</td>
<td>90</td>
<td>39</td>
<td>51</td>
<td>77</td>
<td>28</td>
<td>49</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>354</td>
<td>1008</td>
<td>540</td>
<td>468</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>None</td>
<td>4379</td>
<td>草店里</td>
<td>白河區</td>
<td>臺南市</td>
<td>67000030</td>
<td>67000</td>
<td>白河區草店里</td>
<td>A6703-023-00</td>
<td>None</td>
<td>4.212266e+06</td>
<td>193819.2188</td>
<td>2.589503e+06</td>
<td>190486.9104</td>
<td>2.586876e+06</td>
<td>191839.8186</td>
<td>2.588119e+06</td>
<td>67000030-023</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>12639.008303</td>
<td>4.212266e+06</td>
<td>4377</td>
<td>POLYGON ((120.42996 23.40641, 120.4301 23.4064...</td>
<td>67000030-023</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>40</td>
<td>17</td>
<td>23</td>
<td>96</td>
<td>45</td>
<td>51</td>
<td>108</td>
<td>50</td>
<td>58</td>
<td>134</td>
<td>75</td>
<td>59</td>
<td>143</td>
<td>73</td>
<td>70</td>
<td>158</td>
<td>101</td>
<td>57</td>
<td>127</td>
<td>65</td>
<td>62</td>
<td>92</td>
<td>47</td>
<td>45</td>
<td>73</td>
<td>33</td>
<td>40</td>
<td>9</td>
<td>2</td>
<td>7</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>384</td>
<td>980</td>
<td>508</td>
<td>472</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>None</td>
<td>4380</td>
<td>詔安里</td>
<td>白河區</td>
<td>臺南市</td>
<td>67000030</td>
<td>67000</td>
<td>白河區詔安里</td>
<td>A6703-015-00</td>
<td>None</td>
<td>1.840815e+06</td>
<td>191048.7910</td>
<td>2.589375e+06</td>
<td>189384.3438</td>
<td>2.587185e+06</td>
<td>190190.1797</td>
<td>2.588177e+06</td>
<td>67000030-015</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>7924.371195</td>
<td>1.840815e+06</td>
<td>4378</td>
<td>POLYGON ((120.41847 23.40612, 120.41857 23.405...</td>
<td>67000030-015</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>60</td>
<td>29</td>
<td>31</td>
<td>101</td>
<td>56</td>
<td>45</td>
<td>110</td>
<td>50</td>
<td>60</td>
<td>138</td>
<td>74</td>
<td>64</td>
<td>132</td>
<td>72</td>
<td>60</td>
<td>186</td>
<td>113</td>
<td>73</td>
<td>110</td>
<td>62</td>
<td>48</td>
<td>92</td>
<td>34</td>
<td>58</td>
<td>70</td>
<td>31</td>
<td>39</td>
<td>4</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>371</td>
<td>1004</td>
<td>522</td>
<td>482</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>None</td>
<td>4381</td>
<td>嘉田里</td>
<td>後壁區</td>
<td>臺南市</td>
<td>67000050</td>
<td>67000</td>
<td>後壁區嘉田里</td>
<td>A6705-005-00</td>
<td>None</td>
<td>3.468361e+06</td>
<td>188535.3729</td>
<td>2.589238e+06</td>
<td>185946.0020</td>
<td>2.586081e+06</td>
<td>187109.3847</td>
<td>2.587550e+06</td>
<td>67000050-005</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>11353.387029</td>
<td>3.468361e+06</td>
<td>4379</td>
<td>POLYGON ((120.38221 23.40378, 120.3823 23.4038...</td>
<td>67000050-005</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>75</td>
<td>31</td>
<td>44</td>
<td>116</td>
<td>57</td>
<td>59</td>
<td>152</td>
<td>90</td>
<td>62</td>
<td>208</td>
<td>108</td>
<td>100</td>
<td>157</td>
<td>86</td>
<td>71</td>
<td>217</td>
<td>131</td>
<td>86</td>
<td>164</td>
<td>86</td>
<td>78</td>
<td>138</td>
<td>59</td>
<td>79</td>
<td>81</td>
<td>37</td>
<td>44</td>
<td>5</td>
<td>2</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>438</td>
<td>1313</td>
<td>687</td>
<td>626</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">747</th>
<td>None</td>
<td>6183</td>
<td>府南里</td>
<td>南區</td>
<td>臺南市</td>
<td>67000330</td>
<td>67000</td>
<td>南區府南里</td>
<td>A6733-034-00</td>
<td>None</td>
<td>3.603944e+05</td>
<td>167738.5165</td>
<td>2.541744e+06</td>
<td>167017.6409</td>
<td>2.540881e+06</td>
<td>167439.2019</td>
<td>2.541426e+06</td>
<td>67000330-034</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>2863.643334</td>
<td>3.603944e+05</td>
<td>6181</td>
<td>POLYGON ((120.19608 22.97502, 120.1965 22.9750...</td>
<td>67000330-034</td>
<td>313</td>
<td>154</td>
<td>159</td>
<td>446</td>
<td>223</td>
<td>223</td>
<td>521</td>
<td>276</td>
<td>245</td>
<td>816</td>
<td>396</td>
<td>420</td>
<td>993</td>
<td>515</td>
<td>478</td>
<td>738</td>
<td>346</td>
<td>392</td>
<td>861</td>
<td>384</td>
<td>477</td>
<td>501</td>
<td>227</td>
<td>274</td>
<td>158</td>
<td>60</td>
<td>98</td>
<td>24</td>
<td>8</td>
<td>16</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>423</td>
<td>210</td>
<td>213</td>
<td>482</td>
<td>260</td>
<td>222</td>
<td>786</td>
<td>371</td>
<td>415</td>
<td>1035</td>
<td>554</td>
<td>481</td>
<td>718</td>
<td>351</td>
<td>367</td>
<td>899</td>
<td>404</td>
<td>495</td>
<td>681</td>
<td>317</td>
<td>364</td>
<td>277</td>
<td>117</td>
<td>160</td>
<td>117</td>
<td>49</td>
<td>68</td>
<td>15</td>
<td>6</td>
<td>9</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>1838</td>
<td>5435</td>
<td>2639</td>
<td>2796</td>
<td>1995</td>
<td>5371</td>
<td>2589</td>
<td>2782</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">748</th>
<td>None</td>
<td>6184</td>
<td>光明里</td>
<td>南區</td>
<td>臺南市</td>
<td>67000330</td>
<td>67000</td>
<td>南區光明里</td>
<td>A6733-011-00</td>
<td>None</td>
<td>1.603870e+05</td>
<td>166857.0603</td>
<td>2.541739e+06</td>
<td>166460.7077</td>
<td>2.541170e+06</td>
<td>166631.6047</td>
<td>2.541450e+06</td>
<td>67000330-011</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>1757.778310</td>
<td>1.603871e+05</td>
<td>6182</td>
<td>POLYGON ((120.18752 22.97494, 120.18753 22.974...</td>
<td>67000330-011</td>
<td>253</td>
<td>134</td>
<td>119</td>
<td>309</td>
<td>157</td>
<td>152</td>
<td>466</td>
<td>227</td>
<td>239</td>
<td>665</td>
<td>331</td>
<td>334</td>
<td>726</td>
<td>364</td>
<td>362</td>
<td>697</td>
<td>344</td>
<td>353</td>
<td>759</td>
<td>351</td>
<td>408</td>
<td>426</td>
<td>195</td>
<td>231</td>
<td>148</td>
<td>49</td>
<td>99</td>
<td>25</td>
<td>12</td>
<td>13</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>309</td>
<td>166</td>
<td>143</td>
<td>431</td>
<td>199</td>
<td>232</td>
<td>737</td>
<td>391</td>
<td>346</td>
<td>840</td>
<td>424</td>
<td>416</td>
<td>718</td>
<td>357</td>
<td>361</td>
<td>883</td>
<td>407</td>
<td>476</td>
<td>589</td>
<td>291</td>
<td>298</td>
<td>258</td>
<td>104</td>
<td>154</td>
<td>110</td>
<td>54</td>
<td>56</td>
<td>18</td>
<td>7</td>
<td>11</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1793</td>
<td>4893</td>
<td>2400</td>
<td>2493</td>
<td>1809</td>
<td>4474</td>
<td>2164</td>
<td>2310</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">749</th>
<td>None</td>
<td>6185</td>
<td>崇明里</td>
<td>東區</td>
<td>臺南市</td>
<td>67000320</td>
<td>67000</td>
<td>東區崇明里</td>
<td>A6732-012-00</td>
<td>None</td>
<td>9.701465e+05</td>
<td>170604.2367</td>
<td>2.541655e+06</td>
<td>169492.1825</td>
<td>2.540591e+06</td>
<td>170091.2445</td>
<td>2.541083e+06</td>
<td>67000320-012</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>3850.791646</td>
<td>9.701465e+05</td>
<td>6183</td>
<td>POLYGON ((120.22312 22.97436, 120.22317 22.974...</td>
<td>67000320-012</td>
<td>359</td>
<td>192</td>
<td>167</td>
<td>501</td>
<td>262</td>
<td>239</td>
<td>618</td>
<td>347</td>
<td>271</td>
<td>514</td>
<td>274</td>
<td>240</td>
<td>667</td>
<td>301</td>
<td>366</td>
<td>838</td>
<td>357</td>
<td>481</td>
<td>644</td>
<td>281</td>
<td>363</td>
<td>385</td>
<td>168</td>
<td>217</td>
<td>143</td>
<td>55</td>
<td>88</td>
<td>25</td>
<td>11</td>
<td>14</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>588</td>
<td>294</td>
<td>294</td>
<td>772</td>
<td>411</td>
<td>361</td>
<td>613</td>
<td>329</td>
<td>284</td>
<td>708</td>
<td>296</td>
<td>412</td>
<td>936</td>
<td>393</td>
<td>543</td>
<td>782</td>
<td>351</td>
<td>431</td>
<td>506</td>
<td>222</td>
<td>284</td>
<td>189</td>
<td>85</td>
<td>104</td>
<td>100</td>
<td>40</td>
<td>60</td>
<td>26</td>
<td>15</td>
<td>11</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1992</td>
<td>5221</td>
<td>2437</td>
<td>2784</td>
<td>1949</td>
<td>4694</td>
<td>2248</td>
<td>2446</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">750</th>
<td>None</td>
<td>6186</td>
<td>鯤鯓里</td>
<td>南區</td>
<td>臺南市</td>
<td>67000330</td>
<td>67000</td>
<td>南區鯤鯓里</td>
<td>A6733-036-00</td>
<td>None</td>
<td>3.114528e+06</td>
<td>166307.0647</td>
<td>2.541586e+06</td>
<td>162925.0156</td>
<td>2.539276e+06</td>
<td>165016.3566</td>
<td>2.540313e+06</td>
<td>67000330-036</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>10839.080585</td>
<td>3.114528e+06</td>
<td>6184</td>
<td>POLYGON ((120.16534 22.97204, 120.16536 22.972...</td>
<td>67000330-036</td>
<td>80</td>
<td>46</td>
<td>34</td>
<td>118</td>
<td>64</td>
<td>54</td>
<td>219</td>
<td>102</td>
<td>117</td>
<td>210</td>
<td>110</td>
<td>100</td>
<td>312</td>
<td>164</td>
<td>148</td>
<td>337</td>
<td>184</td>
<td>153</td>
<td>309</td>
<td>167</td>
<td>142</td>
<td>188</td>
<td>91</td>
<td>97</td>
<td>82</td>
<td>27</td>
<td>55</td>
<td>16</td>
<td>4</td>
<td>12</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>122</td>
<td>59</td>
<td>63</td>
<td>178</td>
<td>87</td>
<td>91</td>
<td>257</td>
<td>131</td>
<td>126</td>
<td>305</td>
<td>165</td>
<td>140</td>
<td>337</td>
<td>189</td>
<td>148</td>
<td>365</td>
<td>206</td>
<td>159</td>
<td>268</td>
<td>136</td>
<td>132</td>
<td>157</td>
<td>71</td>
<td>86</td>
<td>79</td>
<td>27</td>
<td>52</td>
<td>11</td>
<td>5</td>
<td>6</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>720</td>
<td>2079</td>
<td>1076</td>
<td>1003</td>
<td>686</td>
<td>1874</td>
<td>961</td>
<td>913</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">751</th>
<td>None</td>
<td>7782</td>
<td>中沙里</td>
<td>安定區</td>
<td>臺南市</td>
<td>67000210</td>
<td>67000</td>
<td>安定區中沙里</td>
<td>A6721-012-00</td>
<td>None</td>
<td>1.436603e+06</td>
<td>169678.2460</td>
<td>2.553504e+06</td>
<td>167993.3594</td>
<td>2.552005e+06</td>
<td>168907.2948</td>
<td>2.552716e+06</td>
<td>67000210-012</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>5514.315304</td>
<td>1.436603e+06</td>
<td>7780</td>
<td>POLYGON ((120.21252 23.08121, 120.21446 23.081...</td>
<td>67000210-012</td>
<td>51</td>
<td>22</td>
<td>29</td>
<td>44</td>
<td>23</td>
<td>21</td>
<td>104</td>
<td>54</td>
<td>50</td>
<td>98</td>
<td>55</td>
<td>43</td>
<td>119</td>
<td>57</td>
<td>62</td>
<td>128</td>
<td>71</td>
<td>57</td>
<td>124</td>
<td>64</td>
<td>60</td>
<td>77</td>
<td>35</td>
<td>42</td>
<td>34</td>
<td>14</td>
<td>20</td>
<td>4</td>
<td>1</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>57</td>
<td>27</td>
<td>30</td>
<td>65</td>
<td>33</td>
<td>32</td>
<td>122</td>
<td>69</td>
<td>53</td>
<td>117</td>
<td>57</td>
<td>60</td>
<td>131</td>
<td>73</td>
<td>58</td>
<td>132</td>
<td>65</td>
<td>67</td>
<td>99</td>
<td>54</td>
<td>45</td>
<td>56</td>
<td>28</td>
<td>28</td>
<td>24</td>
<td>6</td>
<td>18</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>257</td>
<td>805</td>
<td>412</td>
<td>393</td>
<td>265</td>
<td>783</td>
<td>396</td>
<td>387</td>
</tr>
</tbody>
</table>

<p>752 rows × 103 columns</p>
</div>
</div>
</div>
<div id="cell-18" class="cell" data-execution_count="222">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tally infections per region code (both using 'merge_key' for consistency)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>dengue_2015_counts <span class="op">=</span> local_tn_Dengue_2015[<span class="st">'感染村里代碼'</span>].value_counts().reset_index()</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>dengue_2015_counts.columns <span class="op">=</span> [<span class="st">'merge_key'</span>, <span class="st">'Y2015_dengue'</span>]</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>dengue_2023_counts <span class="op">=</span> local_tn_Dengue_2023[<span class="st">'感染村里代碼'</span>].value_counts().reset_index()</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>dengue_2023_counts.columns <span class="op">=</span> [<span class="st">'merge_key'</span>, <span class="st">'Y2023_dengue'</span>]</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the counts into the shapefile GeoDataFrame</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>tn_vil_shp <span class="op">=</span> tn_vil_shp.merge(dengue_2015_counts, on<span class="op">=</span><span class="st">'merge_key'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>tn_vil_shp <span class="op">=</span> tn_vil_shp.merge(dengue_2023_counts, on<span class="op">=</span><span class="st">'merge_key'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Fill NaN with 0 (regions with zero cases)</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>tn_vil_shp[<span class="st">'Y2015_dengue'</span>] <span class="op">=</span> tn_vil_shp[<span class="st">'Y2015_dengue'</span>].fillna(<span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>tn_vil_shp[<span class="st">'Y2023_dengue'</span>] <span class="op">=</span> tn_vil_shp[<span class="st">'Y2023_dengue'</span>].fillna(<span class="dv">0</span>).astype(<span class="bu">int</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-19" class="cell" data-execution_count="228">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>tn_vil_shp <span class="op">=</span> tn_vil_shp.drop(columns<span class="op">=</span>[<span class="st">'Y2015_dengue'</span>,<span class="st">'Y2023_dengue'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-20" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tn_vil_shp</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="225">
<pre><code>array([0])</code></pre>
</div>
</div>
<div id="cell-21" class="cell" data-execution_count="176">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>VIL_AGE_2015_renamed <span class="op">=</span> VIL_AGE_TN_2015[[<span class="st">'VILLAGE_ID'</span>] <span class="op">+</span> cols_to_add].copy()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>VIL_AGE_2015_renamed <span class="op">=</span> VIL_AGE_2015_renamed.rename(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>{col: <span class="ss">f'Y2015_</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> col <span class="kw">in</span> cols_to_add})</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>tn_vil_shp <span class="op">=</span> tn_vil_shp.merge(</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    VIL_AGE_2015_renamed,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span><span class="st">'merge_key'</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span><span class="st">'VILLAGE_ID'</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-22" class="cell" data-execution_count="190">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>tn_vil_shp <span class="op">=</span> tn_vil_shp.drop(columns<span class="op">=</span>[<span class="st">'VILLAGE_ID_x'</span>,<span class="st">'VILLAGE_ID_y'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-23" class="cell" data-execution_count="230">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>tn_vil_shp_copy <span class="op">=</span> tn_vil_shp.copy()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-24" class="cell" data-execution_count="231">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Convert the infection dataframe to a GeoDataFrame</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>geometry <span class="op">=</span> [Point(xy) <span class="cf">for</span> xy <span class="kw">in</span> <span class="bu">zip</span>(local_tn_Dengue_2015[<span class="st">'最小統計區中心點X'</span>], local_tn_Dengue_2015[<span class="st">'最小統計區中心點Y'</span>])]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>dengue_gdf <span class="op">=</span> gpd.GeoDataFrame(local_tn_Dengue_2015, geometry<span class="op">=</span>geometry)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Ensure both GeoDataFrames have the same CRS (coordinate reference system)</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>dengue_gdf.set_crs(tn_vil_shp.crs, inplace<span class="op">=</span><span class="va">True</span>)  <span class="co"># or set_crs('EPSG:xxxx') if you know the CRS</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Spatial join to find which polygon each point falls into</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>joined <span class="op">=</span> gpd.sjoin(dengue_gdf, tn_vil_shp, how<span class="op">=</span><span class="st">'inner'</span>, predicate<span class="op">=</span><span class="st">'within'</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Tally infections per polygon (assuming 'village_id' column in tn_vil_shp identifies polygons)</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>infection_counts <span class="op">=</span> joined.groupby(<span class="st">'index_right'</span>).size()</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 6: Add infection counts back to the shapefile dataframe</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>tn_vil_shp[<span class="st">'infection_count'</span>] <span class="op">=</span> tn_vil_shp.index.<span class="bu">map</span>(infection_counts).fillna(<span class="dv">0</span>).astype(<span class="bu">int</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-25" class="cell" data-execution_count="234">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>tn_vil_shp <span class="op">=</span> tn_vil_shp.rename(columns<span class="op">=</span>{<span class="st">'infection_count'</span>:<span class="st">'Y2015_Dengue'</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-26" class="cell" data-execution_count="235">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Convert the infection dataframe to a GeoDataFrame</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>geometry <span class="op">=</span> [Point(xy) <span class="cf">for</span> xy <span class="kw">in</span> <span class="bu">zip</span>(local_tn_Dengue_2023[<span class="st">'最小統計區中心點X'</span>], local_tn_Dengue_2023[<span class="st">'最小統計區中心點Y'</span>])]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>dengue_gdf <span class="op">=</span> gpd.GeoDataFrame(local_tn_Dengue_2023, geometry<span class="op">=</span>geometry)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Ensure both GeoDataFrames have the same CRS (coordinate reference system)</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>dengue_gdf.set_crs(tn_vil_shp.crs, inplace<span class="op">=</span><span class="va">True</span>)  <span class="co"># or set_crs('EPSG:xxxx') if you know the CRS</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Spatial join to find which polygon each point falls into</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>joined <span class="op">=</span> gpd.sjoin(dengue_gdf, tn_vil_shp, how<span class="op">=</span><span class="st">'inner'</span>, predicate<span class="op">=</span><span class="st">'within'</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Tally infections per polygon (assuming 'village_id' column in tn_vil_shp identifies polygons)</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>infection_counts <span class="op">=</span> joined.groupby(<span class="st">'index_right'</span>).size()</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 6: Add infection counts back to the shapefile dataframe</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>tn_vil_shp[<span class="st">'Y2023_Dengue'</span>] <span class="op">=</span> tn_vil_shp.index.<span class="bu">map</span>(infection_counts).fillna(<span class="dv">0</span>).astype(<span class="bu">int</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-27" class="cell" data-execution_count="237">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>ovitrap_gdf <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    ovitrap_2023, </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    geometry<span class="op">=</span>gpd.points_from_xy(ovitrap_2023[<span class="st">'lon'</span>], ovitrap_2023[<span class="st">'lat'</span>]),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span><span class="st">"EPSG:4326"</span>  <span class="co"># Assuming WGS84; change if needed</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the polygons shapefile</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>tn_vil_gdf <span class="op">=</span> tn_vil_shp.copy()</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial join: add polygon info to each ovitrap point</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>joined <span class="op">=</span> gpd.sjoin(ovitrap_gdf, tn_vil_gdf, how<span class="op">=</span><span class="st">"inner"</span>, predicate<span class="op">=</span><span class="st">"within"</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by polygon index and calculate mean eggs count</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>mean_eggs <span class="op">=</span> joined.groupby(joined.index_right)[<span class="st">'AvgEggs'</span>].mean()</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new column in shapefile and fill it with mean egg counts</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>tn_vil_gdf[<span class="st">'Y2023_Ovitrap'</span>] <span class="op">=</span> tn_vil_gdf.index.<span class="bu">map</span>(mean_eggs)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: fill NaNs with 0 or any default if some polygons have no traps</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>tn_vil_gdf[<span class="st">'Y2023_Ovitrap'</span>] <span class="op">=</span> tn_vil_gdf[<span class="st">'Y2023_Ovitrap'</span>].fillna(<span class="dv">0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-28" class="cell" data-execution_count="239">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>tn_vil_gdf <span class="op">=</span> tn_vil_gdf.rename(columns<span class="op">=</span>{<span class="st">'merge_key'</span>:<span class="st">'VILLAGE_ID'</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-29" class="cell" data-execution_count="241">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>tn_vil_gdf.to_file(<span class="st">"tn_vil_dengue_ovitrap.geojson"</span>, driver<span class="op">=</span><span class="st">'GeoJSON'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-30" class="cell" data-execution_count="240">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>tn_vil_gdf</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="240">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">OBJECTID_1</th>
<th data-quarto-table-cell-role="th">VILLAGE</th>
<th data-quarto-table-cell-role="th">TOWN</th>
<th data-quarto-table-cell-role="th">COUNTY</th>
<th data-quarto-table-cell-role="th">TOWN_ID</th>
<th data-quarto-table-cell-role="th">COUNTY_ID</th>
<th data-quarto-table-cell-role="th">TV_ALL</th>
<th data-quarto-table-cell-role="th">VILLCODE</th>
<th data-quarto-table-cell-role="th">ORI_VILLAG</th>
<th data-quarto-table-cell-role="th">AREA</th>
<th data-quarto-table-cell-role="th">MAX_X</th>
<th data-quarto-table-cell-role="th">MAX_Y</th>
<th data-quarto-table-cell-role="th">MIN_X</th>
<th data-quarto-table-cell-role="th">MIN_Y</th>
<th data-quarto-table-cell-role="th">X</th>
<th data-quarto-table-cell-role="th">Y</th>
<th data-quarto-table-cell-role="th">V_ID</th>
<th data-quarto-table-cell-role="th">SORT</th>
<th data-quarto-table-cell-role="th">COUNTYNAME</th>
<th data-quarto-table-cell-role="th">TOWNNAME</th>
<th data-quarto-table-cell-role="th">OBJECTID</th>
<th data-quarto-table-cell-role="th">ORIG_FID</th>
<th data-quarto-table-cell-role="th">Shape_Leng</th>
<th data-quarto-table-cell-role="th">Shape_Le_1</th>
<th data-quarto-table-cell-role="th">Shape_Area</th>
<th data-quarto-table-cell-role="th">ET_ID</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">VILLAGE_ID</th>
<th data-quarto-table-cell-role="th">Y2023_A0A9_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A0A9_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A0A9_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A10A19_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A10A19_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A10A19_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A20A29_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A20A29_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A20A29_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A30A39_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A30A39_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A30A39_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A40A49_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A40A49_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A40A49_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A50A59_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A50A59_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A50A59_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A60A69_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A60A69_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A60A69_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A70A79_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A70A79_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A70A79_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A80A89_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A80A89_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A80A89_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A90A99_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A90A99_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A90A99_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A100UP_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A100UP_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A100UP_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A0A9_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A0A9_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A0A9_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A10A19_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A10A19_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A10A19_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A20A29_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A20A29_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A20A29_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A30A39_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A30A39_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A30A39_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A40A49_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A40A49_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A40A49_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A50A59_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A50A59_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A50A59_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A60A69_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A60A69_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A60A69_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A70A79_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A70A79_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A70A79_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A80A89_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A80A89_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A80A89_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A90A99_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A90A99_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A90A99_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A100UP_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A100UP_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A100UP_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_H_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_P_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_H_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_P_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_Dengue</th>
<th data-quarto-table-cell-role="th">Y2023_Dengue</th>
<th data-quarto-table-cell-role="th">Y2023_Ovitrap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>None</td>
<td>4377</td>
<td>內角里</td>
<td>白河區</td>
<td>臺南市</td>
<td>67000030</td>
<td>67000</td>
<td>白河區內角里</td>
<td>A6703-022-00</td>
<td>None</td>
<td>5.060602e+06</td>
<td>194875.6094</td>
<td>2.590210e+06</td>
<td>191611.3157</td>
<td>2.587656e+06</td>
<td>193316.0265</td>
<td>2.588919e+06</td>
<td>67000030-022</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>10371.873803</td>
<td>5.060602e+06</td>
<td>4375</td>
<td>POLYGON ((120.43652 23.41263, 120.43654 23.412...</td>
<td>67000030-022</td>
<td>20</td>
<td>17</td>
<td>3</td>
<td>33</td>
<td>21</td>
<td>12</td>
<td>53</td>
<td>35</td>
<td>18</td>
<td>68</td>
<td>42</td>
<td>26</td>
<td>92</td>
<td>57</td>
<td>35</td>
<td>93</td>
<td>60</td>
<td>33</td>
<td>135</td>
<td>85</td>
<td>50</td>
<td>80</td>
<td>41</td>
<td>39</td>
<td>68</td>
<td>29</td>
<td>39</td>
<td>18</td>
<td>5</td>
<td>13</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>36</td>
<td>22</td>
<td>14</td>
<td>53</td>
<td>32</td>
<td>21</td>
<td>93</td>
<td>53</td>
<td>40</td>
<td>105</td>
<td>57</td>
<td>48</td>
<td>96</td>
<td>60</td>
<td>36</td>
<td>138</td>
<td>84</td>
<td>54</td>
<td>112</td>
<td>64</td>
<td>48</td>
<td>104</td>
<td>52</td>
<td>52</td>
<td>58</td>
<td>20</td>
<td>38</td>
<td>8</td>
<td>2</td>
<td>6</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>334</td>
<td>803</td>
<td>446</td>
<td>357</td>
<td>306</td>
<td>660</td>
<td>392</td>
<td>268</td>
<td>1</td>
<td>0</td>
<td>0.000000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>None</td>
<td>4378</td>
<td>蓮潭里</td>
<td>白河區</td>
<td>臺南市</td>
<td>67000030</td>
<td>67000</td>
<td>白河區蓮潭里</td>
<td>A6703-017-00</td>
<td>None</td>
<td>4.085859e+06</td>
<td>190565.6738</td>
<td>2.590189e+06</td>
<td>187096.4815</td>
<td>2.588026e+06</td>
<td>188850.9894</td>
<td>2.589012e+06</td>
<td>67000030-017</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>10117.167850</td>
<td>4.085859e+06</td>
<td>4376</td>
<td>POLYGON ((120.40732 23.41229, 120.40751 23.412...</td>
<td>67000030-017</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>53</td>
<td>26</td>
<td>27</td>
<td>94</td>
<td>48</td>
<td>46</td>
<td>128</td>
<td>73</td>
<td>55</td>
<td>140</td>
<td>73</td>
<td>67</td>
<td>122</td>
<td>74</td>
<td>48</td>
<td>170</td>
<td>98</td>
<td>72</td>
<td>132</td>
<td>81</td>
<td>51</td>
<td>90</td>
<td>39</td>
<td>51</td>
<td>77</td>
<td>28</td>
<td>49</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>354</td>
<td>1008</td>
<td>540</td>
<td>468</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2</td>
<td>0</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>None</td>
<td>4379</td>
<td>草店里</td>
<td>白河區</td>
<td>臺南市</td>
<td>67000030</td>
<td>67000</td>
<td>白河區草店里</td>
<td>A6703-023-00</td>
<td>None</td>
<td>4.212266e+06</td>
<td>193819.2188</td>
<td>2.589503e+06</td>
<td>190486.9104</td>
<td>2.586876e+06</td>
<td>191839.8186</td>
<td>2.588119e+06</td>
<td>67000030-023</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>12639.008303</td>
<td>4.212266e+06</td>
<td>4377</td>
<td>POLYGON ((120.42996 23.40641, 120.4301 23.4064...</td>
<td>67000030-023</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>40</td>
<td>17</td>
<td>23</td>
<td>96</td>
<td>45</td>
<td>51</td>
<td>108</td>
<td>50</td>
<td>58</td>
<td>134</td>
<td>75</td>
<td>59</td>
<td>143</td>
<td>73</td>
<td>70</td>
<td>158</td>
<td>101</td>
<td>57</td>
<td>127</td>
<td>65</td>
<td>62</td>
<td>92</td>
<td>47</td>
<td>45</td>
<td>73</td>
<td>33</td>
<td>40</td>
<td>9</td>
<td>2</td>
<td>7</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>384</td>
<td>980</td>
<td>508</td>
<td>472</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.000000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>None</td>
<td>4380</td>
<td>詔安里</td>
<td>白河區</td>
<td>臺南市</td>
<td>67000030</td>
<td>67000</td>
<td>白河區詔安里</td>
<td>A6703-015-00</td>
<td>None</td>
<td>1.840815e+06</td>
<td>191048.7910</td>
<td>2.589375e+06</td>
<td>189384.3438</td>
<td>2.587185e+06</td>
<td>190190.1797</td>
<td>2.588177e+06</td>
<td>67000030-015</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>7924.371195</td>
<td>1.840815e+06</td>
<td>4378</td>
<td>POLYGON ((120.41847 23.40612, 120.41857 23.405...</td>
<td>67000030-015</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>60</td>
<td>29</td>
<td>31</td>
<td>101</td>
<td>56</td>
<td>45</td>
<td>110</td>
<td>50</td>
<td>60</td>
<td>138</td>
<td>74</td>
<td>64</td>
<td>132</td>
<td>72</td>
<td>60</td>
<td>186</td>
<td>113</td>
<td>73</td>
<td>110</td>
<td>62</td>
<td>48</td>
<td>92</td>
<td>34</td>
<td>58</td>
<td>70</td>
<td>31</td>
<td>39</td>
<td>4</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>371</td>
<td>1004</td>
<td>522</td>
<td>482</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>None</td>
<td>4381</td>
<td>嘉田里</td>
<td>後壁區</td>
<td>臺南市</td>
<td>67000050</td>
<td>67000</td>
<td>後壁區嘉田里</td>
<td>A6705-005-00</td>
<td>None</td>
<td>3.468361e+06</td>
<td>188535.3729</td>
<td>2.589238e+06</td>
<td>185946.0020</td>
<td>2.586081e+06</td>
<td>187109.3847</td>
<td>2.587550e+06</td>
<td>67000050-005</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>11353.387029</td>
<td>3.468361e+06</td>
<td>4379</td>
<td>POLYGON ((120.38221 23.40378, 120.3823 23.4038...</td>
<td>67000050-005</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>75</td>
<td>31</td>
<td>44</td>
<td>116</td>
<td>57</td>
<td>59</td>
<td>152</td>
<td>90</td>
<td>62</td>
<td>208</td>
<td>108</td>
<td>100</td>
<td>157</td>
<td>86</td>
<td>71</td>
<td>217</td>
<td>131</td>
<td>86</td>
<td>164</td>
<td>86</td>
<td>78</td>
<td>138</td>
<td>59</td>
<td>79</td>
<td>81</td>
<td>37</td>
<td>44</td>
<td>5</td>
<td>2</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>438</td>
<td>1313</td>
<td>687</td>
<td>626</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.000000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">747</th>
<td>None</td>
<td>6183</td>
<td>府南里</td>
<td>南區</td>
<td>臺南市</td>
<td>67000330</td>
<td>67000</td>
<td>南區府南里</td>
<td>A6733-034-00</td>
<td>None</td>
<td>3.603944e+05</td>
<td>167738.5165</td>
<td>2.541744e+06</td>
<td>167017.6409</td>
<td>2.540881e+06</td>
<td>167439.2019</td>
<td>2.541426e+06</td>
<td>67000330-034</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>2863.643334</td>
<td>3.603944e+05</td>
<td>6181</td>
<td>POLYGON ((120.19608 22.97502, 120.1965 22.9750...</td>
<td>67000330-034</td>
<td>313</td>
<td>154</td>
<td>159</td>
<td>446</td>
<td>223</td>
<td>223</td>
<td>521</td>
<td>276</td>
<td>245</td>
<td>816</td>
<td>396</td>
<td>420</td>
<td>993</td>
<td>515</td>
<td>478</td>
<td>738</td>
<td>346</td>
<td>392</td>
<td>861</td>
<td>384</td>
<td>477</td>
<td>501</td>
<td>227</td>
<td>274</td>
<td>158</td>
<td>60</td>
<td>98</td>
<td>24</td>
<td>8</td>
<td>16</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>423</td>
<td>210</td>
<td>213</td>
<td>482</td>
<td>260</td>
<td>222</td>
<td>786</td>
<td>371</td>
<td>415</td>
<td>1035</td>
<td>554</td>
<td>481</td>
<td>718</td>
<td>351</td>
<td>367</td>
<td>899</td>
<td>404</td>
<td>495</td>
<td>681</td>
<td>317</td>
<td>364</td>
<td>277</td>
<td>117</td>
<td>160</td>
<td>117</td>
<td>49</td>
<td>68</td>
<td>15</td>
<td>6</td>
<td>9</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>1838</td>
<td>5435</td>
<td>2639</td>
<td>2796</td>
<td>1995</td>
<td>5371</td>
<td>2589</td>
<td>2782</td>
<td>177</td>
<td>207</td>
<td>8.285799</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">748</th>
<td>None</td>
<td>6184</td>
<td>光明里</td>
<td>南區</td>
<td>臺南市</td>
<td>67000330</td>
<td>67000</td>
<td>南區光明里</td>
<td>A6733-011-00</td>
<td>None</td>
<td>1.603870e+05</td>
<td>166857.0603</td>
<td>2.541739e+06</td>
<td>166460.7077</td>
<td>2.541170e+06</td>
<td>166631.6047</td>
<td>2.541450e+06</td>
<td>67000330-011</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>1757.778310</td>
<td>1.603871e+05</td>
<td>6182</td>
<td>POLYGON ((120.18752 22.97494, 120.18753 22.974...</td>
<td>67000330-011</td>
<td>253</td>
<td>134</td>
<td>119</td>
<td>309</td>
<td>157</td>
<td>152</td>
<td>466</td>
<td>227</td>
<td>239</td>
<td>665</td>
<td>331</td>
<td>334</td>
<td>726</td>
<td>364</td>
<td>362</td>
<td>697</td>
<td>344</td>
<td>353</td>
<td>759</td>
<td>351</td>
<td>408</td>
<td>426</td>
<td>195</td>
<td>231</td>
<td>148</td>
<td>49</td>
<td>99</td>
<td>25</td>
<td>12</td>
<td>13</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>309</td>
<td>166</td>
<td>143</td>
<td>431</td>
<td>199</td>
<td>232</td>
<td>737</td>
<td>391</td>
<td>346</td>
<td>840</td>
<td>424</td>
<td>416</td>
<td>718</td>
<td>357</td>
<td>361</td>
<td>883</td>
<td>407</td>
<td>476</td>
<td>589</td>
<td>291</td>
<td>298</td>
<td>258</td>
<td>104</td>
<td>154</td>
<td>110</td>
<td>54</td>
<td>56</td>
<td>18</td>
<td>7</td>
<td>11</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1793</td>
<td>4893</td>
<td>2400</td>
<td>2493</td>
<td>1809</td>
<td>4474</td>
<td>2164</td>
<td>2310</td>
<td>126</td>
<td>118</td>
<td>6.210064</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">749</th>
<td>None</td>
<td>6185</td>
<td>崇明里</td>
<td>東區</td>
<td>臺南市</td>
<td>67000320</td>
<td>67000</td>
<td>東區崇明里</td>
<td>A6732-012-00</td>
<td>None</td>
<td>9.701465e+05</td>
<td>170604.2367</td>
<td>2.541655e+06</td>
<td>169492.1825</td>
<td>2.540591e+06</td>
<td>170091.2445</td>
<td>2.541083e+06</td>
<td>67000320-012</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>3850.791646</td>
<td>9.701465e+05</td>
<td>6183</td>
<td>POLYGON ((120.22312 22.97436, 120.22317 22.974...</td>
<td>67000320-012</td>
<td>359</td>
<td>192</td>
<td>167</td>
<td>501</td>
<td>262</td>
<td>239</td>
<td>618</td>
<td>347</td>
<td>271</td>
<td>514</td>
<td>274</td>
<td>240</td>
<td>667</td>
<td>301</td>
<td>366</td>
<td>838</td>
<td>357</td>
<td>481</td>
<td>644</td>
<td>281</td>
<td>363</td>
<td>385</td>
<td>168</td>
<td>217</td>
<td>143</td>
<td>55</td>
<td>88</td>
<td>25</td>
<td>11</td>
<td>14</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>588</td>
<td>294</td>
<td>294</td>
<td>772</td>
<td>411</td>
<td>361</td>
<td>613</td>
<td>329</td>
<td>284</td>
<td>708</td>
<td>296</td>
<td>412</td>
<td>936</td>
<td>393</td>
<td>543</td>
<td>782</td>
<td>351</td>
<td>431</td>
<td>506</td>
<td>222</td>
<td>284</td>
<td>189</td>
<td>85</td>
<td>104</td>
<td>100</td>
<td>40</td>
<td>60</td>
<td>26</td>
<td>15</td>
<td>11</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1992</td>
<td>5221</td>
<td>2437</td>
<td>2784</td>
<td>1949</td>
<td>4694</td>
<td>2248</td>
<td>2446</td>
<td>53</td>
<td>54</td>
<td>7.411960</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">750</th>
<td>None</td>
<td>6186</td>
<td>鯤鯓里</td>
<td>南區</td>
<td>臺南市</td>
<td>67000330</td>
<td>67000</td>
<td>南區鯤鯓里</td>
<td>A6733-036-00</td>
<td>None</td>
<td>3.114528e+06</td>
<td>166307.0647</td>
<td>2.541586e+06</td>
<td>162925.0156</td>
<td>2.539276e+06</td>
<td>165016.3566</td>
<td>2.540313e+06</td>
<td>67000330-036</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>10839.080585</td>
<td>3.114528e+06</td>
<td>6184</td>
<td>POLYGON ((120.16534 22.97204, 120.16536 22.972...</td>
<td>67000330-036</td>
<td>80</td>
<td>46</td>
<td>34</td>
<td>118</td>
<td>64</td>
<td>54</td>
<td>219</td>
<td>102</td>
<td>117</td>
<td>210</td>
<td>110</td>
<td>100</td>
<td>312</td>
<td>164</td>
<td>148</td>
<td>337</td>
<td>184</td>
<td>153</td>
<td>309</td>
<td>167</td>
<td>142</td>
<td>188</td>
<td>91</td>
<td>97</td>
<td>82</td>
<td>27</td>
<td>55</td>
<td>16</td>
<td>4</td>
<td>12</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>122</td>
<td>59</td>
<td>63</td>
<td>178</td>
<td>87</td>
<td>91</td>
<td>257</td>
<td>131</td>
<td>126</td>
<td>305</td>
<td>165</td>
<td>140</td>
<td>337</td>
<td>189</td>
<td>148</td>
<td>365</td>
<td>206</td>
<td>159</td>
<td>268</td>
<td>136</td>
<td>132</td>
<td>157</td>
<td>71</td>
<td>86</td>
<td>79</td>
<td>27</td>
<td>52</td>
<td>11</td>
<td>5</td>
<td>6</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>720</td>
<td>2079</td>
<td>1076</td>
<td>1003</td>
<td>686</td>
<td>1874</td>
<td>961</td>
<td>913</td>
<td>12</td>
<td>16</td>
<td>21.469600</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">751</th>
<td>None</td>
<td>7782</td>
<td>中沙里</td>
<td>安定區</td>
<td>臺南市</td>
<td>67000210</td>
<td>67000</td>
<td>安定區中沙里</td>
<td>A6721-012-00</td>
<td>None</td>
<td>1.436603e+06</td>
<td>169678.2460</td>
<td>2.553504e+06</td>
<td>167993.3594</td>
<td>2.552005e+06</td>
<td>168907.2948</td>
<td>2.552716e+06</td>
<td>67000210-012</td>
<td>4.0</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>5514.315304</td>
<td>1.436603e+06</td>
<td>7780</td>
<td>POLYGON ((120.21252 23.08121, 120.21446 23.081...</td>
<td>67000210-012</td>
<td>51</td>
<td>22</td>
<td>29</td>
<td>44</td>
<td>23</td>
<td>21</td>
<td>104</td>
<td>54</td>
<td>50</td>
<td>98</td>
<td>55</td>
<td>43</td>
<td>119</td>
<td>57</td>
<td>62</td>
<td>128</td>
<td>71</td>
<td>57</td>
<td>124</td>
<td>64</td>
<td>60</td>
<td>77</td>
<td>35</td>
<td>42</td>
<td>34</td>
<td>14</td>
<td>20</td>
<td>4</td>
<td>1</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>57</td>
<td>27</td>
<td>30</td>
<td>65</td>
<td>33</td>
<td>32</td>
<td>122</td>
<td>69</td>
<td>53</td>
<td>117</td>
<td>57</td>
<td>60</td>
<td>131</td>
<td>73</td>
<td>58</td>
<td>132</td>
<td>65</td>
<td>67</td>
<td>99</td>
<td>54</td>
<td>45</td>
<td>56</td>
<td>28</td>
<td>28</td>
<td>24</td>
<td>6</td>
<td>18</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>257</td>
<td>805</td>
<td>412</td>
<td>393</td>
<td>265</td>
<td>783</td>
<td>396</td>
<td>387</td>
<td>1</td>
<td>0</td>
<td>0.000000</td>
</tr>
</tbody>
</table>

<p>752 rows × 106 columns</p>
</div>
</div>
</div>
<div id="cell-31" class="cell" data-execution_count="168">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Create matching key once</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>tn_vil_shp[<span class="st">'MATCH_KEY'</span>] <span class="op">=</span> tn_vil_shp[<span class="st">'TOWN_ID'</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">'-'</span> <span class="op">+</span> tn_vil_shp[<span class="st">'VILLAGE_ID'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Merge 2023 data</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>tn_vil_shp <span class="op">=</span> merge_age_data(tn_vil_shp, VIL_AGE_TN_2023, <span class="st">'Y2023_'</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Merge 2015 data</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>tn_vil_shp <span class="op">=</span> merge_age_data(tn_vil_shp, VIL_AGE_TN_2015, <span class="st">'Y2015_'</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Optional — drop the MATCH_KEY if no longer needed</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>tn_vil_shp <span class="op">=</span> tn_vil_shp.drop(columns<span class="op">=</span>[<span class="st">'MATCH_KEY'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[168]</span><span class="ansi-green-fg">, line 5</span>
<span class="ansi-green-fg">      2</span> tn_vil_shp[<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">MATCH_KEY</span><span class="ansi-yellow-fg">'</span>] = tn_vil_shp[<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">TOWN_ID</span><span class="ansi-yellow-fg">'</span>].astype(<span style="color:rgb(0,135,0)">str</span>) + <span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">-</span><span class="ansi-yellow-fg">'</span> + tn_vil_shp[<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">VILLAGE_ID</span><span class="ansi-yellow-fg">'</span>].astype(<span style="color:rgb(0,135,0)">str</span>)
<span class="ansi-green-fg">      4</span> <span style="font-style:italic;color:rgb(95,135,135)"># Step 2: Merge 2023 data</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">5</span> tn_vil_shp = <span class="ansi-yellow-bg">merge_age_data</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">tn_vil_shp</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">VIL_AGE_TN_2023</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-fg ansi-yellow-bg">Y2023_</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">      7</span> <span style="font-style:italic;color:rgb(95,135,135)"># Step 3: Merge 2015 data</span>
<span class="ansi-green-fg">      8</span> tn_vil_shp = merge_age_data(tn_vil_shp, VIL_AGE_TN_2015, <span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">Y2015_</span><span class="ansi-yellow-fg">'</span>)

<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[167]</span><span class="ansi-green-fg">, line 22</span>, in <span class="ansi-cyan-fg">merge_age_data</span><span class="ansi-blue-fg">(tn_vil_shp, age_df, year_prefix)</span>
<span class="ansi-green-fg">     14</span> age_data = age_data.rename(columns={col: <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">'</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>year_prefix<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span class="ansi-yellow-fg">_</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>col<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span class="ansi-yellow-fg">'</span> <span style="font-weight:bold;color:rgb(0,135,0)">for</span> col <span style="font-weight:bold;color:rgb(175,0,255)">in</span> cols_to_add})
<span class="ansi-green-fg">     16</span> <span style="font-style:italic;color:rgb(95,135,135)"># Merge ONLY using VILLAGE_ID as key, without bringing it over</span>
<span class="ansi-green-fg">     17</span> tn_vil_shp = <span class="ansi-yellow-bg">tn_vil_shp</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">merge</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">     18</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">age_data</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">     19</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">how</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-fg ansi-yellow-bg">left</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">     20</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">left_on</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-fg ansi-yellow-bg">MATCH_KEY</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">     21</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">right_on</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-fg ansi-yellow-bg">VILLAGE_ID</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span>
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">22</span> <span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">drop</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">columns</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-fg ansi-yellow-bg">VILLAGE_ID</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">)</span>  <span style="font-style:italic;color:rgb(95,135,135)"># Drop only the one from age_data</span>
<span class="ansi-green-fg">     24</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> tn_vil_shp

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">d:\Projects\TMU\gee_dengue\.conda\Lib\site-packages\pandas\core\frame.py:5581</span>, in <span class="ansi-cyan-fg">DataFrame.drop</span><span class="ansi-blue-fg">(self, labels, axis, index, columns, level, inplace, errors)</span>
<span class="ansi-green-fg">   5433</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">drop</span>(
<span class="ansi-green-fg">   5434</span>     <span style="color:rgb(0,135,0)">self</span>,
<span class="ansi-green-fg">   5435</span>     labels: IndexLabel | <span style="font-weight:bold;color:rgb(0,135,0)">None</span> = <span style="font-weight:bold;color:rgb(0,135,0)">None</span>,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">   5442</span>     errors: IgnoreRaise = <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">raise</span><span class="ansi-yellow-fg">"</span>,
<span class="ansi-green-fg">   5443</span> ) -&gt; DataFrame | <span style="font-weight:bold;color:rgb(0,135,0)">None</span>:
<span class="ansi-green-fg">   5444</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">   5445</span> <span style="font-style:italic" class="ansi-yellow-fg">    Drop specified labels from rows or columns.</span>
<span class="ansi-green-fg">   5446</span> 
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">   5579</span> <span style="font-style:italic" class="ansi-yellow-fg">            weight  1.0     0.8</span>
<span class="ansi-green-fg">   5580</span> <span style="font-style:italic" class="ansi-yellow-fg">    """</span>
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">5581</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">super</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">drop</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">   5582</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">labels</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">labels</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   5583</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">axis</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">axis</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   5584</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">index</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">index</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   5585</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">columns</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">columns</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   5586</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">level</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">level</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   5587</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">inplace</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">inplace</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   5588</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">errors</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">errors</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   5589</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">d:\Projects\TMU\gee_dengue\.conda\Lib\site-packages\pandas\core\generic.py:4788</span>, in <span class="ansi-cyan-fg">NDFrame.drop</span><span class="ansi-blue-fg">(self, labels, axis, index, columns, level, inplace, errors)</span>
<span class="ansi-green-fg">   4786</span> <span style="font-weight:bold;color:rgb(0,135,0)">for</span> axis, labels <span style="font-weight:bold;color:rgb(175,0,255)">in</span> axes.items():
<span class="ansi-green-fg">   4787</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> labels <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>:
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">4788</span>         obj = <span class="ansi-yellow-bg">obj</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_drop_axis</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">labels</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">axis</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">level</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">level</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">errors</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">errors</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   4790</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> inplace:
<span class="ansi-green-fg">   4791</span>     <span style="color:rgb(0,135,0)">self</span>._update_inplace(obj)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">d:\Projects\TMU\gee_dengue\.conda\Lib\site-packages\pandas\core\generic.py:4830</span>, in <span class="ansi-cyan-fg">NDFrame._drop_axis</span><span class="ansi-blue-fg">(self, labels, axis, level, errors, only_slice)</span>
<span class="ansi-green-fg">   4828</span>         new_axis = axis.drop(labels, level=level, errors=errors)
<span class="ansi-green-fg">   4829</span>     <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">4830</span>         new_axis = <span class="ansi-yellow-bg">axis</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">drop</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">labels</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">errors</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">errors</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   4831</span>     indexer = axis.get_indexer(new_axis)
<span class="ansi-green-fg">   4833</span> <span style="font-style:italic;color:rgb(95,135,135)"># Case for non-unique axis</span>
<span class="ansi-green-fg">   4834</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">d:\Projects\TMU\gee_dengue\.conda\Lib\site-packages\pandas\core\indexes\base.py:7070</span>, in <span class="ansi-cyan-fg">Index.drop</span><span class="ansi-blue-fg">(self, labels, errors)</span>
<span class="ansi-green-fg">   7068</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> mask.any():
<span class="ansi-green-fg">   7069</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> errors != <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">ignore</span><span class="ansi-yellow-fg">"</span>:
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">7070</span>         <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(<span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">"</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>labels[mask].tolist()<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span class="ansi-yellow-fg"> not found in axis</span><span class="ansi-yellow-fg">"</span>)
<span class="ansi-green-fg">   7071</span>     indexer = indexer[~mask]
<span class="ansi-green-fg">   7072</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span>.delete(indexer)

<span class="ansi-red-fg">KeyError</span>: "['VILLAGE_ID'] not found in axis"</pre>
</div>
</div>
</div>
<div id="cell-32" class="cell" data-execution_count="38">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>tn_Dengue_Daily <span class="op">=</span> Dengue_Daily[Dengue_Daily[<span class="st">'居住縣市'</span>]<span class="op">==</span><span class="st">'台南市'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-33" class="cell" data-execution_count="46">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>tn_Dengue_Daily[<span class="st">'Year'</span>] <span class="op">=</span> pd.to_datetime(tn_Dengue_Daily[<span class="st">'發病日'</span>]).dt.year</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Patrick\AppData\Local\Temp\ipykernel_35708\3613562509.py:1: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  tn_Dengue_Daily['Year'] = pd.to_datetime(tn_Dengue_Daily['發病日']).dt.year</code></pre>
</div>
</div>
<div id="cell-34" class="cell" data-execution_count="51">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>tn_Dengue_2015 <span class="op">=</span> tn_Dengue_Daily[tn_Dengue_Daily[<span class="st">'Year'</span>]<span class="op">==</span><span class="dv">2015</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>tn_Dengue_2023 <span class="op">=</span> tn_Dengue_Daily[tn_Dengue_Daily[<span class="st">'Year'</span>]<span class="op">==</span><span class="dv">2023</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-35" class="cell" data-execution_count="58">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>tn_Dengue_2015[<span class="st">'是否境外移入'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>0        否
1        是
2        是
3        是
4        否
        ..
22771    否
22772    否
22773    否
22774    否
22775    否
Name: 是否境外移入, Length: 22776, dtype: object</code></pre>
</div>
</div>
<div id="cell-36" class="cell" data-execution_count="63">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>local_tn_Dengue_2015 <span class="op">=</span> tn_Dengue_2015[tn_Dengue_2015[<span class="st">'是否境外移入'</span>]<span class="op">==</span><span class="st">'否'</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>local_tn_Dengue_2023 <span class="op">=</span> tn_Dengue_2023[tn_Dengue_2023[<span class="st">'是否境外移入'</span>]<span class="op">==</span><span class="st">'否'</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-37" class="cell" data-execution_count="66">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>ovitrap <span class="op">=</span> pd.read_csv(<span class="vs">r"D:</span><span class="er">\</span><span class="vs">Projects</span><span class="er">\</span><span class="vs">TMU</span><span class="er">\</span><span class="vs">gee_dengue</span><span class="dv">\d</span><span class="vs">ata</span><span class="ch">\r</span><span class="vs">aw</span><span class="er">\</span><span class="vs">TW_DENGUE</span><span class="er">\</span><span class="vs">ovitrap_data_origin</span><span class="dv">.</span><span class="vs">csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Patrick\AppData\Local\Temp\ipykernel_35708\1990226388.py:1: DtypeWarning: Columns (9) have mixed types. Specify dtype option on import or set low_memory=False.
  ovitrap = pd.read_csv(r"D:\Projects\TMU\gee_dengue\data\raw\TW_DENGUE\ovitrap_data_origin.csv")</code></pre>
</div>
</div>
<div id="cell-38" class="cell" data-execution_count="70">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Transform different EPSG, as SHP files from Taiwanese official sources often use a different projection</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyproj <span class="im">import</span> Transformer</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>transformer <span class="op">=</span> Transformer.from_crs(<span class="st">"EPSG:3826"</span>, <span class="st">"EPSG:4326"</span>, always_xy<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>ovitrap[[<span class="st">'lon'</span>,<span class="st">'lat'</span>]] <span class="op">=</span> ovitrap.<span class="bu">apply</span>(</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> row: pd.Series(transformer.transform(row[<span class="st">'X'</span>], row[<span class="st">'Y'</span>])),</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    axis<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-39" class="cell" data-execution_count="71">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter Plot of Longitude and Latitude</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(ovitrap[<span class="st">'lon'</span>], ovitrap[<span class="st">'lat'</span>], alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolors<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Scatter Plot of Longitude and Latitude'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Longitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Latitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograms for Longitude and Latitude</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Longitude histogram</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].hist(ovitrap[<span class="st">'lon'</span>], bins<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'skyblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Longitude Distribution'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Longitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Frequency'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Latitude histogram</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].hist(ovitrap[<span class="st">'lat'</span>], bins<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'salmon'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Latitude Distribution'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Latitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Frequency'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleaning the data: Removing outliers</span></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>valid_lon <span class="op">=</span> ovitrap[<span class="st">'lon'</span>].between(<span class="dv">120</span>, <span class="dv">121</span>)</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>valid_lat <span class="op">=</span> ovitrap[<span class="st">'lat'</span>].between(<span class="dv">20</span>, <span class="dv">25</span>)</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>cleaned_ovitrap <span class="op">=</span> ovitrap[valid_lon <span class="op">&amp;</span> valid_lat]</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>invalid_lon <span class="op">=</span> <span class="op">~</span>ovitrap[<span class="st">'lon'</span>].between(<span class="dv">120</span>, <span class="dv">121</span>)</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>invalid_lat <span class="op">=</span> <span class="op">~</span>ovitrap[<span class="st">'lat'</span>].between(<span class="dv">20</span>, <span class="dv">25</span>)</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Outliers DataFrame</span></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>outliers <span class="op">=</span> ovitrap[invalid_lon <span class="op">|</span> invalid_lat]</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Error comes from XY being directly longtitude and latitude</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tn_dengue_cleaning_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tn_dengue_cleaning_files/figure-html/cell-40-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-40" class="cell" data-execution_count="72">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correction for Outliers Data -&gt; Use XY as lon-lat directly</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>outliers[<span class="st">'lon'</span>] <span class="op">=</span> outliers[<span class="st">'X'</span>]</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>outliers[<span class="st">'lat'</span>] <span class="op">=</span> outliers[<span class="st">'Y'</span>]</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>cleaned_ovitrap <span class="op">=</span> pd.concat([cleaned_ovitrap, outliers])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Patrick\AppData\Local\Temp\ipykernel_35708\426182415.py:2: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  outliers['lon'] = outliers['X']
C:\Users\Patrick\AppData\Local\Temp\ipykernel_35708\426182415.py:3: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  outliers['lat'] = outliers['Y']</code></pre>
</div>
</div>
<div id="cell-41" class="cell" data-execution_count="73">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter Plot of Longitude and Latitude</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(cleaned_ovitrap[<span class="st">'lon'</span>], cleaned_ovitrap[<span class="st">'lat'</span>], alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolors<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Scatter Plot of Longitude and Latitude'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Longitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Latitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograms for Longitude and Latitude</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Longitude histogram</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].hist(cleaned_ovitrap[<span class="st">'lon'</span>], bins<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'skyblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Longitude Distribution'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Longitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Frequency'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Latitude histogram</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].hist(cleaned_ovitrap[<span class="st">'lat'</span>], bins<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'salmon'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Latitude Distribution'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Latitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Frequency'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tn_dengue_cleaning_files/figure-html/cell-42-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tn_dengue_cleaning_files/figure-html/cell-42-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-42" class="cell" data-execution_count="76">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>cleaned_ovitrap[<span class="st">'Year'</span>] <span class="op">=</span> pd.to_datetime(cleaned_ovitrap[<span class="st">'StartTime'</span>]).dt.year</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>ovitrap_2023 <span class="op">=</span> cleaned_ovitrap[cleaned_ovitrap[<span class="st">'Year'</span>]<span class="op">==</span><span class="dv">2023</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-43" class="cell" data-execution_count="137">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>ovitrap_gdf <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    ovitrap_2023, </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    geometry<span class="op">=</span>gpd.points_from_xy(ovitrap_2023[<span class="st">'lon'</span>], ovitrap_2023[<span class="st">'lat'</span>]),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span><span class="st">"EPSG:4326"</span>  <span class="co"># Assuming WGS84; change if needed</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the polygons shapefile</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>tn_bsa_gdf <span class="op">=</span> tn_bsa_shp.copy()</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial join: add polygon info to each ovitrap point</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>joined <span class="op">=</span> gpd.sjoin(ovitrap_gdf, tn_bsa_gdf, how<span class="op">=</span><span class="st">"inner"</span>, predicate<span class="op">=</span><span class="st">"within"</span>)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by polygon index and calculate mean eggs count</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>mean_eggs <span class="op">=</span> joined.groupby(joined.index_right)[<span class="st">'AvgEggs'</span>].mean()</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new column in shapefile and fill it with mean egg counts</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>tn_bsa_gdf[<span class="st">'Y2023_Ovitrap'</span>] <span class="op">=</span> tn_bsa_gdf.index.<span class="bu">map</span>(mean_eggs)</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: fill NaNs with 0 or any default if some polygons have no traps</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>tn_bsa_gdf[<span class="st">'Y2023_Ovitrap'</span>] <span class="op">=</span> tn_bsa_gdf[<span class="st">'Y2023_Ovitrap'</span>].fillna(<span class="dv">0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-44" class="cell" data-execution_count="144">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>tn_bsa_gdf.to_file(<span class="st">"tn_bsa_dengue_ovitrap.geojson"</span>, driver<span class="op">=</span><span class="st">'GeoJSON'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-45" class="cell" data-execution_count="119">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Count infections per region code</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>infection_counts <span class="op">=</span> local_tn_Dengue_2015[<span class="st">'最小統計區'</span>].value_counts().reset_index()</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>infection_counts.columns <span class="op">=</span> [<span class="st">'region_code'</span>, <span class="st">'dengue_count'</span>]</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Merge counts with shapefile dataframe</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure both codes are strings for a proper match</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>tn_bsa_shp[<span class="st">'CODEBASE'</span>] <span class="op">=</span> tn_bsa_shp[<span class="st">'CODEBASE'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>infection_counts[<span class="st">'region_code'</span>] <span class="op">=</span> infection_counts[<span class="st">'region_code'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join shapefile with counts</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>tn_bsa_shp <span class="op">=</span> tn_bsa_shp.merge(</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    infection_counts,</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span><span class="st">'CODEBASE'</span>,</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span><span class="st">'region_code'</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Fill NaN (regions with no cases) with 0 and store in new column</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>tn_bsa_shp[<span class="st">'dengue_2015'</span>] <span class="op">=</span> tn_bsa_shp[<span class="st">'dengue_count'</span>].fillna(<span class="dv">0</span>).astype(<span class="bu">int</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-46" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>tn_bsa_shp.to_file(<span class="st">'tn_bsa_shp_age_pop_dengue_ovitrap.csv'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="116">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U_ID</th>
<th data-quarto-table-cell-role="th">CODEBASE</th>
<th data-quarto-table-cell-role="th">CODE1</th>
<th data-quarto-table-cell-role="th">CODE2</th>
<th data-quarto-table-cell-role="th">TOWN_ID</th>
<th data-quarto-table-cell-role="th">TOWN</th>
<th data-quarto-table-cell-role="th">COUNTY_ID</th>
<th data-quarto-table-cell-role="th">COUNTY</th>
<th data-quarto-table-cell-role="th">X</th>
<th data-quarto-table-cell-role="th">Y</th>
<th data-quarto-table-cell-role="th">AREA</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">Y2023_A0A9_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A0A9_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A0A9_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A10A19_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A10A19_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A10A19_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A20A29_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A20A29_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A20A29_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A30A39_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A30A39_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A30A39_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A40A49_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A40A49_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A40A49_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A50A59_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A50A59_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A50A59_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A60A69_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A60A69_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A60A69_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A70A79_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A70A79_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A70A79_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A80A89_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A80A89_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A80A89_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A90A99_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A90A99_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A90A99_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A100UP_10_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A100UP_M_10_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_A100UP_F_10_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A0A9_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A0A9_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A0A9_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A10A19_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A10A19_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A10A19_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A20A29_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A20A29_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A20A29_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A30A39_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A30A39_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A30A39_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A40A49_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A40A49_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A40A49_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A50A59_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A50A59_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A50A59_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A60A69_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A60A69_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A60A69_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A70A79_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A70A79_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A70A79_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A80A89_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A80A89_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A80A89_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A90A99_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A90A99_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A90A99_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A100UP_10_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A100UP_M_10_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_A100UP_F_10_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_H_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_P_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_H_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_P_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_F_CNT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1519</td>
<td>A6713-0044-00</td>
<td>A6713-03-004</td>
<td>A6713-03</td>
<td>67000130</td>
<td>學甲區</td>
<td>67000</td>
<td>臺南市</td>
<td>167095.16348</td>
<td>2.573509e+06</td>
<td>2.409279e+06</td>
<td>POLYGON Z ((120.17383 23.2717 0, 120.17414 23....</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1520</td>
<td>A6706-0169-00</td>
<td>A6706-10-004</td>
<td>A6706-10</td>
<td>67000060</td>
<td>東山區</td>
<td>67000</td>
<td>臺南市</td>
<td>195790.88048</td>
<td>2.574560e+06</td>
<td>1.871302e+05</td>
<td>POLYGON Z ((120.46841 23.27525 0, 120.46847 23...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>5</td>
<td>3</td>
<td>2</td>
<td>8</td>
<td>4</td>
<td>4</td>
<td>7</td>
<td>4</td>
<td>3</td>
<td>5</td>
<td>3</td>
<td>2</td>
<td>9</td>
<td>5</td>
<td>4</td>
<td>5</td>
<td>2</td>
<td>3</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>4</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>4</td>
<td>2</td>
<td>2</td>
<td>9</td>
<td>5</td>
<td>4</td>
<td>3</td>
<td>3</td>
<td>0</td>
<td>8</td>
<td>3</td>
<td>5</td>
<td>9</td>
<td>5</td>
<td>4</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>6</td>
<td>4</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>13</td>
<td>45</td>
<td>25</td>
<td>20</td>
<td>12</td>
<td>44</td>
<td>25</td>
<td>19</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1521</td>
<td>A6704-0124-00</td>
<td>A6704-07-007</td>
<td>A6704-07</td>
<td>67000040</td>
<td>柳營區</td>
<td>67000</td>
<td>臺南市</td>
<td>178154.64243</td>
<td>2.574746e+06</td>
<td>5.917852e+04</td>
<td>POLYGON Z ((120.29947 23.27444 0, 120.29947 23...</td>
<td>8</td>
<td>5</td>
<td>3</td>
<td>7</td>
<td>6</td>
<td>1</td>
<td>22</td>
<td>13</td>
<td>9</td>
<td>33</td>
<td>18</td>
<td>15</td>
<td>27</td>
<td>14</td>
<td>13</td>
<td>29</td>
<td>14</td>
<td>15</td>
<td>24</td>
<td>15</td>
<td>9</td>
<td>18</td>
<td>9</td>
<td>9</td>
<td>17</td>
<td>8</td>
<td>9</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>5</td>
<td>2</td>
<td>3</td>
<td>14</td>
<td>11</td>
<td>3</td>
<td>35</td>
<td>20</td>
<td>15</td>
<td>15</td>
<td>8</td>
<td>7</td>
<td>24</td>
<td>8</td>
<td>16</td>
<td>32</td>
<td>24</td>
<td>8</td>
<td>24</td>
<td>12</td>
<td>12</td>
<td>25</td>
<td>12</td>
<td>13</td>
<td>6</td>
<td>2</td>
<td>4</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>80</td>
<td>187</td>
<td>103</td>
<td>84</td>
<td>74</td>
<td>183</td>
<td>101</td>
<td>82</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1522</td>
<td>A6701-0425-00</td>
<td>A6701-27-006</td>
<td>A6701-27</td>
<td>67000010</td>
<td>新營區</td>
<td>67000</td>
<td>臺南市</td>
<td>175860.08597</td>
<td>2.574747e+06</td>
<td>2.694759e+04</td>
<td>POLYGON Z ((120.27531 23.27419 0, 120.27567 23...</td>
<td>6</td>
<td>1</td>
<td>5</td>
<td>8</td>
<td>6</td>
<td>2</td>
<td>20</td>
<td>15</td>
<td>5</td>
<td>18</td>
<td>12</td>
<td>6</td>
<td>12</td>
<td>5</td>
<td>7</td>
<td>22</td>
<td>11</td>
<td>11</td>
<td>14</td>
<td>8</td>
<td>6</td>
<td>8</td>
<td>4</td>
<td>4</td>
<td>6</td>
<td>4</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>4</td>
<td>1</td>
<td>3</td>
<td>17</td>
<td>10</td>
<td>7</td>
<td>15</td>
<td>10</td>
<td>5</td>
<td>9</td>
<td>6</td>
<td>3</td>
<td>21</td>
<td>8</td>
<td>13</td>
<td>19</td>
<td>12</td>
<td>7</td>
<td>8</td>
<td>7</td>
<td>1</td>
<td>11</td>
<td>5</td>
<td>6</td>
<td>9</td>
<td>3</td>
<td>6</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>51</td>
<td>114</td>
<td>66</td>
<td>48</td>
<td>46</td>
<td>114</td>
<td>62</td>
<td>52</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1593</td>
<td>A6706-0182-00</td>
<td>A6706-10-005</td>
<td>A6706-10</td>
<td>67000060</td>
<td>東山區</td>
<td>67000</td>
<td>臺南市</td>
<td>195370.86654</td>
<td>2.573953e+06</td>
<td>1.849167e+05</td>
<td>POLYGON Z ((120.4688 23.26962 0, 120.46887 23....</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>4</td>
<td>2</td>
<td>2</td>
<td>9</td>
<td>4</td>
<td>5</td>
<td>7</td>
<td>4</td>
<td>3</td>
<td>10</td>
<td>7</td>
<td>3</td>
<td>6</td>
<td>3</td>
<td>3</td>
<td>8</td>
<td>4</td>
<td>4</td>
<td>3</td>
<td>0</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>6</td>
<td>5</td>
<td>1</td>
<td>6</td>
<td>3</td>
<td>3</td>
<td>9</td>
<td>2</td>
<td>7</td>
<td>12</td>
<td>8</td>
<td>4</td>
<td>6</td>
<td>3</td>
<td>3</td>
<td>11</td>
<td>6</td>
<td>5</td>
<td>8</td>
<td>5</td>
<td>3</td>
<td>9</td>
<td>4</td>
<td>5</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>20</td>
<td>50</td>
<td>25</td>
<td>25</td>
<td>22</td>
<td>70</td>
<td>36</td>
<td>34</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12769</th>
<td>3108</td>
<td>A6710-0138-00</td>
<td>A6710-07-004</td>
<td>A6710-07</td>
<td>67000100</td>
<td>官田區</td>
<td>67000</td>
<td>臺南市</td>
<td>179864.54916</td>
<td>2.564638e+06</td>
<td>4.500631e+05</td>
<td>POLYGON Z ((120.31738 23.1852 0, 120.31813 23....</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">12770</th>
<td>3109</td>
<td>A6707-0157-00</td>
<td>A6707-05-006</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173376.00015</td>
<td>2.564946e+06</td>
<td>1.006336e+04</td>
<td>POLYGON Z ((120.25085 23.18521 0, 120.25103 23...</td>
<td>7</td>
<td>3</td>
<td>4</td>
<td>19</td>
<td>6</td>
<td>13</td>
<td>9</td>
<td>5</td>
<td>4</td>
<td>11</td>
<td>8</td>
<td>3</td>
<td>24</td>
<td>16</td>
<td>8</td>
<td>15</td>
<td>5</td>
<td>10</td>
<td>13</td>
<td>4</td>
<td>9</td>
<td>13</td>
<td>5</td>
<td>8</td>
<td>7</td>
<td>4</td>
<td>3</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>13</td>
<td>6</td>
<td>7</td>
<td>15</td>
<td>8</td>
<td>7</td>
<td>8</td>
<td>4</td>
<td>4</td>
<td>20</td>
<td>12</td>
<td>8</td>
<td>14</td>
<td>5</td>
<td>9</td>
<td>19</td>
<td>10</td>
<td>9</td>
<td>18</td>
<td>7</td>
<td>11</td>
<td>11</td>
<td>6</td>
<td>5</td>
<td>4</td>
<td>0</td>
<td>4</td>
<td>4</td>
<td>1</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>46</td>
<td>120</td>
<td>56</td>
<td>64</td>
<td>46</td>
<td>126</td>
<td>59</td>
<td>67</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12771</th>
<td>3110</td>
<td>A6707-0163-00</td>
<td>A6707-05-007</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173493.29866</td>
<td>2.564901e+06</td>
<td>2.001176e+04</td>
<td>POLYGON Z ((120.2524 23.18523 0, 120.25242 23....</td>
<td>29</td>
<td>17</td>
<td>12</td>
<td>50</td>
<td>19</td>
<td>31</td>
<td>48</td>
<td>22</td>
<td>26</td>
<td>54</td>
<td>27</td>
<td>27</td>
<td>74</td>
<td>30</td>
<td>44</td>
<td>63</td>
<td>24</td>
<td>39</td>
<td>57</td>
<td>25</td>
<td>32</td>
<td>35</td>
<td>16</td>
<td>19</td>
<td>18</td>
<td>6</td>
<td>12</td>
<td>4</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>43</td>
<td>18</td>
<td>25</td>
<td>62</td>
<td>31</td>
<td>31</td>
<td>67</td>
<td>40</td>
<td>27</td>
<td>71</td>
<td>27</td>
<td>44</td>
<td>56</td>
<td>23</td>
<td>33</td>
<td>63</td>
<td>29</td>
<td>34</td>
<td>44</td>
<td>21</td>
<td>23</td>
<td>20</td>
<td>7</td>
<td>13</td>
<td>14</td>
<td>7</td>
<td>7</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>175</td>
<td>432</td>
<td>188</td>
<td>244</td>
<td>168</td>
<td>441</td>
<td>203</td>
<td>238</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">12772</th>
<td>3111</td>
<td>A6707-0164-00</td>
<td>A6707-05-008</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173594.45705</td>
<td>2.564904e+06</td>
<td>1.244706e+04</td>
<td>POLYGON Z ((120.25325 23.18522 0, 120.25395 23...</td>
<td>7</td>
<td>6</td>
<td>1</td>
<td>7</td>
<td>6</td>
<td>1</td>
<td>7</td>
<td>4</td>
<td>3</td>
<td>10</td>
<td>5</td>
<td>5</td>
<td>16</td>
<td>7</td>
<td>9</td>
<td>10</td>
<td>5</td>
<td>5</td>
<td>13</td>
<td>8</td>
<td>5</td>
<td>11</td>
<td>6</td>
<td>5</td>
<td>8</td>
<td>5</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>8</td>
<td>5</td>
<td>3</td>
<td>8</td>
<td>4</td>
<td>4</td>
<td>8</td>
<td>7</td>
<td>1</td>
<td>19</td>
<td>8</td>
<td>11</td>
<td>15</td>
<td>5</td>
<td>10</td>
<td>13</td>
<td>11</td>
<td>2</td>
<td>19</td>
<td>8</td>
<td>11</td>
<td>12</td>
<td>4</td>
<td>8</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>36</td>
<td>89</td>
<td>52</td>
<td>37</td>
<td>37</td>
<td>105</td>
<td>53</td>
<td>52</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12773</th>
<td>3112</td>
<td>A6707-0165-00</td>
<td>A6707-05-009</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173714.55187</td>
<td>2.564907e+06</td>
<td>1.894120e+04</td>
<td>POLYGON Z ((120.25395 23.18522 0, 120.25414 23...</td>
<td>19</td>
<td>11</td>
<td>8</td>
<td>16</td>
<td>9</td>
<td>7</td>
<td>36</td>
<td>20</td>
<td>16</td>
<td>33</td>
<td>15</td>
<td>18</td>
<td>27</td>
<td>13</td>
<td>14</td>
<td>36</td>
<td>18</td>
<td>18</td>
<td>41</td>
<td>21</td>
<td>20</td>
<td>14</td>
<td>9</td>
<td>5</td>
<td>5</td>
<td>3</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>17</td>
<td>10</td>
<td>7</td>
<td>40</td>
<td>21</td>
<td>19</td>
<td>35</td>
<td>15</td>
<td>20</td>
<td>31</td>
<td>16</td>
<td>15</td>
<td>35</td>
<td>18</td>
<td>17</td>
<td>37</td>
<td>20</td>
<td>17</td>
<td>19</td>
<td>11</td>
<td>8</td>
<td>10</td>
<td>7</td>
<td>3</td>
<td>4</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>71</td>
<td>229</td>
<td>120</td>
<td>109</td>
<td>68</td>
<td>228</td>
<td>120</td>
<td>108</td>
</tr>
</tbody>
</table>

<p>12774 rows × 86 columns</p>
</div>
</div>
</div>
<div id="cell-47" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the base directory</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>base_dir <span class="op">=</span> RAW_DIR <span class="op">/</span> <span class="st">"TW_DENGUE"</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dictionaries to store the data</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>pop_data <span class="op">=</span> {}</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>demo_data <span class="op">=</span> {}</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Walk through the directory to find all CSV files</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> root, dirs, files <span class="kw">in</span> os.walk(base_dir):</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">".csv"</span>):</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>            file_path <span class="op">=</span> os.path.join(root, <span class="bu">file</span>)</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Check if it's population or demographic based on the path</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">"BSA_population_TN"</span> <span class="kw">in</span> file_path:</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>                data_dict <span class="op">=</span> pop_data</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>                prefix <span class="op">=</span> <span class="st">"pop"</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="st">"BSA_demographic_TN"</span> <span class="kw">in</span> file_path:</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>                data_dict <span class="op">=</span> demo_data</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>                prefix <span class="op">=</span> <span class="st">"demo"</span></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span>  <span class="co"># Skip files not in the desired folders</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Extract the first number before '年'</span></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>                number <span class="op">=</span> <span class="bu">int</span>(<span class="st">''</span>.join(<span class="bu">filter</span>(<span class="bu">str</span>.isdigit, <span class="bu">file</span>.split(<span class="st">"年"</span>)[<span class="dv">0</span>])))</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>                year <span class="op">=</span> number <span class="op">+</span> <span class="dv">1911</span></span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"Failed to extract year from </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Attempt to read the file with both encodings</span></span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> encoding <span class="kw">in</span> [<span class="st">"utf-8"</span>, <span class="st">"big5"</span>]:</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>                    df <span class="op">=</span> pd.read_csv(file_path, encoding<span class="op">=</span>encoding)</span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>                    data_dict[year] <span class="op">=</span> df</span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Loaded </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">) using </span><span class="sc">{</span>encoding<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Failed to read </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss"> with </span><span class="sc">{</span>encoding<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Failed to read 102年12月臺南市統計區人口指標_最小統計區.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded 102年12月臺南市統計區人口指標_最小統計區.csv (demo_2013) using big5.
Failed to read 103年6月臺南市統計區人口指標_最小統計區.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded 103年6月臺南市統計區人口指標_最小統計區.csv (demo_2014) using big5.
Failed to read 105年6月臺南市統計區人口指標_最小統計區.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded 105年6月臺南市統計區人口指標_最小統計區.csv (demo_2016) using big5.
Failed to read 106年12月臺南市統計區人口指標_最小統計區.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded 106年12月臺南市統計區人口指標_最小統計區.csv (demo_2017) using big5.
Failed to read 107年12月臺南市統計區人口指標_最小統計區.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded 107年12月臺南市統計區人口指標_最小統計區.csv (demo_2018) using big5.
Failed to read 108年6月臺南市統計區人口指標_最小統計區.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded 108年6月臺南市統計區人口指標_最小統計區.csv (demo_2019) using big5.
Failed to read 109年6月臺南市統計區人口指標_最小統計區.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded 109年6月臺南市統計區人口指標_最小統計區.csv (demo_2020) using big5.
Failed to read 110年12月臺南市統計區人口指標_最小統計區.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded 110年12月臺南市統計區人口指標_最小統計區.csv (demo_2021) using big5.
Failed to read 111年6月臺南市統計區人口指標_最小統計區.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded 111年6月臺南市統計區人口指標_最小統計區.csv (demo_2022) using big5.
Loaded 113年12月臺南市統計區人口指標_最小統計區.csv (demo_2024) using utf-8.
Failed to read 105年12月臺南市統計區人口統計_最小統計區.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded 105年12月臺南市統計區人口統計_最小統計區.csv (pop_2016) using big5.
Loaded 106年12月臺南市統計區人口統計_最小統計區.csv (pop_2017) using utf-8.
Failed to read 107年12月臺南市統計區人口統計_最小統計區.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded 107年12月臺南市統計區人口統計_最小統計區.csv (pop_2018) using big5.
Failed to read 108年12月臺南市統計區人口統計_最小統計區.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded 108年12月臺南市統計區人口統計_最小統計區.csv (pop_2019) using big5.
Failed to read 109年12月臺南市統計區人口統計_最小統計區.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded 109年12月臺南市統計區人口統計_最小統計區.csv (pop_2020) using big5.
Failed to read 110年12月臺南市統計區人口統計_最小統計區.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded 110年12月臺南市統計區人口統計_最小統計區.csv (pop_2021) using big5.
Failed to read 111年6月臺南市統計區人口統計_最小統計區.csv with utf-8: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Loaded 111年6月臺南市統計區人口統計_最小統計區.csv (pop_2022) using big5.</code></pre>
</div>
</div>
<div id="cell-48" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">'''Import CSV Files of Basic Statistics Area and their Population'''</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Directory containing the nested folders</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>pop_dir <span class="op">=</span> RAW_DIR <span class="op">/</span> <span class="st">"TW_DENGUE"</span> <span class="op">/</span> <span class="st">"BSA_population_TN"</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>demo_dir <span class="op">=</span> RAW_DIR <span class="op">/</span> <span class="st">"TW_DENGUE"</span> <span class="op">/</span> <span class="st">"BSA_demographic_TN"</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Walk through the directory to find all CSV files</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> root, dirs, files <span class="kw">in</span> os.walk(pop_dir):</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">".csv"</span>):</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extract the first number from the filename</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>            number <span class="op">=</span> <span class="bu">int</span>(<span class="st">''</span>.join(<span class="bu">filter</span>(<span class="bu">str</span>.isdigit, <span class="bu">file</span>.split(<span class="st">"年"</span>)[<span class="dv">0</span>])))  <span class="co"># Get the number before '年'</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>            year <span class="op">=</span> number <span class="op">+</span> <span class="dv">1911</span>  <span class="co"># Add 1911</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Full path to the CSV file</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>            file_path <span class="op">=</span> os.path.join(root, <span class="bu">file</span>)</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Attempt to load the CSV file with both encodings</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> encoding <span class="kw">in</span> [<span class="st">"utf-8"</span>, <span class="st">"big5"</span>]:</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>                    df_name <span class="op">=</span> <span class="ss">f"pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">globals</span>()[df_name] <span class="op">=</span> pd.read_csv(file_path, encoding<span class="op">=</span>encoding)</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Successfully loaded </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss"> as </span><span class="sc">{</span>df_name<span class="sc">}</span><span class="ss"> using </span><span class="sc">{</span>encoding<span class="sc">}</span><span class="ss"> encoding."</span>)</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span>  <span class="co"># Exit the loop if successfully loaded</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Failed to load </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss"> with </span><span class="sc">{</span>encoding<span class="sc">}</span><span class="ss"> encoding. Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Walk through the directory to find all CSV files</span></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> root, dirs, files <span class="kw">in</span> os.walk(demo_dir):</span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">".csv"</span>):</span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extract the first number from the filename</span></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>            number <span class="op">=</span> <span class="bu">int</span>(<span class="st">''</span>.join(<span class="bu">filter</span>(<span class="bu">str</span>.isdigit, <span class="bu">file</span>.split(<span class="st">"年"</span>)[<span class="dv">0</span>])))  <span class="co"># Get the number before '年'</span></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>            year <span class="op">=</span> number <span class="op">+</span> <span class="dv">1911</span>  <span class="co"># Add 1911</span></span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Full path to the CSV file</span></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>            file_path <span class="op">=</span> os.path.join(root, <span class="bu">file</span>)</span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Attempt to load the CSV file with both encodings</span></span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> encoding <span class="kw">in</span> [<span class="st">"utf-8"</span>, <span class="st">"big5"</span>]:</span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a>                    df_name <span class="op">=</span> <span class="ss">f"demo_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">globals</span>()[df_name] <span class="op">=</span> pd.read_csv(file_path, encoding<span class="op">=</span>encoding)</span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Successfully loaded </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss"> as </span><span class="sc">{</span>df_name<span class="sc">}</span><span class="ss"> using </span><span class="sc">{</span>encoding<span class="sc">}</span><span class="ss"> encoding."</span>)</span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span>  <span class="co"># Exit the loop if successfully loaded</span></span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Failed to load </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss"> with </span><span class="sc">{</span>encoding<span class="sc">}</span><span class="ss"> encoding. Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Failed to load 104年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 104年12月臺南市統計區人口統計_最小統計區.csv as pop_2015 using big5 encoding.
Failed to load 105年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 105年12月臺南市統計區人口統計_最小統計區.csv as pop_2016 using big5 encoding.
Successfully loaded 106年12月臺南市統計區人口統計_最小統計區.csv as pop_2017 using utf-8 encoding.
Failed to load 107年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 107年12月臺南市統計區人口統計_最小統計區.csv as pop_2018 using big5 encoding.
Failed to load 108年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 108年12月臺南市統計區人口統計_最小統計區.csv as pop_2019 using big5 encoding.
Failed to load 109年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 109年12月臺南市統計區人口統計_最小統計區.csv as pop_2020 using big5 encoding.
Failed to load 110年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 110年12月臺南市統計區人口統計_最小統計區.csv as pop_2021 using big5 encoding.
Failed to load 111年6月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 111年6月臺南市統計區人口統計_最小統計區.csv as pop_2022 using big5 encoding.
Successfully loaded 112年12月臺南市統計區人口統計_最小統計區.csv as pop_2023 using utf-8 encoding.
Failed to load 102年12月臺南市統計區人口指標_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 102年12月臺南市統計區人口指標_最小統計區.csv as demo_2013 using big5 encoding.
Failed to load 103年6月臺南市統計區人口指標_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 103年6月臺南市統計區人口指標_最小統計區.csv as demo_2014 using big5 encoding.
Failed to load 104年12月臺南市統計區人口指標_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 104年12月臺南市統計區人口指標_最小統計區.csv as demo_2015 using big5 encoding.
Failed to load 105年6月臺南市統計區人口指標_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 105年6月臺南市統計區人口指標_最小統計區.csv as demo_2016 using big5 encoding.
Failed to load 106年12月臺南市統計區人口指標_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 106年12月臺南市統計區人口指標_最小統計區.csv as demo_2017 using big5 encoding.
Failed to load 107年12月臺南市統計區人口指標_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 107年12月臺南市統計區人口指標_最小統計區.csv as demo_2018 using big5 encoding.
Failed to load 108年6月臺南市統計區人口指標_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 108年6月臺南市統計區人口指標_最小統計區.csv as demo_2019 using big5 encoding.
Failed to load 109年6月臺南市統計區人口指標_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 109年6月臺南市統計區人口指標_最小統計區.csv as demo_2020 using big5 encoding.
Failed to load 110年12月臺南市統計區人口指標_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 110年12月臺南市統計區人口指標_最小統計區.csv as demo_2021 using big5 encoding.
Failed to load 111年6月臺南市統計區人口指標_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 111年6月臺南市統計區人口指標_最小統計區.csv as demo_2022 using big5 encoding.
Successfully loaded 112年12月臺南市統計區人口指標_最小統計區.csv as demo_2023 using utf-8 encoding.
Successfully loaded 113年12月臺南市統計區人口指標_最小統計區.csv as demo_2024 using utf-8 encoding.</code></pre>
</div>
</div>
<div id="cell-49" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>village_pop_2015 <span class="op">=</span> pd.read_csv(<span class="vs">r"C:</span><span class="er">\</span><span class="vs">Users</span><span class="er">\</span><span class="vs">Patrick</span><span class="dv">\D</span><span class="vs">ownloads</span><span class="dv">\S</span><span class="vs">TAT </span><span class="kw">(</span><span class="vs">4</span><span class="kw">)</span><span class="ch">\104</span><span class="vs">年12月行政區人口統計_村里_臺南市</span><span class="ch">\104</span><span class="vs">年12月行政區人口統計_村里_臺南市</span><span class="dv">.</span><span class="vs">csv"</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>village_pop_2023 <span class="op">=</span> pd.read_csv(<span class="vs">r"C:</span><span class="er">\</span><span class="vs">Users</span><span class="er">\</span><span class="vs">Patrick</span><span class="dv">\D</span><span class="vs">ownloads</span><span class="dv">\S</span><span class="vs">TAT </span><span class="kw">(</span><span class="vs">4</span><span class="kw">)</span><span class="ch">\112</span><span class="vs">年12月行政區人口統計_村里_臺南市</span><span class="ch">\112</span><span class="vs">年12月行政區人口統計_村里_臺南市</span><span class="dv">.</span><span class="vs">csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-50" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>pop_2015</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CODE2</th>
<th data-quarto-table-cell-role="th">CODE1</th>
<th data-quarto-table-cell-role="th">CODEBASE</th>
<th data-quarto-table-cell-role="th">H_CNT</th>
<th data-quarto-table-cell-role="th">P_CNT</th>
<th data-quarto-table-cell-role="th">M_CNT</th>
<th data-quarto-table-cell-role="th">F_CNT</th>
<th data-quarto-table-cell-role="th">INFO_TIME</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>二級發布區代碼</td>
<td>一級發布區代碼</td>
<td>最小統計區代碼</td>
<td>戶數</td>
<td>人口數</td>
<td>男性人口數</td>
<td>女性人口數</td>
<td>資料時間</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>A6701-01</td>
<td>A6701-01-001</td>
<td>A6701-0005-00</td>
<td>34</td>
<td>100</td>
<td>54</td>
<td>46</td>
<td>104Y12M</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>A6701-01</td>
<td>A6701-01-001</td>
<td>A6701-0012-00</td>
<td>65</td>
<td>168</td>
<td>87</td>
<td>81</td>
<td>104Y12M</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>A6701-01</td>
<td>A6701-01-002</td>
<td>A6701-0004-00</td>
<td>55</td>
<td>148</td>
<td>76</td>
<td>72</td>
<td>104Y12M</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>A6701-01</td>
<td>A6701-01-002</td>
<td>A6701-0009-00</td>
<td>59</td>
<td>163</td>
<td>90</td>
<td>73</td>
<td>104Y12M</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">11865</th>
<td>A6737-27</td>
<td>A6737-27-007</td>
<td>A6737-0516-00</td>
<td>39</td>
<td>120</td>
<td>53</td>
<td>67</td>
<td>104Y12M</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11866</th>
<td>A6737-27</td>
<td>A6737-27-007</td>
<td>A6737-0517-00</td>
<td>29</td>
<td>66</td>
<td>27</td>
<td>39</td>
<td>104Y12M</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">11867</th>
<td>A6737-27</td>
<td>A6737-27-007</td>
<td>A6737-0518-00</td>
<td>37</td>
<td>81</td>
<td>31</td>
<td>50</td>
<td>104Y12M</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11868</th>
<td>A6737-27</td>
<td>A6737-27-008</td>
<td>A6737-0511-00</td>
<td>76</td>
<td>196</td>
<td>83</td>
<td>113</td>
<td>104Y12M</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">11869</th>
<td>A6737-27</td>
<td>A6737-27-008</td>
<td>A6737-0522-00</td>
<td>44</td>
<td>118</td>
<td>57</td>
<td>61</td>
<td>104Y12M</td>
</tr>
</tbody>
</table>

<p>11870 rows × 8 columns</p>
</div>
</div>
</div>
<div id="cell-51" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>tn_shp[<span class="st">'CODE1'</span>].nunique()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>6322</code></pre>
</div>
</div>
<div id="cell-52" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">發病日</th>
<th data-quarto-table-cell-role="th">個案研判日</th>
<th data-quarto-table-cell-role="th">通報日</th>
<th data-quarto-table-cell-role="th">性別</th>
<th data-quarto-table-cell-role="th">年齡層</th>
<th data-quarto-table-cell-role="th">居住縣市</th>
<th data-quarto-table-cell-role="th">居住鄉鎮</th>
<th data-quarto-table-cell-role="th">居住村里</th>
<th data-quarto-table-cell-role="th">最小統計區</th>
<th data-quarto-table-cell-role="th">最小統計區中心點X</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">是否境外移入</th>
<th data-quarto-table-cell-role="th">感染國家</th>
<th data-quarto-table-cell-role="th">確定病例數</th>
<th data-quarto-table-cell-role="th">居住村里代碼</th>
<th data-quarto-table-cell-role="th">感染村里代碼</th>
<th data-quarto-table-cell-role="th">血清型</th>
<th data-quarto-table-cell-role="th">內政部居住縣市代碼</th>
<th data-quarto-table-cell-role="th">內政部居住鄉鎮代碼</th>
<th data-quarto-table-cell-role="th">內政部感染縣市代碼</th>
<th data-quarto-table-cell-role="th">內政部感染鄉鎮代碼</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1998/01/02</td>
<td>NaN</td>
<td>1998/01/07</td>
<td>M</td>
<td>40-44</td>
<td>屏東縣</td>
<td>屏東市</td>
<td>NaN</td>
<td>A1320-0136-00</td>
<td>120.505899</td>
<td>...</td>
<td>否</td>
<td>NaN</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>10013.0</td>
<td>1001301.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1998/01/15</td>
<td>NaN</td>
<td>1998/01/23</td>
<td>M</td>
<td>35-39</td>
<td>高雄市</td>
<td>苓雅區</td>
<td>NaN</td>
<td>A6408-0153-00</td>
<td>120.338159</td>
<td>...</td>
<td>否</td>
<td>NaN</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>64.0</td>
<td>6400800.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1998/01/20</td>
<td>NaN</td>
<td>1998/02/04</td>
<td>M</td>
<td>55-59</td>
<td>宜蘭縣</td>
<td>五結鄉</td>
<td>NaN</td>
<td>A0209-0232-00</td>
<td>121.798235</td>
<td>...</td>
<td>否</td>
<td>NaN</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>10002.0</td>
<td>1000209.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1998/01/23</td>
<td>NaN</td>
<td>1998/02/02</td>
<td>M</td>
<td>40-44</td>
<td>新北市</td>
<td>新店區</td>
<td>NaN</td>
<td>A6506-0178-00</td>
<td>121.547480</td>
<td>...</td>
<td>否</td>
<td>NaN</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>65.0</td>
<td>6500600.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1998/01/26</td>
<td>NaN</td>
<td>1998/02/19</td>
<td>F</td>
<td>65-69</td>
<td>台北市</td>
<td>北投區</td>
<td>NaN</td>
<td>A6312-0203-00</td>
<td>121.500936</td>
<td>...</td>
<td>否</td>
<td>NaN</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>63.0</td>
<td>6301200.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">102291</th>
<td>2024/10/28</td>
<td>2024/11/06</td>
<td>2024/11/05</td>
<td>F</td>
<td>65-69</td>
<td>台北市</td>
<td>萬華區</td>
<td>柳鄉里</td>
<td>A6307-0185-00</td>
<td>121.496597</td>
<td>...</td>
<td>否</td>
<td>中華民國</td>
<td>1</td>
<td>6300700-019</td>
<td>NaN</td>
<td>第二型</td>
<td>63.0</td>
<td>6300700.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">102292</th>
<td>2024/10/31</td>
<td>2024/11/08</td>
<td>2024/11/07</td>
<td>M</td>
<td>45-49</td>
<td>台北市</td>
<td>大安區</td>
<td>龍圖里</td>
<td>A6303-0486-00</td>
<td>121.540954</td>
<td>...</td>
<td>否</td>
<td>NaN</td>
<td>1</td>
<td>6300300-022</td>
<td>NaN</td>
<td>第二型</td>
<td>63.0</td>
<td>6300300.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">102293</th>
<td>2024/11/04</td>
<td>2024/11/07</td>
<td>2024/11/07</td>
<td>F</td>
<td>65-69</td>
<td>新北市</td>
<td>中和區</td>
<td>崇南里</td>
<td>A6503-1476-00</td>
<td>121.513061</td>
<td>...</td>
<td>否</td>
<td>中華民國</td>
<td>1</td>
<td>6500300-039</td>
<td>NaN</td>
<td>第二型</td>
<td>65.0</td>
<td>6500300.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">102294</th>
<td>2024/11/05</td>
<td>2024/11/08</td>
<td>2024/11/07</td>
<td>M</td>
<td>55-59</td>
<td>新北市</td>
<td>永和區</td>
<td>協和里</td>
<td>A6504-0502-00</td>
<td>121.511861</td>
<td>...</td>
<td>否</td>
<td>中華民國</td>
<td>1</td>
<td>6500400-027</td>
<td>NaN</td>
<td>第二型</td>
<td>65.0</td>
<td>6500400.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">102295</th>
<td>2024/11/21</td>
<td>2024/11/24</td>
<td>2024/11/24</td>
<td>M</td>
<td>55-59</td>
<td>高雄市</td>
<td>苓雅區</td>
<td>福東里</td>
<td>A6408-0309-00</td>
<td>120.335635</td>
<td>...</td>
<td>否</td>
<td>中華民國</td>
<td>1</td>
<td>6400800-056</td>
<td>NaN</td>
<td>第二型</td>
<td>64.0</td>
<td>6400800.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>102296 rows × 26 columns</p>
</div>
</div>
</div>
<div id="cell-53" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>tn_shp</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U_ID</th>
<th data-quarto-table-cell-role="th">CODEBASE</th>
<th data-quarto-table-cell-role="th">CODE1</th>
<th data-quarto-table-cell-role="th">CODE2</th>
<th data-quarto-table-cell-role="th">TOWN_ID</th>
<th data-quarto-table-cell-role="th">TOWN</th>
<th data-quarto-table-cell-role="th">COUNTY_ID</th>
<th data-quarto-table-cell-role="th">COUNTY</th>
<th data-quarto-table-cell-role="th">X</th>
<th data-quarto-table-cell-role="th">Y</th>
<th data-quarto-table-cell-role="th">AREA</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1519</td>
<td>A6713-0044-00</td>
<td>A6713-03-004</td>
<td>A6713-03</td>
<td>67000130</td>
<td>學甲區</td>
<td>67000</td>
<td>臺南市</td>
<td>167095.16348</td>
<td>2.573509e+06</td>
<td>2.409279e+06</td>
<td>POLYGON Z ((120.17383 23.2717 0, 120.17414 23....</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1520</td>
<td>A6706-0169-00</td>
<td>A6706-10-004</td>
<td>A6706-10</td>
<td>67000060</td>
<td>東山區</td>
<td>67000</td>
<td>臺南市</td>
<td>195790.88048</td>
<td>2.574560e+06</td>
<td>1.871302e+05</td>
<td>POLYGON Z ((120.46841 23.27525 0, 120.46847 23...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1521</td>
<td>A6704-0124-00</td>
<td>A6704-07-007</td>
<td>A6704-07</td>
<td>67000040</td>
<td>柳營區</td>
<td>67000</td>
<td>臺南市</td>
<td>178154.64243</td>
<td>2.574746e+06</td>
<td>5.917852e+04</td>
<td>POLYGON Z ((120.29947 23.27444 0, 120.29947 23...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1522</td>
<td>A6701-0425-00</td>
<td>A6701-27-006</td>
<td>A6701-27</td>
<td>67000010</td>
<td>新營區</td>
<td>67000</td>
<td>臺南市</td>
<td>175860.08597</td>
<td>2.574747e+06</td>
<td>2.694759e+04</td>
<td>POLYGON Z ((120.27531 23.27419 0, 120.27567 23...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1593</td>
<td>A6706-0182-00</td>
<td>A6706-10-005</td>
<td>A6706-10</td>
<td>67000060</td>
<td>東山區</td>
<td>67000</td>
<td>臺南市</td>
<td>195370.86654</td>
<td>2.573953e+06</td>
<td>1.849167e+05</td>
<td>POLYGON Z ((120.4688 23.26962 0, 120.46887 23....</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12769</th>
<td>3108</td>
<td>A6710-0138-00</td>
<td>A6710-07-004</td>
<td>A6710-07</td>
<td>67000100</td>
<td>官田區</td>
<td>67000</td>
<td>臺南市</td>
<td>179864.54916</td>
<td>2.564638e+06</td>
<td>4.500631e+05</td>
<td>POLYGON Z ((120.31738 23.1852 0, 120.31813 23....</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">12770</th>
<td>3109</td>
<td>A6707-0157-00</td>
<td>A6707-05-006</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173376.00015</td>
<td>2.564946e+06</td>
<td>1.006336e+04</td>
<td>POLYGON Z ((120.25085 23.18521 0, 120.25103 23...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12771</th>
<td>3110</td>
<td>A6707-0163-00</td>
<td>A6707-05-007</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173493.29866</td>
<td>2.564901e+06</td>
<td>2.001176e+04</td>
<td>POLYGON Z ((120.2524 23.18523 0, 120.25242 23....</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">12772</th>
<td>3111</td>
<td>A6707-0164-00</td>
<td>A6707-05-008</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173594.45705</td>
<td>2.564904e+06</td>
<td>1.244706e+04</td>
<td>POLYGON Z ((120.25325 23.18522 0, 120.25395 23...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12773</th>
<td>3112</td>
<td>A6707-0165-00</td>
<td>A6707-05-009</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173714.55187</td>
<td>2.564907e+06</td>
<td>1.894120e+04</td>
<td>POLYGON Z ((120.25395 23.18522 0, 120.25414 23...</td>
</tr>
</tbody>
</table>

<p>12774 rows × 12 columns</p>
</div>
</div>
</div>
<div id="cell-54" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>village_pop_2015[<span class="st">'V_ID'</span>].nunique()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>753</code></pre>
</div>
</div>
<div id="cell-55" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>village_pop_2015</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">COUNTY_ID</th>
<th data-quarto-table-cell-role="th">COUNTY</th>
<th data-quarto-table-cell-role="th">TOWN_ID</th>
<th data-quarto-table-cell-role="th">TOWN</th>
<th data-quarto-table-cell-role="th">V_ID</th>
<th data-quarto-table-cell-role="th">VILLAGE</th>
<th data-quarto-table-cell-role="th">H_CNT</th>
<th data-quarto-table-cell-role="th">P_CNT</th>
<th data-quarto-table-cell-role="th">M_CNT</th>
<th data-quarto-table-cell-role="th">F_CNT</th>
<th data-quarto-table-cell-role="th">INFO_TIME</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>縣市代碼</td>
<td>縣市名稱</td>
<td>鄉鎮市區代碼</td>
<td>鄉鎮市區名稱</td>
<td>村里代碼</td>
<td>村里名稱</td>
<td>戶數</td>
<td>人口數</td>
<td>男性人口數</td>
<td>女性人口數</td>
<td>資料時間</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>67000</td>
<td>臺南市</td>
<td>67000150</td>
<td>七股區</td>
<td>67000150-010</td>
<td>七股里</td>
<td>332</td>
<td>1104</td>
<td>571</td>
<td>533</td>
<td>104Y12M</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>67000</td>
<td>臺南市</td>
<td>67000150</td>
<td>七股區</td>
<td>67000150-023</td>
<td>十份里</td>
<td>524</td>
<td>1602</td>
<td>854</td>
<td>748</td>
<td>104Y12M</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>67000</td>
<td>臺南市</td>
<td>67000150</td>
<td>七股區</td>
<td>67000150-022</td>
<td>三股里</td>
<td>488</td>
<td>1609</td>
<td>844</td>
<td>765</td>
<td>104Y12M</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>67000</td>
<td>臺南市</td>
<td>67000150</td>
<td>七股區</td>
<td>67000150-012</td>
<td>大埕里</td>
<td>682</td>
<td>2057</td>
<td>1022</td>
<td>1035</td>
<td>104Y12M</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">748</th>
<td>67000</td>
<td>臺南市</td>
<td>67000020</td>
<td>鹽水區</td>
<td>67000020-012</td>
<td>義稠里</td>
<td>367</td>
<td>985</td>
<td>503</td>
<td>482</td>
<td>104Y12M</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">749</th>
<td>67000</td>
<td>臺南市</td>
<td>67000020</td>
<td>鹽水區</td>
<td>67000020-002</td>
<td>福得里</td>
<td>299</td>
<td>760</td>
<td>400</td>
<td>360</td>
<td>104Y12M</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">750</th>
<td>67000</td>
<td>臺南市</td>
<td>67000020</td>
<td>鹽水區</td>
<td>67000020-008</td>
<td>橋南里</td>
<td>1632</td>
<td>4354</td>
<td>2181</td>
<td>2173</td>
<td>104Y12M</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">751</th>
<td>67000</td>
<td>臺南市</td>
<td>67000020</td>
<td>鹽水區</td>
<td>67000020-009</td>
<td>舊營里</td>
<td>352</td>
<td>932</td>
<td>502</td>
<td>430</td>
<td>104Y12M</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">752</th>
<td>67000</td>
<td>臺南市</td>
<td>67000020</td>
<td>鹽水區</td>
<td>67000020-014</td>
<td>歡雅里</td>
<td>775</td>
<td>1966</td>
<td>1038</td>
<td>928</td>
<td>104Y12M</td>
</tr>
</tbody>
</table>

<p>753 rows × 11 columns</p>
</div>
</div>
</div>
<div id="cell-56" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_populations(merged_df):</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Calculates missing M_CNT and F_CNT values using P_CNT and M_F_RAT."""</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert 'M_F_RAT' to a usable ratio (assuming it's currently a percentage)</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    merged_df[<span class="st">'M_F_RAT'</span>] <span class="op">=</span> merged_df[<span class="st">'M_F_RAT'</span>] <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate missing 'M_CNT'</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>    merged_df[<span class="st">'calculated_M_CNT'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>    merged_df.loc[merged_df[<span class="st">'M_CNT'</span>] <span class="op">==</span> <span class="dv">0</span>, <span class="st">'calculated_M_CNT'</span>] <span class="op">=</span> merged_df.loc[merged_df[<span class="st">'M_CNT'</span>] <span class="op">==</span> <span class="dv">0</span>, <span class="st">'P_CNT'</span>] <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span> <span class="op">/</span> merged_df.loc[merged_df[<span class="st">'M_CNT'</span>] <span class="op">==</span> <span class="dv">0</span>, <span class="st">'M_F_RAT'</span>])</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>    merged_df.loc[merged_df[<span class="st">'M_CNT'</span>] <span class="op">!=</span> <span class="dv">0</span>, <span class="st">'calculated_M_CNT'</span>] <span class="op">=</span> merged_df.loc[merged_df[<span class="st">'M_CNT'</span>] <span class="op">!=</span> <span class="dv">0</span>, <span class="st">'M_CNT'</span>]</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate missing 'F_CNT'</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>    merged_df[<span class="st">'calculated_F_CNT'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>    merged_df.loc[merged_df[<span class="st">'F_CNT'</span>] <span class="op">==</span> <span class="dv">0</span>, <span class="st">'calculated_F_CNT'</span>] <span class="op">=</span> merged_df.loc[merged_df[<span class="st">'F_CNT'</span>] <span class="op">==</span> <span class="dv">0</span>, <span class="st">'P_CNT'</span>] <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> merged_df.loc[merged_df[<span class="st">'F_CNT'</span>] <span class="op">==</span> <span class="dv">0</span>, <span class="st">'M_F_RAT'</span>])</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>    merged_df.loc[merged_df[<span class="st">'F_CNT'</span>] <span class="op">!=</span> <span class="dv">0</span>, <span class="st">'calculated_F_CNT'</span>] <span class="op">=</span> merged_df.loc[merged_df[<span class="st">'F_CNT'</span>] <span class="op">!=</span> <span class="dv">0</span>, <span class="st">'F_CNT'</span>]</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merged_df</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_ratio(merged_df):</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Calculates the male-to-female ratio and handles infinite values."""</span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the male-to-female ratio</span></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>    merged_df[<span class="st">'M_F_ratio'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>    merged_df.loc[merged_df[<span class="st">'calculated_F_CNT'</span>] <span class="op">!=</span> <span class="dv">0</span>, <span class="st">'M_F_ratio'</span>] <span class="op">=</span> merged_df.loc[merged_df[<span class="st">'calculated_F_CNT'</span>] <span class="op">!=</span> <span class="dv">0</span>, <span class="st">'calculated_M_CNT'</span>] <span class="op">/</span> merged_df.loc[merged_df[<span class="st">'calculated_F_CNT'</span>] <span class="op">!=</span> <span class="dv">0</span>, <span class="st">'calculated_F_CNT'</span>]</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>    merged_df.loc[merged_df[<span class="st">'calculated_F_CNT'</span>] <span class="op">==</span> <span class="dv">0</span>, <span class="st">'M_F_ratio'</span>] <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace infinite values with a large finite number</span></span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>    merged_df[<span class="st">'M_F_ratio'</span>].replace(<span class="bu">float</span>(<span class="st">'inf'</span>), <span class="dv">100</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merged_df</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_result_df(merged_df):</span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Creates the final result dataframe with specified columns."""</span></span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'統計區ID'</span> <span class="kw">not</span> <span class="kw">in</span> merged_df.columns:</span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'CODE2'</span> <span class="kw">in</span> merged_df.columns:</span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>            merged_df.rename(columns<span class="op">=</span>{<span class="st">'CODE2'</span>: <span class="st">'統計區ID'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"Error: '統計區ID' or a suitable alternative identifier column not found."</span>)</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Handle the error appropriately</span></span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>    required_columns <span class="op">=</span> [<span class="st">'統計區ID'</span>, <span class="st">'calculated_M_CNT'</span>, <span class="st">'calculated_F_CNT'</span>, <span class="st">'M_F_ratio'</span>, <span class="st">'M_CNT'</span>, <span class="st">'F_CNT'</span>]</span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a>    existing_columns <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> required_columns <span class="cf">if</span> col <span class="kw">in</span> merged_df.columns]</span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(existing_columns) <span class="op">!=</span> <span class="bu">len</span>(required_columns):</span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Error: Not all required columns are present in merged_df."</span>)</span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Handle the error appropriately</span></span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true" tabindex="-1"></a>    result_df <span class="op">=</span> merged_df[existing_columns].copy()</span>
<span id="cb69-56"><a href="#cb69-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-57"><a href="#cb69-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result_df</span>
<span id="cb69-58"><a href="#cb69-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-59"><a href="#cb69-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-60"><a href="#cb69-60" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_data(population_df, indicator_df):</span>
<span id="cb69-61"><a href="#cb69-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Processes data for a given year."""</span></span>
<span id="cb69-62"><a href="#cb69-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-63"><a href="#cb69-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove the first row (header row)</span></span>
<span id="cb69-64"><a href="#cb69-64" aria-hidden="true" tabindex="-1"></a>    population_df <span class="op">=</span> population_df.iloc[<span class="dv">1</span>:]</span>
<span id="cb69-65"><a href="#cb69-65" aria-hidden="true" tabindex="-1"></a>    indicator_df <span class="op">=</span> indicator_df.iloc[<span class="dv">1</span>:]</span>
<span id="cb69-66"><a href="#cb69-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-67"><a href="#cb69-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert relevant columns to numeric types using .loc</span></span>
<span id="cb69-68"><a href="#cb69-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">'M_CNT'</span>, <span class="st">'F_CNT'</span>, <span class="st">'P_CNT'</span>]:</span>
<span id="cb69-69"><a href="#cb69-69" aria-hidden="true" tabindex="-1"></a>        population_df.loc[:, col] <span class="op">=</span> pd.to_numeric(population_df.loc[:, col], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb69-70"><a href="#cb69-70" aria-hidden="true" tabindex="-1"></a>    indicator_df.loc[:, <span class="st">'M_F_RAT'</span>] <span class="op">=</span> pd.to_numeric(indicator_df.loc[:, <span class="st">'M_F_RAT'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb69-71"><a href="#cb69-71" aria-hidden="true" tabindex="-1"></a>    merged_df <span class="op">=</span> pd.merge(population_df, indicator_df, on<span class="op">=</span>[<span class="st">'CODE2'</span>, <span class="st">'CODE1'</span>, <span class="st">'CODEBASE'</span>], how<span class="op">=</span><span class="st">'outer'</span>)</span>
<span id="cb69-72"><a href="#cb69-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-73"><a href="#cb69-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill missing numerical values with 0 temporarily</span></span>
<span id="cb69-74"><a href="#cb69-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">'M_CNT'</span>, <span class="st">'F_CNT'</span>, <span class="st">'P_CNT'</span>, <span class="st">'M_F_RAT'</span>]:</span>
<span id="cb69-75"><a href="#cb69-75" aria-hidden="true" tabindex="-1"></a>        merged_df[col] <span class="op">=</span> merged_df[col].fillna(<span class="dv">0</span>)</span>
<span id="cb69-76"><a href="#cb69-76" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-77"><a href="#cb69-77" aria-hidden="true" tabindex="-1"></a>    merged_df <span class="op">=</span> calculate_populations(merged_df)</span>
<span id="cb69-78"><a href="#cb69-78" aria-hidden="true" tabindex="-1"></a>    merged_df <span class="op">=</span> calculate_ratio(merged_df)</span>
<span id="cb69-79"><a href="#cb69-79" aria-hidden="true" tabindex="-1"></a>    result_df <span class="op">=</span> create_result_df(merged_df)</span>
<span id="cb69-80"><a href="#cb69-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-81"><a href="#cb69-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result_df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-57" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2015</span>, <span class="dv">2024</span>):</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    pop_df <span class="op">=</span> <span class="bu">globals</span>()[<span class="ss">f"pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    demo_df <span class="op">=</span> <span class="bu">globals</span>()[<span class="ss">f"demo_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    result_df <span class="op">=</span> process_data(pop_df, demo_df)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    result_df.to_csv(<span class="ss">f"calculated_MFratio_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:75: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  merged_df[col] = merged_df[col].fillna(0)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:29: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '[1.17391304 1.07407407 1.05555556 ... 0.62       0.73451327 0.93442623]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'M_F_ratio'] = merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_M_CNT'] / merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_F_CNT']
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:33: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  merged_df['M_F_ratio'].replace(float('inf'), 100, inplace=True)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:75: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  merged_df[col] = merged_df[col].fillna(0)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:13: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '[0.         0.         0.         0.         0.         0.
 0.         0.         0.5        0.         0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.5        0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.5        0.66666667 0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.        ]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  merged_df.loc[merged_df['M_CNT'] == 0, 'calculated_M_CNT'] = merged_df.loc[merged_df['M_CNT'] == 0, 'P_CNT'] / (1 + 1 / merged_df.loc[merged_df['M_CNT'] == 0, 'M_F_RAT'])
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:18: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '[2.         1.         1.         1.         1.         0.
 3.         2.         2.         0.         3.         3.
 1.         1.         4.         2.         3.         3.
 1.         1.         1.         1.         0.5        2.
 3.         1.         1.         1.         1.         2.
 1.         0.75       1.         1.         1.         1.
 2.         1.         2.         1.         2.         4.
 1.         3.         1.         2.         1.         1.
 1.         1.         1.         1.         1.         1.
 1.         1.         1.         1.         1.         1.
 1.         0.         4.         2.         1.         1.
 1.         1.         0.         2.         1.         0.28571429
 0.         2.         3.         1.         2.         1.
 2.         1.         1.         2.         5.         1.
 1.         1.         3.         4.         1.         1.
 1.         1.         1.         3.         1.         1.
 2.         4.         1.         2.         1.         2.
 3.         4.         4.         0.         5.         1.
 1.         2.         1.         3.        ]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  merged_df.loc[merged_df['F_CNT'] == 0, 'calculated_F_CNT'] = merged_df.loc[merged_df['F_CNT'] == 0, 'P_CNT'] / (1 + merged_df.loc[merged_df['F_CNT'] == 0, 'M_F_RAT'])
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:29: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '[1.18867925 1.12987013 1.         ... 0.78571429 0.75       0.86764706]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'M_F_ratio'] = merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_M_CNT'] / merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_F_CNT']
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:33: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  merged_df['M_F_ratio'].replace(float('inf'), 100, inplace=True)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:75: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  merged_df[col] = merged_df[col].fillna(0)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:29: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '[1.17857143 1.125      0.91358025 ... 0.78571429 0.73015873 0.83333333]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'M_F_ratio'] = merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_M_CNT'] / merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_F_CNT']
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:33: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  merged_df['M_F_ratio'].replace(float('inf'), 100, inplace=True)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:75: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  merged_df[col] = merged_df[col].fillna(0)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:29: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '[1.22222222 1.1        1.015625   ... 0.71698113 0.64492754 0.86153846]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'M_F_ratio'] = merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_M_CNT'] / merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_F_CNT']
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:33: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  merged_df['M_F_ratio'].replace(float('inf'), 100, inplace=True)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:75: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  merged_df[col] = merged_df[col].fillna(0)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:13: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '[0.         0.         0.         0.         0.33333333 0.
 0.         0.         0.         0.         0.         0.
 0.         0.5263133  0.         1.         0.         0.
 0.         0.         0.         0.         0.         0.5
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.         0.5        0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.         0.45714131 0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.         0.         0.
 0.400012   0.         0.         0.        ]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  merged_df.loc[merged_df['M_CNT'] == 0, 'calculated_M_CNT'] = merged_df.loc[merged_df['M_CNT'] == 0, 'P_CNT'] / (1 + 1 / merged_df.loc[merged_df['M_CNT'] == 0, 'M_F_RAT'])
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:18: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '[1.         1.         1.         0.         0.         0.
 1.         0.         4.         2.         1.         2.
 1.         3.         1.         3.         3.         1.
 1.         1.         1.         1.         1.         3.
 2.         0.5        1.         1.         2.         4.
 0.         2.         1.         3.         1.         1.
 1.         0.         1.         1.         1.         2.
 1.         4.         1.         2.         2.         1.
 1.         0.         1.         2.         0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         1.         0.5        2.         3.
 1.         2.         1.         1.         1.         3.
 1.         1.         1.         1.         1.         2.
 1.         4.         2.         1.         0.         0.
 0.         1.         1.25       2.         3.         1.
 2.         0.66666667 1.         2.         1.         1.
 1.         1.         3.         3.         1.         0.
 1.         3.         1.         1.         2.         3.
 1.         2.         1.         3.         4.         1.
 1.         1.         2.        ]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  merged_df.loc[merged_df['F_CNT'] == 0, 'calculated_F_CNT'] = merged_df.loc[merged_df['F_CNT'] == 0, 'P_CNT'] / (1 + merged_df.loc[merged_df['F_CNT'] == 0, 'M_F_RAT'])
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:29: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '[1.0877193  1.16       1.03225806 ... 0.78431373 0.6056338  0.89393939]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'M_F_ratio'] = merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_M_CNT'] / merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_F_CNT']
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:33: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  merged_df['M_F_ratio'].replace(float('inf'), 100, inplace=True)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:75: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  merged_df[col] = merged_df[col].fillna(0)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:13: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '[0.         0.66666667 0.         0.         0.         0.
 0.         0.         0.         0.         0.5        0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.5        0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         1.         0.         0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.         0.         0.
 0.         0.         0.         0.         0.5        0.83333333
 0.         0.         0.         0.         0.        ]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  merged_df.loc[merged_df['M_CNT'] == 0, 'calculated_M_CNT'] = merged_df.loc[merged_df['M_CNT'] == 0, 'P_CNT'] / (1 + 1 / merged_df.loc[merged_df['M_CNT'] == 0, 'M_F_RAT'])
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:18: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '[1.         0.85714286 1.         1.         1.         4.
 2.         1.         1.         3.         1.         5.
 3.         1.         1.         1.         1.         0.
 1.         1.         2.         2.         1.         1.
 1.         2.         4.         2.         1.         1.
 1.         1.         1.         1.         1.         0.88235294
 1.         2.         1.         4.         1.         1.
 1.         1.         1.         1.         2.         1.
 1.         2.         3.         5.         2.         1.
 1.         2.         1.         1.         2.         2.
 1.         1.         1.         1.         1.         1.
 1.         4.         2.         2.         1.         0.66666667
 2.         0.         3.         1.         2.         2.
 1.         2.         0.         1.         2.         2.
 1.         3.         3.         1.         1.         1.
 3.         1.         1.         2.         3.         1.
 2.         1.         0.5        3.         3.         1.
 1.         2.        ]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  merged_df.loc[merged_df['F_CNT'] == 0, 'calculated_F_CNT'] = merged_df.loc[merged_df['F_CNT'] == 0, 'P_CNT'] / (1 + merged_df.loc[merged_df['F_CNT'] == 0, 'M_F_RAT'])
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:29: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '[1.05263158 1.11392405 1.         ... 0.80392157 0.7037037  0.91176471]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'M_F_ratio'] = merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_M_CNT'] / merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_F_CNT']
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:33: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  merged_df['M_F_ratio'].replace(float('inf'), 100, inplace=True)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:75: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  merged_df[col] = merged_df[col].fillna(0)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:29: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '[1.07407407 1.12658228 0.96491228 ... 0.72       0.75572519 0.83870968]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'M_F_ratio'] = merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_M_CNT'] / merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_F_CNT']
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:33: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  merged_df['M_F_ratio'].replace(float('inf'), 100, inplace=True)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:75: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  merged_df[col] = merged_df[col].fillna(0)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:29: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '[1.07142857 1.15584416 1.01923077 ... 0.79166667 0.69117647 0.85714286]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'M_F_ratio'] = merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_M_CNT'] / merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_F_CNT']
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:33: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  merged_df['M_F_ratio'].replace(float('inf'), 100, inplace=True)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:75: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  merged_df[col] = merged_df[col].fillna(0)
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:29: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '[0.94915254 1.15789474 1.01851852 ... 0.92307692 0.62416107 0.91935484]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'M_F_ratio'] = merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_M_CNT'] / merged_df.loc[merged_df['calculated_F_CNT'] != 0, 'calculated_F_CNT']
C:\Users\Patrick\AppData\Local\Temp\ipykernel_20804\3382482858.py:33: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  merged_df['M_F_ratio'].replace(float('inf'), 100, inplace=True)</code></pre>
</div>
</div>
<div id="cell-58" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">'''Cleaning up data from BSA population and dengue incidence data'''</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert all dates in Dengue Data to Datetime Object</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>dengue_local[<span class="st">'發病日'</span>] <span class="op">=</span> pd.to_datetime(dengue_local[<span class="st">'發病日'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y/%m/</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>dengue_local[<span class="st">'Year'</span>] <span class="op">=</span> dengue_local[<span class="st">'發病日'</span>].dt.year</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-59" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>tn_shp <span class="op">=</span> gpd.read_file(<span class="st">'C:/Users/Patrick/Downloads/0-67000/G97_67000_U0200_2015.shp'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-60" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>village_pop_2015</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">COUNTY_ID</th>
<th data-quarto-table-cell-role="th">COUNTY</th>
<th data-quarto-table-cell-role="th">TOWN_ID</th>
<th data-quarto-table-cell-role="th">TOWN</th>
<th data-quarto-table-cell-role="th">V_ID</th>
<th data-quarto-table-cell-role="th">VILLAGE</th>
<th data-quarto-table-cell-role="th">H_CNT</th>
<th data-quarto-table-cell-role="th">P_CNT</th>
<th data-quarto-table-cell-role="th">M_CNT</th>
<th data-quarto-table-cell-role="th">F_CNT</th>
<th data-quarto-table-cell-role="th">INFO_TIME</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>縣市代碼</td>
<td>縣市名稱</td>
<td>鄉鎮市區代碼</td>
<td>鄉鎮市區名稱</td>
<td>村里代碼</td>
<td>村里名稱</td>
<td>戶數</td>
<td>人口數</td>
<td>男性人口數</td>
<td>女性人口數</td>
<td>資料時間</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>67000</td>
<td>臺南市</td>
<td>67000150</td>
<td>七股區</td>
<td>67000150-010</td>
<td>七股里</td>
<td>332</td>
<td>1104</td>
<td>571</td>
<td>533</td>
<td>104Y12M</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>67000</td>
<td>臺南市</td>
<td>67000150</td>
<td>七股區</td>
<td>67000150-023</td>
<td>十份里</td>
<td>524</td>
<td>1602</td>
<td>854</td>
<td>748</td>
<td>104Y12M</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>67000</td>
<td>臺南市</td>
<td>67000150</td>
<td>七股區</td>
<td>67000150-022</td>
<td>三股里</td>
<td>488</td>
<td>1609</td>
<td>844</td>
<td>765</td>
<td>104Y12M</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>67000</td>
<td>臺南市</td>
<td>67000150</td>
<td>七股區</td>
<td>67000150-012</td>
<td>大埕里</td>
<td>682</td>
<td>2057</td>
<td>1022</td>
<td>1035</td>
<td>104Y12M</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">748</th>
<td>67000</td>
<td>臺南市</td>
<td>67000020</td>
<td>鹽水區</td>
<td>67000020-012</td>
<td>義稠里</td>
<td>367</td>
<td>985</td>
<td>503</td>
<td>482</td>
<td>104Y12M</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">749</th>
<td>67000</td>
<td>臺南市</td>
<td>67000020</td>
<td>鹽水區</td>
<td>67000020-002</td>
<td>福得里</td>
<td>299</td>
<td>760</td>
<td>400</td>
<td>360</td>
<td>104Y12M</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">750</th>
<td>67000</td>
<td>臺南市</td>
<td>67000020</td>
<td>鹽水區</td>
<td>67000020-008</td>
<td>橋南里</td>
<td>1632</td>
<td>4354</td>
<td>2181</td>
<td>2173</td>
<td>104Y12M</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">751</th>
<td>67000</td>
<td>臺南市</td>
<td>67000020</td>
<td>鹽水區</td>
<td>67000020-009</td>
<td>舊營里</td>
<td>352</td>
<td>932</td>
<td>502</td>
<td>430</td>
<td>104Y12M</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">752</th>
<td>67000</td>
<td>臺南市</td>
<td>67000020</td>
<td>鹽水區</td>
<td>67000020-014</td>
<td>歡雅里</td>
<td>775</td>
<td>1966</td>
<td>1038</td>
<td>928</td>
<td>104Y12M</td>
</tr>
</tbody>
</table>

<p>753 rows × 11 columns</p>
</div>
</div>
</div>
<div id="cell-61" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>tn_shp</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U_ID</th>
<th data-quarto-table-cell-role="th">CODEBASE</th>
<th data-quarto-table-cell-role="th">CODE1</th>
<th data-quarto-table-cell-role="th">CODE2</th>
<th data-quarto-table-cell-role="th">TOWN_ID</th>
<th data-quarto-table-cell-role="th">TOWN</th>
<th data-quarto-table-cell-role="th">COUNTY_ID</th>
<th data-quarto-table-cell-role="th">COUNTY</th>
<th data-quarto-table-cell-role="th">X</th>
<th data-quarto-table-cell-role="th">Y</th>
<th data-quarto-table-cell-role="th">AREA</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1519</td>
<td>A6713-0044-00</td>
<td>A6713-03-004</td>
<td>A6713-03</td>
<td>67000130</td>
<td>學甲區</td>
<td>67000</td>
<td>臺南市</td>
<td>167095.16348</td>
<td>2.573509e+06</td>
<td>2.409279e+06</td>
<td>POLYGON Z ((165475.842 2574610.017 0, 165508.4...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1520</td>
<td>A6706-0169-00</td>
<td>A6706-10-004</td>
<td>A6706-10</td>
<td>67000060</td>
<td>東山區</td>
<td>67000</td>
<td>臺南市</td>
<td>195790.88048</td>
<td>2.574560e+06</td>
<td>1.871302e+05</td>
<td>POLYGON Z ((195616.399 2574862.158 0, 195621.9...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1521</td>
<td>A6704-0124-00</td>
<td>A6704-07-007</td>
<td>A6704-07</td>
<td>67000040</td>
<td>柳營區</td>
<td>67000</td>
<td>臺南市</td>
<td>178154.64243</td>
<td>2.574746e+06</td>
<td>5.917852e+04</td>
<td>POLYGON Z ((178332.24 2574846.32 0, 178332.055...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1522</td>
<td>A6701-0425-00</td>
<td>A6701-27-006</td>
<td>A6701-27</td>
<td>67000010</td>
<td>新營區</td>
<td>67000</td>
<td>臺南市</td>
<td>175860.08597</td>
<td>2.574747e+06</td>
<td>2.694759e+04</td>
<td>POLYGON Z ((175860.276 2574830.526 0, 175897.1...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1593</td>
<td>A6706-0182-00</td>
<td>A6706-10-005</td>
<td>A6706-10</td>
<td>67000060</td>
<td>東山區</td>
<td>67000</td>
<td>臺南市</td>
<td>195370.86654</td>
<td>2.573953e+06</td>
<td>1.849167e+05</td>
<td>POLYGON Z ((195653.609 2574238.612 0, 195660.6...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12769</th>
<td>3108</td>
<td>A6710-0138-00</td>
<td>A6710-07-004</td>
<td>A6710-07</td>
<td>67000100</td>
<td>官田區</td>
<td>67000</td>
<td>臺南市</td>
<td>179864.54916</td>
<td>2.564638e+06</td>
<td>4.500631e+05</td>
<td>POLYGON Z ((180117.413 2564955.551 0, 180194.6...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">12770</th>
<td>3109</td>
<td>A6707-0157-00</td>
<td>A6707-05-006</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173376.00015</td>
<td>2.564946e+06</td>
<td>1.006336e+04</td>
<td>POLYGON Z ((173306.466 2564990.163 0, 173324.7...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12771</th>
<td>3110</td>
<td>A6707-0163-00</td>
<td>A6707-05-007</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173493.29866</td>
<td>2.564901e+06</td>
<td>2.001176e+04</td>
<td>POLYGON Z ((173465.574 2564990.492 0, 173467.4...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">12772</th>
<td>3111</td>
<td>A6707-0164-00</td>
<td>A6707-05-008</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173594.45705</td>
<td>2.564904e+06</td>
<td>1.244706e+04</td>
<td>POLYGON Z ((173552.407 2564989.029 0, 173624.3...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12773</th>
<td>3112</td>
<td>A6707-0165-00</td>
<td>A6707-05-009</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173714.55187</td>
<td>2.564907e+06</td>
<td>1.894120e+04</td>
<td>POLYGON Z ((173624.351 2564989.029 0, 173643.5...</td>
</tr>
</tbody>
</table>

<p>12774 rows × 12 columns</p>
</div>
</div>
</div>
<div id="cell-62" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Tainan shapefile</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>tn_shp <span class="op">=</span> gpd.read_file(<span class="st">'C:/Users/Patrick/Downloads/0-67000/G97_67000_U0200_2015.shp'</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>tn_shp <span class="op">=</span> tn_shp.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>tn_shp.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'lightblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Visualization of tn_shp"</span>)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Longitude"</span>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Latitude"</span>)</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tn_dengue_cleaning_files/figure-html/cell-63-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-63" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define districts that are acccounted for</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>allowed_districts <span class="op">=</span> [<span class="st">'東區'</span>, <span class="st">'安南區'</span>, <span class="st">'南區'</span>, <span class="st">'北區'</span>, <span class="st">'中西區'</span>, <span class="st">'安平區'</span>]</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Taiwan shapefile</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>tn_shp <span class="op">=</span> gpd.read_file(<span class="st">'C:/Users/Patrick/Downloads/0-67000/G97_67000_U0200_2015.shp'</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter SHP file by Area</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>filtered_tn_shp <span class="op">=</span> tn_shp[tn_shp[<span class="st">'TOWN'</span>].isin(allowed_districts)]</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Dengue Cases by Tainan</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>tn_dengue <span class="op">=</span> dengue_local[dengue_local[<span class="st">'居住縣市'</span>]<span class="op">==</span><span class="st">'台南市'</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Tainan Dengue Cases by Area</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>filtered_tn_dengue <span class="op">=</span> tn_dengue[</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    (tn_dengue[<span class="st">'居住鄉鎮'</span>].isin(allowed_districts)) <span class="op">&amp;</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>    (tn_dengue[<span class="st">'Year'</span>] <span class="op">&gt;=</span> <span class="dv">2015</span>) <span class="op">&amp;</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>    (tn_dengue[<span class="st">'Year'</span>] <span class="op">&lt;=</span> <span class="dv">2023</span>) </span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename column of BSA Serial Number</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>filtered_tn_dengue <span class="op">=</span> filtered_tn_dengue.rename(columns<span class="op">=</span>{<span class="st">"最小統計區"</span>:<span class="st">'CODEBASE'</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">d:\Projects\TMU\gee_dengue\.conda\Lib\site-packages\pandas\core\indexes\base.py:3805</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg">   3804</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">3805</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_engine</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_loc</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">casted_key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   3806</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> err:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">index.pyx:167</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">index.pyx:196</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">pandas\\_libs\\hashtable_class_helper.pxi:7081</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">pandas\\_libs\\hashtable_class_helper.pxi:7089</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">KeyError</span>: 'Year'

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[12]</span><span class="ansi-green-fg">, line 12</span>
<span class="ansi-green-fg">      8</span> tn_dengue = dengue_local[dengue_local[<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">居住縣市</span><span class="ansi-yellow-fg">'</span>]==<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">台南市</span><span class="ansi-yellow-fg">'</span>].reset_index(drop=<span style="font-weight:bold;color:rgb(0,135,0)">True</span>)
<span class="ansi-green-fg">      9</span> <span style="font-style:italic;color:rgb(95,135,135)"># Filter Tainan Dengue Cases by Area</span>
<span class="ansi-green-fg">     10</span> filtered_tn_dengue = tn_dengue[
<span class="ansi-green-fg">     11</span>     (tn_dengue[<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">居住鄉鎮</span><span class="ansi-yellow-fg">'</span>].isin(allowed_districts)) &amp;
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">12</span>     (<span class="ansi-yellow-bg">tn_dengue</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-fg ansi-yellow-bg">Year</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-bg">]</span> &gt;= <span class="ansi-green-fg">2015</span>) &amp;
<span class="ansi-green-fg">     13</span>     (tn_dengue[<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">Year</span><span class="ansi-yellow-fg">'</span>] &lt;= <span class="ansi-green-fg">2023</span>) 
<span class="ansi-green-fg">     14</span> ].reset_index(drop=<span style="font-weight:bold;color:rgb(0,135,0)">True</span>)
<span class="ansi-green-fg">     15</span> <span style="font-style:italic;color:rgb(95,135,135)"># Rename column of BSA Serial Number</span>
<span class="ansi-green-fg">     16</span> filtered_tn_dengue = filtered_tn_dengue.rename(columns={<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">最小統計區</span><span class="ansi-yellow-fg">"</span>:<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">CODEBASE</span><span class="ansi-yellow-fg">'</span>})

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">d:\Projects\TMU\gee_dengue\.conda\Lib\site-packages\pandas\core\frame.py:4102</span>, in <span class="ansi-cyan-fg">DataFrame.__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg">   4100</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span>.columns.nlevels &gt; <span class="ansi-green-fg">1</span>:
<span class="ansi-green-fg">   4101</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span>._getitem_multilevel(key)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">4102</span> indexer = <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">columns</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_loc</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   4103</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> is_integer(indexer):
<span class="ansi-green-fg">   4104</span>     indexer = [indexer]

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">d:\Projects\TMU\gee_dengue\.conda\Lib\site-packages\pandas\core\indexes\base.py:3812</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg">   3807</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(casted_key, <span style="color:rgb(0,135,0)">slice</span>) <span style="font-weight:bold;color:rgb(175,0,255)">or</span> (
<span class="ansi-green-fg">   3808</span>         <span style="color:rgb(0,135,0)">isinstance</span>(casted_key, abc.Iterable)
<span class="ansi-green-fg">   3809</span>         <span style="font-weight:bold;color:rgb(175,0,255)">and</span> <span style="color:rgb(0,135,0)">any</span>(<span style="color:rgb(0,135,0)">isinstance</span>(x, <span style="color:rgb(0,135,0)">slice</span>) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> x <span style="font-weight:bold;color:rgb(175,0,255)">in</span> casted_key)
<span class="ansi-green-fg">   3810</span>     ):
<span class="ansi-green-fg">   3811</span>         <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> InvalidIndexError(key)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">3812</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(key) <span style="font-weight:bold;color:rgb(0,135,0)">from</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg ansi-bold">err</span>
<span class="ansi-green-fg">   3813</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>:
<span class="ansi-green-fg">   3814</span>     <span style="font-style:italic;color:rgb(95,135,135)"># If we have a listlike key, _check_indexing_error will raise</span>
<span class="ansi-green-fg">   3815</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  InvalidIndexError. Otherwise we fall through and re-raise</span>
<span class="ansi-green-fg">   3816</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  the TypeError.</span>
<span class="ansi-green-fg">   3817</span>     <span style="color:rgb(0,135,0)">self</span>._check_indexing_error(key)

<span class="ansi-red-fg">KeyError</span>: 'Year'</pre>
</div>
</div>
</div>
<div id="cell-64" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Taiwan shapefile</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>tn_shp <span class="op">=</span> gpd.read_file(<span class="st">'C:/Users/Patrick/Downloads/0-67000/G97_67000_U0200_2015.shp'</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Dengue Cases by Tainan</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>tn_dengue <span class="op">=</span> dengue_local[dengue_local[<span class="st">'居住縣市'</span>]<span class="op">==</span><span class="st">'台南市'</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Tainan Dengue Cases by Area</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>filtered_tn_dengue <span class="op">=</span> tn_dengue[</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    (tn_dengue[<span class="st">'Year'</span>] <span class="op">&gt;=</span> <span class="dv">2015</span>) <span class="op">&amp;</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>    (tn_dengue[<span class="st">'Year'</span>] <span class="op">&lt;=</span> <span class="dv">2023</span>) </span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename column of BSA Serial Number</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>filtered_tn_dengue <span class="op">=</span> filtered_tn_dengue.rename(columns<span class="op">=</span>{<span class="st">"最小統計區"</span>:<span class="st">'CODEBASE'</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Script to calculate incidence rate for the significant years.</p>
<div id="cell-66" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Tallying dengue infections by year and CODEBASE</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dengue_2015 = filtered_tn_dengue[filtered_tn_dengue['Year'] == 2015].groupby('CODEBASE').size().reset_index(name='Infections_2015')</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co"># dengue_2019 = filtered_tn_dengue[filtered_tn_dengue['Year'] == 2019].groupby('CODEBASE').size().reset_index(name='Infections_2019')</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># dengue_2023 = filtered_tn_dengue[filtered_tn_dengue['Year'] == 2023].groupby('CODEBASE').size().reset_index(name='Infections_2023')</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="co"># # Merging population data with infection counts for each year</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2015_pop = df_2015[['CODEBASE', 'P_CNT']].rename(columns={'P_CNT': 'Population_2015'})</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2019_pop = df_2019[['CODEBASE', 'P_CNT']].rename(columns={'P_CNT': 'Population_2019'})</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2023_pop = df_2023[['CODEBASE', 'P_CNT']].rename(columns={'P_CNT': 'Population_2023'})</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="co"># # Merging infection data with population data for each year</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2015_incidence = pd.merge(dengue_2015, df_2015_pop, on='CODEBASE', how='left')</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2019_incidence = pd.merge(dengue_2019, df_2019_pop, on='CODEBASE', how='left')</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2023_incidence = pd.merge(dengue_2023, df_2023_pop, on='CODEBASE', how='left')</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-67" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Ensure all infection and population columns are numeric</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2015_incidence['Infections_2015'] = pd.to_numeric(df_2015_incidence['Infections_2015'], errors='coerce')</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2015_incidence['Population_2015'] = pd.to_numeric(df_2015_incidence['Population_2015'], errors='coerce')</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2019_incidence['Infections_2019'] = pd.to_numeric(df_2019_incidence['Infections_2019'], errors='coerce')</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2019_incidence['Population_2019'] = pd.to_numeric(df_2019_incidence['Population_2019'], errors='coerce')</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2023_incidence['Infections_2023'] = pd.to_numeric(df_2023_incidence['Infections_2023'], errors='coerce')</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2023_incidence['Population_2023'] = pd.to_numeric(df_2023_incidence['Population_2023'], errors='coerce')</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="co"># # Now calculate the incidence rates</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2015_incidence['Incidence_Rate_2015'] = (df_2015_incidence['Infections_2015'] / df_2015_incidence['Population_2015']) * 1000</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2019_incidence['Incidence_Rate_2019'] = (df_2019_incidence['Infections_2019'] / df_2019_incidence['Population_2019']) * 1000</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2023_incidence['Incidence_Rate_2023'] = (df_2023_incidence['Infections_2023'] / df_2023_incidence['Population_2023']) * 1000</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="co"># import matplotlib.pyplot as plt</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="co"># # Set incidence rates over 1000 to 1100</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2015_incidence.loc[df_2015_incidence['Incidence_Rate_2015'] &gt; 1000, 'Incidence_Rate_2015'] = 1100</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2019_incidence.loc[df_2019_incidence['Incidence_Rate_2019'] &gt; 1000, 'Incidence_Rate_2019'] = 1100</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a><span class="co"># df_2023_incidence.loc[df_2023_incidence['Incidence_Rate_2023'] &gt; 1000, 'Incidence_Rate_2023'] = 1100</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create histograms for incidence rate distribution</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.figure(figsize=(15, 5))</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a><span class="co"># # Histogram for 2015</span></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.subplot(1, 3, 1)</span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.hist(df_2015_incidence['Incidence_Rate_2015'], bins=20, color='blue', edgecolor='black')</span></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.title('Incidence Rate Distribution - 2015')</span></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.xlabel('Incidence Rate')</span></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.ylabel('Frequency')</span></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a><span class="co"># # Histogram for 2019</span></span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.subplot(1, 3, 2)</span></span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.hist(df_2019_incidence['Incidence_Rate_2019'], bins=20, color='green', edgecolor='black')</span></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.title('Incidence Rate Distribution - 2019')</span></span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.xlabel('Incidence Rate')</span></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a><span class="co"># # Histogram for 2023</span></span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.subplot(1, 3, 3)</span></span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.hist(df_2023_incidence['Incidence_Rate_2023'], bins=20, color='red', edgecolor='black')</span></span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.title('Incidence Rate Distribution - 2023')</span></span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.xlabel('Incidence Rate')</span></span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # Show the plots</span></span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.tight_layout()</span></span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-68" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> [<span class="dv">2015</span>,<span class="dv">2023</span>]</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each year to calculate infections, population, and incidence rates</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> years:</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tally infections by CODEBASE</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    dengue_year <span class="op">=</span> filtered_tn_dengue[filtered_tn_dengue[<span class="st">'Year'</span>] <span class="op">==</span> year]</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    infections <span class="op">=</span> dengue_year.groupby(<span class="st">'CODEBASE'</span>).size().reset_index(name<span class="op">=</span><span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get population data</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>    population <span class="op">=</span> <span class="bu">eval</span>(<span class="ss">f"df_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">[['CODEBASE', 'P_CNT', 'M_CNT', 'F_CNT']]"</span>).rename(columns<span class="op">=</span>{<span class="st">'P_CNT'</span>: <span class="ss">f'Pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>,<span class="st">'M_CNT'</span>:<span class="ss">f'M_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>,<span class="st">'F_CNT'</span>:<span class="ss">f'F_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>})</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge infection and population data</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>    incidence <span class="op">=</span> pd.merge(infections, population, on<span class="op">=</span><span class="st">'CODEBASE'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure columns are numeric</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>    incidence[<span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> pd.to_numeric(incidence[<span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>    incidence[<span class="ss">f'Pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> pd.to_numeric(incidence[<span class="ss">f'Pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate incidence rate</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>    incidence[<span class="ss">f'IR_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> (incidence[<span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>] <span class="op">/</span> incidence[<span class="ss">f'Pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>]) <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge infection count, population, and incidence rate data into the main shapefile DataFrame</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>    filtered_tn_dengue <span class="op">=</span> pd.merge(tn_shp, incidence[[<span class="st">'CODEBASE'</span>, <span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>, <span class="ss">f'Pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>, <span class="ss">f'IR_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>,<span class="ss">f'M_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>, <span class="ss">f'F_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>]], on<span class="op">=</span><span class="st">'CODEBASE'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Now filtered_tn_shp contains infections, population, and incidence rates from 2015 to 2023 for all CODEBASEs</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg ansi-bold">KeyError</span>                                  Traceback (most recent call last)
File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\pandas\core\indexes\base.py:3802</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg ansi-bold">(self, key, method, tolerance)</span>
<span class="ansi-green-fg">   3801</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg ansi-bold">-&gt; 3802</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_engine<span style="color:rgb(98,98,98)">.</span>get_loc(casted_key)
<span class="ansi-green-fg">   3803</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> err:

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\pandas\_libs\index.pyx:138</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg ansi-bold">()</span>

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\pandas\_libs\index.pyx:165</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg ansi-bold">()</span>

File <span class="ansi-green-fg ansi-bold">pandas\_libs\hashtable_class_helper.pxi:5745</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg ansi-bold">()</span>

File <span class="ansi-green-fg ansi-bold">pandas\_libs\hashtable_class_helper.pxi:5753</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg ansi-bold">()</span>

<span class="ansi-red-fg ansi-bold">KeyError</span>: 'Year'

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg ansi-bold">KeyError</span>                                  Traceback (most recent call last)
Cell <span class="ansi-green-fg ansi-bold">In[8], line 6</span>
<span class="ansi-green-fg">      3</span> <span style="font-style:italic;color:rgb(95,135,135)"># Loop through each year to calculate infections, population, and incidence rates</span>
<span class="ansi-green-fg">      4</span> <span style="font-weight:bold;color:rgb(0,135,0)">for</span> year <span style="font-weight:bold;color:rgb(175,0,255)">in</span> years:
<span class="ansi-green-fg">      5</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Tally infections by CODEBASE</span>
<span class="ansi-green-fg ansi-bold">----&gt; 6</span>     dengue_year <span style="color:rgb(98,98,98)">=</span> filtered_tn_dengue[filtered_tn_dengue[<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">Year</span><span style="color:rgb(175,0,0)">'</span>] <span style="color:rgb(98,98,98)">==</span> year]
<span class="ansi-green-fg">      7</span>     infections <span style="color:rgb(98,98,98)">=</span> dengue_year<span style="color:rgb(98,98,98)">.</span>groupby(<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">CODEBASE</span><span style="color:rgb(175,0,0)">'</span>)<span style="color:rgb(98,98,98)">.</span>size()<span style="color:rgb(98,98,98)">.</span>reset_index(name<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">Inf_</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>year<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">'</span>)
<span class="ansi-green-fg">      9</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Get population data</span>

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\geopandas\geodataframe.py:1750</span>, in <span class="ansi-cyan-fg">GeoDataFrame.__getitem__</span><span class="ansi-blue-fg ansi-bold">(self, key)</span>
<span class="ansi-green-fg">   1744</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">__getitem__</span>(<span style="color:rgb(0,135,0)">self</span>, key):
<span class="ansi-green-fg">   1745</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic;color:rgb(175,0,0)">"""</span>
<span class="ansi-green-fg">   1746</span> <span style="font-style:italic;color:rgb(175,0,0)">    If the result is a column containing only 'geometry', return a</span>
<span class="ansi-green-fg">   1747</span> <span style="font-style:italic;color:rgb(175,0,0)">    GeoSeries. If it's a DataFrame with any columns of GeometryDtype,</span>
<span class="ansi-green-fg">   1748</span> <span style="font-style:italic;color:rgb(175,0,0)">    return a GeoDataFrame.</span>
<span class="ansi-green-fg">   1749</span> <span style="font-style:italic;color:rgb(175,0,0)">    """</span>
<span class="ansi-green-fg ansi-bold">-&gt; 1750</span>     result <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">super</span>()<span style="color:rgb(98,98,98)">.</span><span style="color:rgb(0,0,255)">__getitem__</span>(key)
<span class="ansi-green-fg">   1751</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Custom logic to avoid waiting for pandas GH51895</span>
<span class="ansi-green-fg">   1752</span>     <span style="font-style:italic;color:rgb(95,135,135)"># result is not geometry dtype for multi-indexes</span>
<span class="ansi-green-fg">   1753</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> (
<span class="ansi-green-fg">   1754</span>         pd<span style="color:rgb(98,98,98)">.</span>api<span style="color:rgb(98,98,98)">.</span>types<span style="color:rgb(98,98,98)">.</span>is_scalar(key)
<span class="ansi-green-fg">   1755</span>         <span style="font-weight:bold;color:rgb(175,0,255)">and</span> key <span style="color:rgb(98,98,98)">==</span> <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">   (...)</span>
<span class="ansi-green-fg">   1758</span>         <span style="font-weight:bold;color:rgb(175,0,255)">and</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> is_geometry_type(result)
<span class="ansi-green-fg">   1759</span>     ):

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\pandas\core\frame.py:3807</span>, in <span class="ansi-cyan-fg">DataFrame.__getitem__</span><span class="ansi-blue-fg ansi-bold">(self, key)</span>
<span class="ansi-green-fg">   3805</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>columns<span style="color:rgb(98,98,98)">.</span>nlevels <span style="color:rgb(98,98,98)">&gt;</span> <span style="color:rgb(98,98,98)">1</span>:
<span class="ansi-green-fg">   3806</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_getitem_multilevel(key)
<span class="ansi-green-fg ansi-bold">-&gt; 3807</span> indexer <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>columns<span style="color:rgb(98,98,98)">.</span>get_loc(key)
<span class="ansi-green-fg">   3808</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> is_integer(indexer):
<span class="ansi-green-fg">   3809</span>     indexer <span style="color:rgb(98,98,98)">=</span> [indexer]

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\pandas\core\indexes\base.py:3804</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg ansi-bold">(self, key, method, tolerance)</span>
<span class="ansi-green-fg">   3802</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_engine<span style="color:rgb(98,98,98)">.</span>get_loc(casted_key)
<span class="ansi-green-fg">   3803</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> err:
<span class="ansi-green-fg ansi-bold">-&gt; 3804</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(key) <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">err</span>
<span class="ansi-green-fg">   3805</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>:
<span class="ansi-green-fg">   3806</span>     <span style="font-style:italic;color:rgb(95,135,135)"># If we have a listlike key, _check_indexing_error will raise</span>
<span class="ansi-green-fg">   3807</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  InvalidIndexError. Otherwise we fall through and re-raise</span>
<span class="ansi-green-fg">   3808</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  the TypeError.</span>
<span class="ansi-green-fg">   3809</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_check_indexing_error(key)

<span class="ansi-red-fg ansi-bold">KeyError</span>: 'Year'</pre>
</div>
</div>
</div>
<div id="cell-69" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> [<span class="dv">2015</span>, <span class="dv">2023</span>]</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>all_data <span class="op">=</span> tn_shp.copy()</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each year to calculate infections, population, and incidence rates</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> years:</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tally infections by CODEBASE for the current year</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    dengue_year <span class="op">=</span> filtered_tn_dengue[filtered_tn_dengue[<span class="st">'Year'</span>] <span class="op">==</span> year]</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    infections <span class="op">=</span> dengue_year.groupby(<span class="st">'CODEBASE'</span>).size().reset_index(name<span class="op">=</span><span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get population data using eval</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    population <span class="op">=</span> <span class="bu">eval</span>(<span class="ss">f"df_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">[['CODEBASE', 'P_CNT', 'M_CNT', 'F_CNT']]"</span>).rename(</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>{<span class="st">'P_CNT'</span>: <span class="ss">f'Pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>, <span class="st">'M_CNT'</span>: <span class="ss">f'M_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>, <span class="st">'F_CNT'</span>: <span class="ss">f'F_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>}</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge infection and population data</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>    incidence <span class="op">=</span> pd.merge(infections, population, on<span class="op">=</span><span class="st">'CODEBASE'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure numeric columns (convert errors to NaN and fill with 0)</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>    incidence[<span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> pd.to_numeric(incidence[<span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>).fillna(<span class="dv">0</span>)</span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>    incidence[<span class="ss">f'Pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> pd.to_numeric(incidence[<span class="ss">f'Pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>).fillna(<span class="dv">0</span>)</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate incidence rate per 1000 people</span></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>    incidence[<span class="ss">f'IR_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> (incidence[<span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>] <span class="op">/</span> incidence[<span class="ss">f'Pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>]) <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge results into the main DataFrame, keeping data for all years</span></span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>    all_data <span class="op">=</span> pd.merge(</span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>        all_data,</span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>        incidence[[<span class="st">'CODEBASE'</span>, <span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>, <span class="ss">f'Pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>, <span class="ss">f'IR_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>, <span class="ss">f'M_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>, <span class="ss">f'F_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>]],</span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>        on<span class="op">=</span><span class="st">'CODEBASE'</span>,</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>        how<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, all_data contains infections, population, and incidence rates from 2015 to 2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-70" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>all_data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U_ID</th>
<th data-quarto-table-cell-role="th">CODEBASE</th>
<th data-quarto-table-cell-role="th">CODE1</th>
<th data-quarto-table-cell-role="th">CODE2</th>
<th data-quarto-table-cell-role="th">TOWN_ID</th>
<th data-quarto-table-cell-role="th">TOWN</th>
<th data-quarto-table-cell-role="th">COUNTY_ID</th>
<th data-quarto-table-cell-role="th">COUNTY</th>
<th data-quarto-table-cell-role="th">X</th>
<th data-quarto-table-cell-role="th">Y</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Inf_2015</th>
<th data-quarto-table-cell-role="th">Pop_2015</th>
<th data-quarto-table-cell-role="th">IR_2015</th>
<th data-quarto-table-cell-role="th">M_2015</th>
<th data-quarto-table-cell-role="th">F_2015</th>
<th data-quarto-table-cell-role="th">Inf_2023</th>
<th data-quarto-table-cell-role="th">Pop_2023</th>
<th data-quarto-table-cell-role="th">IR_2023</th>
<th data-quarto-table-cell-role="th">M_2023</th>
<th data-quarto-table-cell-role="th">F_2023</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1519</td>
<td>A6713-0044-00</td>
<td>A6713-03-004</td>
<td>A6713-03</td>
<td>67000130</td>
<td>學甲區</td>
<td>67000</td>
<td>臺南市</td>
<td>167095.16348</td>
<td>2.573509e+06</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1520</td>
<td>A6706-0169-00</td>
<td>A6706-10-004</td>
<td>A6706-10</td>
<td>67000060</td>
<td>東山區</td>
<td>67000</td>
<td>臺南市</td>
<td>195790.88048</td>
<td>2.574560e+06</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1521</td>
<td>A6704-0124-00</td>
<td>A6704-07-007</td>
<td>A6704-07</td>
<td>67000040</td>
<td>柳營區</td>
<td>67000</td>
<td>臺南市</td>
<td>178154.64243</td>
<td>2.574746e+06</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1522</td>
<td>A6701-0425-00</td>
<td>A6701-27-006</td>
<td>A6701-27</td>
<td>67000010</td>
<td>新營區</td>
<td>67000</td>
<td>臺南市</td>
<td>175860.08597</td>
<td>2.574747e+06</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1593</td>
<td>A6706-0182-00</td>
<td>A6706-10-005</td>
<td>A6706-10</td>
<td>67000060</td>
<td>東山區</td>
<td>67000</td>
<td>臺南市</td>
<td>195370.86654</td>
<td>2.573953e+06</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12769</th>
<td>3108</td>
<td>A6710-0138-00</td>
<td>A6710-07-004</td>
<td>A6710-07</td>
<td>67000100</td>
<td>官田區</td>
<td>67000</td>
<td>臺南市</td>
<td>179864.54916</td>
<td>2.564638e+06</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">12770</th>
<td>3109</td>
<td>A6707-0157-00</td>
<td>A6707-05-006</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173376.00015</td>
<td>2.564946e+06</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12771</th>
<td>3110</td>
<td>A6707-0163-00</td>
<td>A6707-05-007</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173493.29866</td>
<td>2.564901e+06</td>
<td>...</td>
<td>1.0</td>
<td>441.0</td>
<td>2.267574</td>
<td>203</td>
<td>238</td>
<td>3.0</td>
<td>432.0</td>
<td>6.944444</td>
<td>188</td>
<td>244</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">12772</th>
<td>3111</td>
<td>A6707-0164-00</td>
<td>A6707-05-008</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173594.45705</td>
<td>2.564904e+06</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3.0</td>
<td>89.0</td>
<td>33.707865</td>
<td>52</td>
<td>37</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12773</th>
<td>3112</td>
<td>A6707-0165-00</td>
<td>A6707-05-009</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173714.55187</td>
<td>2.564907e+06</td>
<td>...</td>
<td>1.0</td>
<td>228.0</td>
<td>4.385965</td>
<td>120</td>
<td>108</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>12774 rows × 22 columns</p>
</div>
</div>
</div>
<div id="cell-71" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> [<span class="dv">2015</span>,<span class="dv">2023</span>]</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each year to calculate infections, population, and incidence rates</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> years:</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tally infections by CODEBASE</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    dengue_year <span class="op">=</span> filtered_tn_dengue[filtered_tn_dengue[<span class="st">'Year'</span>] <span class="op">==</span> year]</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    infections <span class="op">=</span> dengue_year.groupby(<span class="st">'CODEBASE'</span>).size().reset_index(name<span class="op">=</span><span class="ss">f'Infections_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get population data</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>    population <span class="op">=</span> <span class="bu">eval</span>(<span class="ss">f"df_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">[['CODEBASE', 'P_CNT']]"</span>).rename(columns<span class="op">=</span>{<span class="st">'P_CNT'</span>: <span class="ss">f'Population_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>})</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge infection and population data</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>    incidence <span class="op">=</span> pd.merge(infections, population, on<span class="op">=</span><span class="st">'CODEBASE'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure columns are numeric</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>    incidence[<span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> pd.to_numeric(incidence[<span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>    incidence[<span class="ss">f'Pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> pd.to_numeric(incidence[<span class="ss">f'Population_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate incidence rate</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>    incidence[<span class="ss">f'Incidence_Rate_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> (incidence[<span class="ss">f'Infections_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>] <span class="op">/</span> incidence[<span class="ss">f'Population_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>]) <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge infection count, population, and incidence rate data into the main shapefile DataFrame</span></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>    filtered_tn_shp <span class="op">=</span> pd.merge(</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>        filtered_tn_shp,</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>        incidence[[<span class="st">'CODEBASE'</span>, <span class="ss">f'Infections_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>, <span class="ss">f'Population_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>, <span class="ss">f'Incidence_Rate_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>]],</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>        on<span class="op">=</span><span class="st">'CODEBASE'</span>,</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>        how<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>        suffixes<span class="op">=</span>(<span class="va">None</span>, <span class="ss">f'_dup'</span>)</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop any duplicate columns from repeated merges</span></span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>    filtered_tn_shp <span class="op">=</span> filtered_tn_shp.loc[:, <span class="op">~</span>filtered_tn_shp.columns.<span class="bu">str</span>.endswith(<span class="st">'_dup'</span>)]</span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Now filtered_tn_shp contains infections, population, and incidence rates from 2015 to 2023 for all CODEBASEs</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-72" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>filtered_tn_shp.columns</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg ansi-bold">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg ansi-bold">In[14], line 1</span>
<span class="ansi-green-fg ansi-bold">----&gt; 1</span> filtered_tn_shp<span style="color:rgb(98,98,98)">.</span>columns

<span class="ansi-red-fg ansi-bold">NameError</span>: name 'filtered_tn_shp' is not defined</pre>
</div>
</div>
</div>
<div id="cell-73" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>filtered_tn_shp</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U_ID</th>
<th data-quarto-table-cell-role="th">CODEBASE</th>
<th data-quarto-table-cell-role="th">CODE1</th>
<th data-quarto-table-cell-role="th">CODE2</th>
<th data-quarto-table-cell-role="th">TOWN_ID</th>
<th data-quarto-table-cell-role="th">TOWN</th>
<th data-quarto-table-cell-role="th">COUNTY_ID</th>
<th data-quarto-table-cell-role="th">COUNTY</th>
<th data-quarto-table-cell-role="th">X</th>
<th data-quarto-table-cell-role="th">Y</th>
<th data-quarto-table-cell-role="th">AREA</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">Inf_2015</th>
<th data-quarto-table-cell-role="th">Pop_2015</th>
<th data-quarto-table-cell-role="th">IR_2015</th>
<th data-quarto-table-cell-role="th">Inf_2023</th>
<th data-quarto-table-cell-role="th">Pop_2023</th>
<th data-quarto-table-cell-role="th">IR_2023</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>5144</td>
<td>A6733-0874-00</td>
<td>A6733-43-012</td>
<td>A6733-43</td>
<td>67000330</td>
<td>南區</td>
<td>67000</td>
<td>臺南市</td>
<td>166173.68829</td>
<td>2.535589e+06</td>
<td>25735.24733</td>
<td>POLYGON Z ((166321.261 2535692.982 0, 166319 2...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>299.0</td>
<td>3.344482</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>5145</td>
<td>A6733-0878-00</td>
<td>A6733-44-006</td>
<td>A6733-44</td>
<td>67000330</td>
<td>南區</td>
<td>67000</td>
<td>臺南市</td>
<td>165894.50162</td>
<td>2.535469e+06</td>
<td>73573.78885</td>
<td>POLYGON Z ((165968.38 2535639.042 0, 165978.83...</td>
<td>1.0</td>
<td>79.0</td>
<td>12.658228</td>
<td>2.0</td>
<td>69.0</td>
<td>28.985507</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>5146</td>
<td>A6733-0876-00</td>
<td>A6733-43-012</td>
<td>A6733-43</td>
<td>67000330</td>
<td>南區</td>
<td>67000</td>
<td>臺南市</td>
<td>166225.66291</td>
<td>2.535524e+06</td>
<td>20277.53652</td>
<td>POLYGON Z ((166317.999 2535628.685 0, 166318.5...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>4736</td>
<td>A6732-0998-00</td>
<td>A6732-60-005</td>
<td>A6732-60</td>
<td>67000320</td>
<td>東區</td>
<td>67000</td>
<td>臺南市</td>
<td>171121.76303</td>
<td>2.540747e+06</td>
<td>12151.50679</td>
<td>POLYGON Z ((171065.623 2540812.968 0, 171117.3...</td>
<td>2.0</td>
<td>304.0</td>
<td>6.578947</td>
<td>6.0</td>
<td>289.0</td>
<td>20.761246</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>4737</td>
<td>A6733-0546-00</td>
<td>A6733-28-006</td>
<td>A6733-28</td>
<td>67000330</td>
<td>南區</td>
<td>67000</td>
<td>臺南市</td>
<td>166383.53981</td>
<td>2.540732e+06</td>
<td>24429.37370</td>
<td>POLYGON Z ((166306.724 2540811.815 0, 166306.9...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">5141</th>
<td>779</td>
<td>A6735-0775-00</td>
<td>A6735-38-005</td>
<td>A6735-38</td>
<td>67000350</td>
<td>安南區</td>
<td>67000</td>
<td>臺南市</td>
<td>166362.71262</td>
<td>2.549375e+06</td>
<td>19304.15704</td>
<td>POLYGON Z ((166374.559 2549491.189 0, 166412.8...</td>
<td>1.0</td>
<td>144.0</td>
<td>6.944444</td>
<td>1.0</td>
<td>127.0</td>
<td>7.874016</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5142</th>
<td>780</td>
<td>A6735-0759-00</td>
<td>A6735-26-005</td>
<td>A6735-26</td>
<td>67000350</td>
<td>安南區</td>
<td>67000</td>
<td>臺南市</td>
<td>167484.42419</td>
<td>2.549441e+06</td>
<td>7543.19820</td>
<td>POLYGON Z ((167445.095 2549487.087 0, 167548.8...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>6.0</td>
<td>127.0</td>
<td>47.244094</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">5143</th>
<td>781</td>
<td>A6735-0769-00</td>
<td>A6735-30-005</td>
<td>A6735-30</td>
<td>67000350</td>
<td>安南區</td>
<td>67000</td>
<td>臺南市</td>
<td>166722.60054</td>
<td>2.549380e+06</td>
<td>14166.79920</td>
<td>POLYGON Z ((166805.218 2549471.521 0, 166790.3...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5144</th>
<td>782</td>
<td>A6735-0771-00</td>
<td>A6735-31-003</td>
<td>A6735-31</td>
<td>67000350</td>
<td>安南區</td>
<td>67000</td>
<td>臺南市</td>
<td>170398.40330</td>
<td>2.549387e+06</td>
<td>13984.25205</td>
<td>POLYGON Z ((170338.023 2549462.8 0, 170495.755...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">5145</th>
<td>783</td>
<td>A6735-0854-00</td>
<td>A6735-27-008</td>
<td>A6735-27</td>
<td>67000350</td>
<td>安南區</td>
<td>67000</td>
<td>臺南市</td>
<td>162647.65552</td>
<td>2.549133e+06</td>
<td>218412.31759</td>
<td>POLYGON Z ((162601.142 2549410.382 0, 162699.5...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>5146 rows × 18 columns</p>
</div>
</div>
</div>
<div id="cell-74" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>filtered_tn_shp.to_file(<span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">Patrick</span><span class="ch">\\</span><span class="st">Desktop</span><span class="ch">\\</span><span class="st">full_tn.shp"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-75" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>merged_2015</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U_ID</th>
<th data-quarto-table-cell-role="th">CODEBASE</th>
<th data-quarto-table-cell-role="th">CODE1</th>
<th data-quarto-table-cell-role="th">CODE2</th>
<th data-quarto-table-cell-role="th">TOWN_ID</th>
<th data-quarto-table-cell-role="th">TOWN</th>
<th data-quarto-table-cell-role="th">COUNTY_ID</th>
<th data-quarto-table-cell-role="th">COUNTY</th>
<th data-quarto-table-cell-role="th">X</th>
<th data-quarto-table-cell-role="th">Y</th>
<th data-quarto-table-cell-role="th">AREA</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">Incidence_Rate_2015</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>5144</td>
<td>A6733-0874-00</td>
<td>A6733-43-012</td>
<td>A6733-43</td>
<td>67000330</td>
<td>南區</td>
<td>67000</td>
<td>臺南市</td>
<td>166173.68829</td>
<td>2.535589e+06</td>
<td>25735.24733</td>
<td>POLYGON Z ((166321.261 2535692.982 0, 166319 2...</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>5145</td>
<td>A6733-0878-00</td>
<td>A6733-44-006</td>
<td>A6733-44</td>
<td>67000330</td>
<td>南區</td>
<td>67000</td>
<td>臺南市</td>
<td>165894.50162</td>
<td>2.535469e+06</td>
<td>73573.78885</td>
<td>POLYGON Z ((165968.38 2535639.042 0, 165978.83...</td>
<td>12.658228</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>5146</td>
<td>A6733-0876-00</td>
<td>A6733-43-012</td>
<td>A6733-43</td>
<td>67000330</td>
<td>南區</td>
<td>67000</td>
<td>臺南市</td>
<td>166225.66291</td>
<td>2.535524e+06</td>
<td>20277.53652</td>
<td>POLYGON Z ((166317.999 2535628.685 0, 166318.5...</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>4736</td>
<td>A6732-0998-00</td>
<td>A6732-60-005</td>
<td>A6732-60</td>
<td>67000320</td>
<td>東區</td>
<td>67000</td>
<td>臺南市</td>
<td>171121.76303</td>
<td>2.540747e+06</td>
<td>12151.50679</td>
<td>POLYGON Z ((171065.623 2540812.968 0, 171117.3...</td>
<td>6.578947</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>4737</td>
<td>A6733-0546-00</td>
<td>A6733-28-006</td>
<td>A6733-28</td>
<td>67000330</td>
<td>南區</td>
<td>67000</td>
<td>臺南市</td>
<td>166383.53981</td>
<td>2.540732e+06</td>
<td>24429.37370</td>
<td>POLYGON Z ((166306.724 2540811.815 0, 166306.9...</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">5141</th>
<td>779</td>
<td>A6735-0775-00</td>
<td>A6735-38-005</td>
<td>A6735-38</td>
<td>67000350</td>
<td>安南區</td>
<td>67000</td>
<td>臺南市</td>
<td>166362.71262</td>
<td>2.549375e+06</td>
<td>19304.15704</td>
<td>POLYGON Z ((166374.559 2549491.189 0, 166412.8...</td>
<td>6.944444</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5142</th>
<td>780</td>
<td>A6735-0759-00</td>
<td>A6735-26-005</td>
<td>A6735-26</td>
<td>67000350</td>
<td>安南區</td>
<td>67000</td>
<td>臺南市</td>
<td>167484.42419</td>
<td>2.549441e+06</td>
<td>7543.19820</td>
<td>POLYGON Z ((167445.095 2549487.087 0, 167548.8...</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">5143</th>
<td>781</td>
<td>A6735-0769-00</td>
<td>A6735-30-005</td>
<td>A6735-30</td>
<td>67000350</td>
<td>安南區</td>
<td>67000</td>
<td>臺南市</td>
<td>166722.60054</td>
<td>2.549380e+06</td>
<td>14166.79920</td>
<td>POLYGON Z ((166805.218 2549471.521 0, 166790.3...</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5144</th>
<td>782</td>
<td>A6735-0771-00</td>
<td>A6735-31-003</td>
<td>A6735-31</td>
<td>67000350</td>
<td>安南區</td>
<td>67000</td>
<td>臺南市</td>
<td>170398.40330</td>
<td>2.549387e+06</td>
<td>13984.25205</td>
<td>POLYGON Z ((170338.023 2549462.8 0, 170495.755...</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">5145</th>
<td>783</td>
<td>A6735-0854-00</td>
<td>A6735-27-008</td>
<td>A6735-27</td>
<td>67000350</td>
<td>安南區</td>
<td>67000</td>
<td>臺南市</td>
<td>162647.65552</td>
<td>2.549133e+06</td>
<td>218412.31759</td>
<td>POLYGON Z ((162601.142 2549410.382 0, 162699.5...</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>5146 rows × 13 columns</p>
</div>
</div>
</div>
<div id="cell-76" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing values with a default value (e.g., 0 or -1, or use NaN for no data)</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>merged_2015[<span class="st">'Incidence_Rate_2015'</span>].fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)  <span class="co"># Fill NaNs with 0 (or you can use np.nan)</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>merged_2019[<span class="st">'Incidence_Rate_2019'</span>].fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>merged_2023[<span class="st">'Incidence_Rate_2023'</span>].fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the choropleth map for 2015</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>merged_2015.plot(column<span class="op">=</span><span class="st">'Incidence_Rate_2015'</span>, ax<span class="op">=</span>ax, legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>                 legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">"Dengue Incidence Rate (per 1000 people) in 2015"</span>,</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>},</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>                 cmap<span class="op">=</span><span class="st">'coolwarm'</span>,  <span class="co"># You can choose a different colormap</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>                 missing_kwds<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'gray'</span>})  <span class="co"># This sets the color for missing data</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Dengue Incidence Rate in 2015"</span>)</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the choropleth map for 2019</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>merged_2019.plot(column<span class="op">=</span><span class="st">'Incidence_Rate_2019'</span>, ax<span class="op">=</span>ax, legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>                 legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">"Dengue Incidence Rate (per 1000 people) in 2019"</span>,</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>},</span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>                 cmap<span class="op">=</span><span class="st">'coolwarm'</span>,</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>                 missing_kwds<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'gray'</span>})  <span class="co"># This sets the color for missing data</span></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Dengue Incidence Rate in 2019"</span>)</span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the choropleth map for 2023</span></span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>merged_2023.plot(column<span class="op">=</span><span class="st">'Incidence_Rate_2023'</span>, ax<span class="op">=</span>ax, legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>                 legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">"Dengue Incidence Rate (per 1000 people) in 2023"</span>,</span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>},</span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a>                 cmap<span class="op">=</span><span class="st">'coolwarm'</span>,</span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>                 missing_kwds<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'gray'</span>})  <span class="co"># This sets the color for missing data</span></span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Dengue Incidence Rate in 2023"</span>)</span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tn_dengue_cleaning_files/figure-html/cell-76-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tn_dengue_cleaning_files/figure-html/cell-76-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tn_dengue_cleaning_files/figure-html/cell-76-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Script to create time series plots of weekly aggregated new infections.</p>
<div id="cell-78" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>years_to_plot <span class="op">=</span> [<span class="dv">2015</span>, <span class="dv">2019</span>, <span class="dv">2023</span>]</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>output_directory <span class="op">=</span> <span class="st">"D:/Projects/TMU/Dengue"</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>os.makedirs(output_directory, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to generate weekly aggregated plot for a given year</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_weekly_aggregated_counts(df, year, output_dir):</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    df_year <span class="op">=</span> df[df[<span class="st">'Year'</span>] <span class="op">==</span> year]</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    df_year[<span class="st">'Week'</span>] <span class="op">=</span> df_year[<span class="st">'發病日'</span>].dt.isocalendar().week</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>    weekly_counts <span class="op">=</span> df_year.groupby(<span class="st">'Week'</span>).size()</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>    plt.plot(weekly_counts.index, weekly_counts.values, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Weekly Dengue Cases - </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Week Number'</span>)</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Number of Cases'</span>)</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>)</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'dengue_weekly_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">.png'</span>)</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>    plt.savefig(output_path)</span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output_path</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>plot_weekly_aggregated_counts(filtered_tn_dengue, <span class="dv">2015</span>, output_directory)</span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>plot_weekly_aggregated_counts(filtered_tn_dengue, <span class="dv">2019</span>, output_directory)</span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>plot_weekly_aggregated_counts(filtered_tn_dengue, <span class="dv">2023</span>, output_directory)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Patrick\AppData\Local\Temp\ipykernel_6396\2527858560.py:8: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_year['Week'] = df_year['發病日'].dt.isocalendar().week
C:\Users\Patrick\AppData\Local\Temp\ipykernel_6396\2527858560.py:8: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_year['Week'] = df_year['發病日'].dt.isocalendar().week
C:\Users\Patrick\AppData\Local\Temp\ipykernel_6396\2527858560.py:8: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_year['Week'] = df_year['發病日'].dt.isocalendar().week</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="114">
<pre><code>'D:/Projects/TMU/Dengue\\dengue_weekly_2023.png'</code></pre>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>