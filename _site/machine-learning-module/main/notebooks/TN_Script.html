<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>tn_script – Chuang Lab TMU</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/tmu-logo.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-1328d16024fb3741a6a12ba29620befe.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Chuang Lab TMU</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../module1/docs/index.qmd"> 
<span class="menu-text">Module 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../module2/docs/index.qmd"> 
<span class="menu-text">Module 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../module3/docs/index.qmd"> 
<span class="menu-text">Module 3</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../module4/docs/index.qmd"> 
<span class="menu-text">Module 4</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<div id="cell-0" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Import basic libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Point</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>ovitrap <span class="op">=</span> pd.read_csv(<span class="vs">r"D:</span><span class="er">\</span><span class="vs">Projects</span><span class="er">\</span><span class="vs">TMU</span><span class="er">\</span><span class="vs">gee_dengue</span><span class="dv">\d</span><span class="vs">ata</span><span class="ch">\r</span><span class="vs">aw</span><span class="er">\</span><span class="vs">TW_DENGUE</span><span class="er">\</span><span class="vs">ovitrap_data_origin</span><span class="dv">.</span><span class="vs">csv"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>dengue <span class="op">=</span> pd.read_csv(<span class="vs">r"D:</span><span class="er">\</span><span class="vs">Projects</span><span class="er">\</span><span class="vs">TMU</span><span class="er">\</span><span class="vs">gee_dengue</span><span class="dv">\d</span><span class="vs">ata</span><span class="ch">\r</span><span class="vs">aw</span><span class="er">\</span><span class="vs">TW_DENGUE</span><span class="dv">\D</span><span class="vs">engue_Daily</span><span class="dv">.</span><span class="vs">csv"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Patrick\AppData\Local\Temp\ipykernel_28220\3922407816.py:10: DtypeWarning: Columns (9) have mixed types. Specify dtype option on import or set low_memory=False.
  ovitrap = pd.read_csv(r"D:\Projects\TMU\gee_dengue\data\raw\TW_DENGUE\ovitrap_data_origin.csv")</code></pre>
</div>
</div>
<div id="cell-1" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define future directory for plots</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>save_dir <span class="op">=</span> <span class="st">'D:/Projects/TMU/Ovitrap_Dengue'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-2" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>vil_gjs <span class="op">=</span> gpd.read_file(<span class="vs">r'D:</span><span class="er">\</span><span class="vs">Projects</span><span class="er">\</span><span class="vs">TMU</span><span class="er">\</span><span class="vs">gee_dengue</span><span class="ch">\n</span><span class="vs">otebooks</span><span class="ch">\t</span><span class="vs">n_vil_dengue_ovitrap</span><span class="dv">.</span><span class="vs">geojson'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>bsa_gjs <span class="op">=</span> gpd.read_file(<span class="vs">r'D:</span><span class="er">\</span><span class="vs">Projects</span><span class="er">\</span><span class="vs">TMU</span><span class="er">\</span><span class="vs">gee_dengue</span><span class="ch">\n</span><span class="vs">otebooks</span><span class="ch">\t</span><span class="vs">n_bsa_dengue_ovitrap</span><span class="dv">.</span><span class="vs">geojson'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-3" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> should_rename(col):</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> col.startswith(<span class="st">"Y2023_"</span>) <span class="kw">or</span> col.startswith(<span class="st">"Y2015_"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rename_column(col):</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace Y2023 or Y2015 with just 23 or 15</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> re.sub(<span class="vs">r'</span><span class="dv">^</span><span class="vs">Y</span><span class="kw">(</span><span class="vs">2023</span><span class="cf">|</span><span class="vs">2015</span><span class="kw">)</span><span class="vs">'</span>, <span class="vs">r'</span><span class="ch">\1</span><span class="vs">'</span>, col)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace year</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> col.replace(<span class="st">"2023"</span>, <span class="st">"23"</span>).replace(<span class="st">"2015"</span>, <span class="st">"15"</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove _CNT</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> col.replace(<span class="st">"_CNT"</span>, <span class="st">""</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Collapse AxxAyy -&gt; Axxyy</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> re.sub(<span class="vs">r"A</span><span class="kw">(</span><span class="dv">\d</span><span class="op">+</span><span class="kw">)</span><span class="vs">A</span><span class="kw">(</span><span class="dv">\d</span><span class="op">+</span><span class="kw">)</span><span class="vs">"</span>, <span class="vs">r"A</span><span class="ch">\1\2</span><span class="vs">"</span>, col)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> col</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rename_dataframe_columns(gdf):</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    rename_map <span class="op">=</span> {col: rename_column(col) <span class="cf">for</span> col <span class="kw">in</span> gdf.columns <span class="cf">if</span> should_rename(col)}</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gdf.rename(columns<span class="op">=</span>rename_map)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply to both GeoDataFrames</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>vil_gjs <span class="op">=</span> rename_dataframe_columns(vil_gjs)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>bsa_gjs <span class="op">=</span> rename_dataframe_columns(bsa_gjs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-4" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the output folder and file name</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="vs">r"D:</span><span class="er">\</span><span class="vs">Projects</span><span class="er">\</span><span class="vs">TMU</span><span class="er">\</span><span class="vs">gee_dengue</span><span class="dv">\d</span><span class="vs">ata</span><span class="er">\</span><span class="vs">external</span><span class="er">\</span><span class="vs">geojson"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>output_file <span class="op">=</span> os.path.join(output_folder, <span class="st">"bsa_gjs.geojson"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the folder if it does not exist</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>os.makedirs(output_folder, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the GeoDataFrame</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>bsa_gjs.to_file(output_file, driver<span class="op">=</span><span class="st">"GeoJSON"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-5" class="cell" data-execution_count="40">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(vil_gjs[vil_gjs[<span class="st">'ORI_VILLAG'</span>].notna()])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>0</code></pre>
</div>
</div>
<div id="cell-6" class="cell" data-execution_count="42">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>vil_gjs <span class="op">=</span> vil_gjs.drop(columns<span class="op">=</span>[<span class="st">'ORI_VILLAG'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Script to clean up data.</p>
<div id="cell-8" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Change datetime and create year and week column for both datasets</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>dengue[<span class="st">'發病日'</span>] <span class="op">=</span> pd.to_datetime(dengue[<span class="st">'發病日'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y/%m/</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>dengue[<span class="st">'Year'</span>] <span class="op">=</span> dengue[<span class="st">'發病日'</span>].dt.year</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>dengue[<span class="st">'Week'</span>] <span class="op">=</span> dengue[<span class="st">'發病日'</span>].dt.isocalendar().week</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>dengue <span class="op">=</span> dengue.rename(columns<span class="op">=</span>{<span class="st">"最小統計區"</span>:<span class="st">'CODEBASE'</span>})</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>ovitrap[<span class="st">'StartTime'</span>] <span class="op">=</span> pd.to_datetime(ovitrap[<span class="st">'StartTime'</span>])</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>ovitrap[<span class="st">'Year'</span>] <span class="op">=</span> ovitrap[<span class="st">'StartTime'</span>].dt.year</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>ovitrap[<span class="st">'Week'</span>] <span class="op">=</span> ovitrap[<span class="st">'StartTime'</span>].dt.isocalendar().week</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Define relevant districts</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>allowed_districts <span class="op">=</span> [<span class="st">'東區'</span>, <span class="st">'安南區'</span>, <span class="st">'南區'</span>, <span class="st">'北區'</span>, <span class="st">'中西區'</span>, <span class="st">'安平區'</span>]</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the distribution</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ovitrap.groupby(<span class="st">'Year'</span>).size())</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dengue.groupby(<span class="st">'Year'</span>).size())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Year
2016      2613
2017     44449
2018    180249
2019    169706
2020    178635
2021    179127
2022    180047
2023    183986
2024    181585
2025       159
dtype: int64
Year
1998      344
1999       68
2000      139
2001      279
2002     5372
2003      145
2004      427
2005      306
2006     1074
2007     2179
2008      714
2009     1052
2010     1896
2011     1702
2012     1478
2013      860
2014    15732
2015    43783
2016      744
2017      343
2018      533
2019      640
2020      137
2021       12
2022       88
2023    26706
2024      495
dtype: int64</code></pre>
</div>
</div>
<div id="cell-9" class="cell" data-execution_count="37">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">list</span>(vil_gjs.columns))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>['ID', 'OBJECTID_1', 'VILLAGE', 'TOWN', 'COUNTY', 'TOWN_ID', 'COUNTY_ID', 'TV_ALL', 'VILLCODE', 'ORI_VILLAG', 'AREA', 'MAX_X', 'MAX_Y', 'MIN_X', 'MIN_Y', 'X', 'Y', 'V_ID', 'SORT', 'COUNTYNAME', 'TOWNNAME', 'OBJECTID', 'ORIG_FID', 'Shape_Leng', 'Shape_Le_1', 'Shape_Area', 'ET_ID', 'VILLAGE_ID', 'Y2023_A0A9_CNT', 'Y2023_A0A9_M_CNT', 'Y2023_A0A9_F_CNT', 'Y2023_A10A19_CNT', 'Y2023_A10A19_M_CNT', 'Y2023_A10A19_F_CNT', 'Y2023_A20A29_CNT', 'Y2023_A20A29_M_CNT', 'Y2023_A20A29_F_CNT', 'Y2023_A30A39_CNT', 'Y2023_A30A39_M_CNT', 'Y2023_A30A39_F_CNT', 'Y2023_A40A49_CNT', 'Y2023_A40A49_M_CNT', 'Y2023_A40A49_F_CNT', 'Y2023_A50A59_CNT', 'Y2023_A50A59_M_CNT', 'Y2023_A50A59_F_CNT', 'Y2023_A60A69_CNT', 'Y2023_A60A69_M_CNT', 'Y2023_A60A69_F_CNT', 'Y2023_A70A79_CNT', 'Y2023_A70A79_M_CNT', 'Y2023_A70A79_F_CNT', 'Y2023_A80A89_CNT', 'Y2023_A80A89_M_CNT', 'Y2023_A80A89_F_CNT', 'Y2023_A90A99_CNT', 'Y2023_A90A99_M_CNT', 'Y2023_A90A99_F_CNT', 'Y2023_A100UP_CNT', 'Y2023_A100UP_M_CNT', 'Y2023_A100UP_F_CNT', 'Y2015_A0A9_CNT', 'Y2015_A0A9_M_CNT', 'Y2015_A0A9_F_CNT', 'Y2015_A10A19_CNT', 'Y2015_A10A19_M_CNT', 'Y2015_A10A19_F_CNT', 'Y2015_A20A29_CNT', 'Y2015_A20A29_M_CNT', 'Y2015_A20A29_F_CNT', 'Y2015_A30A39_CNT', 'Y2015_A30A39_M_CNT', 'Y2015_A30A39_F_CNT', 'Y2015_A40A49_CNT', 'Y2015_A40A49_M_CNT', 'Y2015_A40A49_F_CNT', 'Y2015_A50A59_CNT', 'Y2015_A50A59_M_CNT', 'Y2015_A50A59_F_CNT', 'Y2015_A60A69_CNT', 'Y2015_A60A69_M_CNT', 'Y2015_A60A69_F_CNT', 'Y2015_A70A79_CNT', 'Y2015_A70A79_M_CNT', 'Y2015_A70A79_F_CNT', 'Y2015_A80A89_CNT', 'Y2015_A80A89_M_CNT', 'Y2015_A80A89_F_CNT', 'Y2015_A90A99_CNT', 'Y2015_A90A99_M_CNT', 'Y2015_A90A99_F_CNT', 'Y2015_A100UP_CNT', 'Y2015_A100UP_M_CNT', 'Y2015_A100UP_F_CNT', 'Y2015_H_CNT', 'Y2015_P_CNT', 'Y2015_M_CNT', 'Y2015_F_CNT', 'Y2023_H_CNT', 'Y2023_P_CNT', 'Y2023_M_CNT', 'Y2023_F_CNT', 'Y2015_Dengue', 'Y2023_Dengue', 'Y2023_Ovitrap', 'geometry']</code></pre>
</div>
</div>
<p>For the current study, we focuse on the data between year 2016~2025 and the old urban area of Tainan City (selected districts).</p>
<div id="cell-11" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Tainan shapefile</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>tw_shp <span class="op">=</span> gpd.read_file(<span class="vs">r"C:</span><span class="er">\</span><span class="vs">Users</span><span class="er">\</span><span class="vs">Patrick</span><span class="dv">\D</span><span class="vs">ownloads</span><span class="ch">\0</span><span class="dv">\G</span><span class="vs">97_TW_U0200_2015</span><span class="dv">.</span><span class="vs">shp"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>tw_shp.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'lightblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Visualization of tw_shp"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Longitude"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Latitude"</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-12" class="cell" data-execution_count="39">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Tainan shapefile</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>tn_shp_vil <span class="op">=</span> gpd.read_file(<span class="vs">r'D:</span><span class="er">\</span><span class="vs">Projects</span><span class="er">\</span><span class="vs">TMU</span><span class="er">\</span><span class="vs">gee_dengue</span><span class="dv">\d</span><span class="vs">ata</span><span class="er">\</span><span class="vs">external</span><span class="ch">\10</span><span class="vs">tnvillage</span><span class="ch">\10</span><span class="vs">_tn-village</span><span class="dv">.</span><span class="vs">shp'</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>tn_shp_vil <span class="op">=</span> tn_shp_vil.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>tn_shp_vil.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'lightblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Visualization of tn_shp_vil"</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Longitude"</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Latitude"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-13" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Tainan shapefile</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>tn_shp <span class="op">=</span> gpd.read_file(<span class="vs">r"D:</span><span class="er">\</span><span class="vs">Projects</span><span class="er">\</span><span class="vs">TMU</span><span class="er">\</span><span class="vs">gee_dengue</span><span class="dv">\d</span><span class="vs">ata</span><span class="er">\</span><span class="vs">external</span><span class="dv">\S</span><span class="vs">HP_TN</span><span class="ch">\t</span><span class="vs">n_shp_4326</span><span class="dv">.</span><span class="vs">shp"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>tn_shp <span class="op">=</span> tn_shp.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>tn_shp.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'lightblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Visualization of tn_shp"</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Longitude"</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Latitude"</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-14" class="cell" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram of integer U_ID values</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>plt.hist(tn_shp[<span class="st">'U_ID'</span>], bins<span class="op">=</span><span class="dv">30</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)  <span class="co"># Adjust bins as needed</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Histogram of U_ID'</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'U_ID'</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-15" class="cell" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>vil_gjs</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">OBJECTID_1</th>
<th data-quarto-table-cell-role="th">VILLAGE</th>
<th data-quarto-table-cell-role="th">TOWN</th>
<th data-quarto-table-cell-role="th">COUNTY</th>
<th data-quarto-table-cell-role="th">TOWN_ID</th>
<th data-quarto-table-cell-role="th">COUNTY_ID</th>
<th data-quarto-table-cell-role="th">TV_ALL</th>
<th data-quarto-table-cell-role="th">VILLCODE</th>
<th data-quarto-table-cell-role="th">ORI_VILLAG</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Y2015_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_H_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_P_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_M_CNT</th>
<th data-quarto-table-cell-role="th">Y2023_F_CNT</th>
<th data-quarto-table-cell-role="th">Y2015_Dengue</th>
<th data-quarto-table-cell-role="th">Y2023_Dengue</th>
<th data-quarto-table-cell-role="th">Y2023_Ovitrap</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>None</td>
<td>4377</td>
<td>內角里</td>
<td>白河區</td>
<td>臺南市</td>
<td>67000030</td>
<td>67000</td>
<td>白河區內角里</td>
<td>A6703-022-00</td>
<td>None</td>
<td>...</td>
<td>446</td>
<td>357</td>
<td>306</td>
<td>660</td>
<td>392</td>
<td>268</td>
<td>1</td>
<td>0</td>
<td>0.000000</td>
<td>POLYGON ((120.43652 23.41263, 120.43654 23.412...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>None</td>
<td>4378</td>
<td>蓮潭里</td>
<td>白河區</td>
<td>臺南市</td>
<td>67000030</td>
<td>67000</td>
<td>白河區蓮潭里</td>
<td>A6703-017-00</td>
<td>None</td>
<td>...</td>
<td>540</td>
<td>468</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>2</td>
<td>0</td>
<td>0.000000</td>
<td>POLYGON ((120.40732 23.41229, 120.40751 23.412...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>None</td>
<td>4379</td>
<td>草店里</td>
<td>白河區</td>
<td>臺南市</td>
<td>67000030</td>
<td>67000</td>
<td>白河區草店里</td>
<td>A6703-023-00</td>
<td>None</td>
<td>...</td>
<td>508</td>
<td>472</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.000000</td>
<td>POLYGON ((120.42996 23.40641, 120.4301 23.4064...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>None</td>
<td>4380</td>
<td>詔安里</td>
<td>白河區</td>
<td>臺南市</td>
<td>67000030</td>
<td>67000</td>
<td>白河區詔安里</td>
<td>A6703-015-00</td>
<td>None</td>
<td>...</td>
<td>522</td>
<td>482</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.000000</td>
<td>POLYGON ((120.41847 23.40612, 120.41857 23.405...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>None</td>
<td>4381</td>
<td>嘉田里</td>
<td>後壁區</td>
<td>臺南市</td>
<td>67000050</td>
<td>67000</td>
<td>後壁區嘉田里</td>
<td>A6705-005-00</td>
<td>None</td>
<td>...</td>
<td>687</td>
<td>626</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
<td>0.000000</td>
<td>POLYGON ((120.38221 23.40378, 120.3823 23.4038...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">747</th>
<td>None</td>
<td>6183</td>
<td>府南里</td>
<td>南區</td>
<td>臺南市</td>
<td>67000330</td>
<td>67000</td>
<td>南區府南里</td>
<td>A6733-034-00</td>
<td>None</td>
<td>...</td>
<td>2639</td>
<td>2796</td>
<td>1995</td>
<td>5371</td>
<td>2589</td>
<td>2782</td>
<td>177</td>
<td>207</td>
<td>8.285799</td>
<td>POLYGON ((120.19608 22.97502, 120.1965 22.9750...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">748</th>
<td>None</td>
<td>6184</td>
<td>光明里</td>
<td>南區</td>
<td>臺南市</td>
<td>67000330</td>
<td>67000</td>
<td>南區光明里</td>
<td>A6733-011-00</td>
<td>None</td>
<td>...</td>
<td>2400</td>
<td>2493</td>
<td>1809</td>
<td>4474</td>
<td>2164</td>
<td>2310</td>
<td>126</td>
<td>118</td>
<td>6.210064</td>
<td>POLYGON ((120.18752 22.97494, 120.18753 22.974...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">749</th>
<td>None</td>
<td>6185</td>
<td>崇明里</td>
<td>東區</td>
<td>臺南市</td>
<td>67000320</td>
<td>67000</td>
<td>東區崇明里</td>
<td>A6732-012-00</td>
<td>None</td>
<td>...</td>
<td>2437</td>
<td>2784</td>
<td>1949</td>
<td>4694</td>
<td>2248</td>
<td>2446</td>
<td>53</td>
<td>54</td>
<td>7.411960</td>
<td>POLYGON ((120.22312 22.97436, 120.22317 22.974...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">750</th>
<td>None</td>
<td>6186</td>
<td>鯤鯓里</td>
<td>南區</td>
<td>臺南市</td>
<td>67000330</td>
<td>67000</td>
<td>南區鯤鯓里</td>
<td>A6733-036-00</td>
<td>None</td>
<td>...</td>
<td>1076</td>
<td>1003</td>
<td>686</td>
<td>1874</td>
<td>961</td>
<td>913</td>
<td>12</td>
<td>16</td>
<td>21.469600</td>
<td>POLYGON ((120.16534 22.97204, 120.16536 22.972...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">751</th>
<td>None</td>
<td>7782</td>
<td>中沙里</td>
<td>安定區</td>
<td>臺南市</td>
<td>67000210</td>
<td>67000</td>
<td>安定區中沙里</td>
<td>A6721-012-00</td>
<td>None</td>
<td>...</td>
<td>412</td>
<td>393</td>
<td>265</td>
<td>783</td>
<td>396</td>
<td>387</td>
<td>1</td>
<td>0</td>
<td>0.000000</td>
<td>POLYGON ((120.21252 23.08121, 120.21446 23.081...</td>
</tr>
</tbody>
</table>

<p>752 rows × 106 columns</p>
</div>
</div>
</div>
<div id="cell-16" class="cell" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram of integer U_ID values</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>plt.hist(vil_gjs[<span class="st">'OBJECTID_1'</span>], bins<span class="op">=</span><span class="dv">30</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)  <span class="co"># Adjust bins as needed</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Histogram of OBJECTID_1'</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'OBJECTID_1'</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-17" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tn_shp[<span class="st">'U_ID'</span>].nunique(), tn_shp[<span class="st">'CODEBASE'</span>].nunique(), tn_shp[<span class="st">'CODE1'</span>].nunique(), tn_shp[<span class="st">'CODE2'</span>].nunique()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>(7628, 12774, 6322, 667)</code></pre>
</div>
</div>
<div id="cell-18" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>tn_shp[<span class="st">'TOWN_ID'</span>].nunique(), tn_shp[<span class="st">'TOWN'</span>].nunique(), tn_shp[<span class="st">'COUNTY_ID'</span>].nunique(), tn_shp[<span class="st">'COUNTY'</span>].nunique()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>(37, 37, 1, 1)</code></pre>
</div>
</div>
<div id="cell-19" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tn_shp</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U_ID</th>
<th data-quarto-table-cell-role="th">CODEBASE</th>
<th data-quarto-table-cell-role="th">CODE1</th>
<th data-quarto-table-cell-role="th">CODE2</th>
<th data-quarto-table-cell-role="th">TOWN_ID</th>
<th data-quarto-table-cell-role="th">TOWN</th>
<th data-quarto-table-cell-role="th">COUNTY_ID</th>
<th data-quarto-table-cell-role="th">COUNTY</th>
<th data-quarto-table-cell-role="th">X</th>
<th data-quarto-table-cell-role="th">Y</th>
<th data-quarto-table-cell-role="th">AREA</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1519</td>
<td>A6713-0044-00</td>
<td>A6713-03-004</td>
<td>A6713-03</td>
<td>67000130</td>
<td>學甲區</td>
<td>67000</td>
<td>臺南市</td>
<td>167095.16348</td>
<td>2.573509e+06</td>
<td>2.409279e+06</td>
<td>POLYGON Z ((120.17383 23.2717 0, 120.17414 23....</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1520</td>
<td>A6706-0169-00</td>
<td>A6706-10-004</td>
<td>A6706-10</td>
<td>67000060</td>
<td>東山區</td>
<td>67000</td>
<td>臺南市</td>
<td>195790.88048</td>
<td>2.574560e+06</td>
<td>1.871302e+05</td>
<td>POLYGON Z ((120.46841 23.27525 0, 120.46847 23...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1521</td>
<td>A6704-0124-00</td>
<td>A6704-07-007</td>
<td>A6704-07</td>
<td>67000040</td>
<td>柳營區</td>
<td>67000</td>
<td>臺南市</td>
<td>178154.64243</td>
<td>2.574746e+06</td>
<td>5.917852e+04</td>
<td>POLYGON Z ((120.29947 23.27444 0, 120.29947 23...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1522</td>
<td>A6701-0425-00</td>
<td>A6701-27-006</td>
<td>A6701-27</td>
<td>67000010</td>
<td>新營區</td>
<td>67000</td>
<td>臺南市</td>
<td>175860.08597</td>
<td>2.574747e+06</td>
<td>2.694759e+04</td>
<td>POLYGON Z ((120.27531 23.27419 0, 120.27567 23...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1593</td>
<td>A6706-0182-00</td>
<td>A6706-10-005</td>
<td>A6706-10</td>
<td>67000060</td>
<td>東山區</td>
<td>67000</td>
<td>臺南市</td>
<td>195370.86654</td>
<td>2.573953e+06</td>
<td>1.849167e+05</td>
<td>POLYGON Z ((120.4688 23.26962 0, 120.46887 23....</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12769</th>
<td>3108</td>
<td>A6710-0138-00</td>
<td>A6710-07-004</td>
<td>A6710-07</td>
<td>67000100</td>
<td>官田區</td>
<td>67000</td>
<td>臺南市</td>
<td>179864.54916</td>
<td>2.564638e+06</td>
<td>4.500631e+05</td>
<td>POLYGON Z ((120.31738 23.1852 0, 120.31813 23....</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">12770</th>
<td>3109</td>
<td>A6707-0157-00</td>
<td>A6707-05-006</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173376.00015</td>
<td>2.564946e+06</td>
<td>1.006336e+04</td>
<td>POLYGON Z ((120.25085 23.18521 0, 120.25103 23...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12771</th>
<td>3110</td>
<td>A6707-0163-00</td>
<td>A6707-05-007</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173493.29866</td>
<td>2.564901e+06</td>
<td>2.001176e+04</td>
<td>POLYGON Z ((120.2524 23.18523 0, 120.25242 23....</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">12772</th>
<td>3111</td>
<td>A6707-0164-00</td>
<td>A6707-05-008</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173594.45705</td>
<td>2.564904e+06</td>
<td>1.244706e+04</td>
<td>POLYGON Z ((120.25325 23.18522 0, 120.25395 23...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12773</th>
<td>3112</td>
<td>A6707-0165-00</td>
<td>A6707-05-009</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173714.55187</td>
<td>2.564907e+06</td>
<td>1.894120e+04</td>
<td>POLYGON Z ((120.25395 23.18522 0, 120.25414 23...</td>
</tr>
</tbody>
</table>

<p>12774 rows × 12 columns</p>
</div>
</div>
</div>
<div id="cell-20" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Transform different EPSG, as SHP files from Taiwanese official sources often use a different projection</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyproj <span class="im">import</span> Transformer</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>transformer <span class="op">=</span> Transformer.from_crs(<span class="st">"EPSG:3826"</span>, <span class="st">"EPSG:4326"</span>, always_xy<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>ovitrap[[<span class="st">'lon'</span>,<span class="st">'lat'</span>]] <span class="op">=</span> ovitrap.<span class="bu">apply</span>(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> row: pd.Series(transformer.transform(row[<span class="st">'X'</span>], row[<span class="st">'Y'</span>])),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    axis<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Inspecting the longtitudal and latitudal distribution of where ovitraps are setup.</p>
<div id="cell-22" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter Plot of Longitude and Latitude</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(ovitrap[<span class="st">'lon'</span>], ovitrap[<span class="st">'lat'</span>], alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolors<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Scatter Plot of Longitude and Latitude'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Longitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Latitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograms for Longitude and Latitude</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Longitude histogram</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].hist(ovitrap[<span class="st">'lon'</span>], bins<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'skyblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Longitude Distribution'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Longitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Frequency'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Latitude histogram</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].hist(ovitrap[<span class="st">'lat'</span>], bins<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'salmon'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Latitude Distribution'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Latitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Frequency'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleaning the data: Removing outliers</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>valid_lon <span class="op">=</span> ovitrap[<span class="st">'lon'</span>].between(<span class="dv">120</span>, <span class="dv">121</span>)</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>valid_lat <span class="op">=</span> ovitrap[<span class="st">'lat'</span>].between(<span class="dv">20</span>, <span class="dv">25</span>)</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>cleaned_ovitrap <span class="op">=</span> ovitrap[valid_lon <span class="op">&amp;</span> valid_lat]</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>invalid_lon <span class="op">=</span> <span class="op">~</span>ovitrap[<span class="st">'lon'</span>].between(<span class="dv">120</span>, <span class="dv">121</span>)</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>invalid_lat <span class="op">=</span> <span class="op">~</span>ovitrap[<span class="st">'lat'</span>].between(<span class="dv">20</span>, <span class="dv">25</span>)</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Outliers DataFrame</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>outliers <span class="op">=</span> ovitrap[invalid_lon <span class="op">|</span> invalid_lat]</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Error comes from XY being directly longtitude and latitude</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-21-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-21-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Correcting Statistics Outliers for Ovitrap</p>
<div id="cell-24" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correction for Outliers Data -&gt; Use XY as lon-lat directly</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>outliers[<span class="st">'lon'</span>] <span class="op">=</span> outliers[<span class="st">'X'</span>]</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>outliers[<span class="st">'lat'</span>] <span class="op">=</span> outliers[<span class="st">'Y'</span>]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>cleaned_ovitrap <span class="op">=</span> pd.concat([cleaned_ovitrap, outliers])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Patrick\AppData\Local\Temp\ipykernel_22236\426182415.py:2: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  outliers['lon'] = outliers['X']
C:\Users\Patrick\AppData\Local\Temp\ipykernel_22236\426182415.py:3: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  outliers['lat'] = outliers['Y']</code></pre>
</div>
</div>
<div id="cell-25" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>ovitrap</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SerialNo</th>
<th data-quarto-table-cell-role="th">X</th>
<th data-quarto-table-cell-role="th">Y</th>
<th data-quarto-table-cell-role="th">InvestigateUnit</th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">District</th>
<th data-quarto-table-cell-role="th">Village</th>
<th data-quarto-table-cell-role="th">Address</th>
<th data-quarto-table-cell-role="th">Outdoor</th>
<th data-quarto-table-cell-role="th">AddressComment</th>
<th data-quarto-table-cell-role="th">TotalEggs</th>
<th data-quarto-table-cell-role="th">LatestTotalEggs</th>
<th data-quarto-table-cell-role="th">AvgEggs</th>
<th data-quarto-table-cell-role="th">TotalBuckets</th>
<th data-quarto-table-cell-role="th">StartTime</th>
<th data-quarto-table-cell-role="th">EndTime</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Week</th>
<th data-quarto-table-cell-role="th">lon</th>
<th data-quarto-table-cell-role="th">lat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>20160725901</td>
<td>168197.0</td>
<td>2544049.0</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>中西區</td>
<td>天后里</td>
<td>永福路二段203號</td>
<td>True</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>2</td>
<td>2016-08-01</td>
<td>2016/08/07</td>
<td>2016</td>
<td>31</td>
<td>120.202060</td>
<td>22.995876</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>20160725902</td>
<td>168198.0</td>
<td>2544083.0</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>中西區</td>
<td>天后里</td>
<td>武廟右前方柱子下</td>
<td>True</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>2</td>
<td>2016-08-01</td>
<td>2016/08/07</td>
<td>2016</td>
<td>31</td>
<td>120.202068</td>
<td>22.996183</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>20160725903</td>
<td>168082.0</td>
<td>2544099.0</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>中西區</td>
<td>天后里</td>
<td>永福路二段197巷15號</td>
<td>True</td>
<td>NaN</td>
<td>60</td>
<td>46</td>
<td>30.0</td>
<td>2</td>
<td>2016-08-01</td>
<td>2016/08/07</td>
<td>2016</td>
<td>31</td>
<td>120.200936</td>
<td>22.996322</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>20160725904</td>
<td>167967.0</td>
<td>2544085.0</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>中西區</td>
<td>天后里</td>
<td>西門路二段272號（水果行）</td>
<td>True</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>2</td>
<td>2016-08-01</td>
<td>2016/08/07</td>
<td>2016</td>
<td>31</td>
<td>120.199815</td>
<td>22.996190</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>20160725905</td>
<td>168017.0</td>
<td>2544113.0</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>中西區</td>
<td>天后里</td>
<td>西門路二段300巷21號</td>
<td>True</td>
<td>NaN</td>
<td>9</td>
<td>0</td>
<td>4.5</td>
<td>2</td>
<td>2016-08-01</td>
<td>2016/08/07</td>
<td>2016</td>
<td>31</td>
<td>120.200301</td>
<td>22.996445</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1300551</th>
<td>2022TNRWA26</td>
<td>169750.0</td>
<td>2545486.0</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>北區</td>
<td>長勝里</td>
<td>開元路73巷41弄44號</td>
<td>True</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>1</td>
<td>2025-01-06</td>
<td>2025/01/12</td>
<td>2025</td>
<td>2</td>
<td>120.217133</td>
<td>23.008927</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1300552</th>
<td>2022TNRWA27</td>
<td>169671.0</td>
<td>2545369.0</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>北區</td>
<td>長勝里</td>
<td>開元路71巷33號</td>
<td>True</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>1</td>
<td>2025-01-06</td>
<td>2025/01/12</td>
<td>2025</td>
<td>2</td>
<td>120.216368</td>
<td>23.007867</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1300553</th>
<td>2022TNRWA28</td>
<td>169639.0</td>
<td>2545242.0</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>北區</td>
<td>長勝里</td>
<td>開元路63巷7弄68號</td>
<td>True</td>
<td>NaN</td>
<td>11</td>
<td>11</td>
<td>11.0</td>
<td>1</td>
<td>2025-01-06</td>
<td>2025/01/12</td>
<td>2025</td>
<td>2</td>
<td>120.216062</td>
<td>23.006719</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1300554</th>
<td>2022TNRWA29_1</td>
<td>169517.0</td>
<td>2544958.0</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>北區</td>
<td>中樓里</td>
<td>東豐路37號</td>
<td>True</td>
<td>34</td>
<td>74</td>
<td>74</td>
<td>74.0</td>
<td>1</td>
<td>2025-01-06</td>
<td>2025/01/12</td>
<td>2025</td>
<td>2</td>
<td>120.214887</td>
<td>23.004148</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1300555</th>
<td>2022TNRWA30</td>
<td>169462.0</td>
<td>2544719.0</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>北區</td>
<td>中樓里</td>
<td>前鋒路175巷7號</td>
<td>True</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>1</td>
<td>2025-01-06</td>
<td>2025/01/12</td>
<td>2025</td>
<td>2</td>
<td>120.214363</td>
<td>23.001988</td>
</tr>
</tbody>
</table>

<p>1300556 rows × 20 columns</p>
</div>
</div>
</div>
<div id="cell-26" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter Plot of Longitude and Latitude</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(cleaned_ovitrap[<span class="st">'lon'</span>], cleaned_ovitrap[<span class="st">'lat'</span>], alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolors<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Scatter Plot of Longitude and Latitude'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Longitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Latitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograms for Longitude and Latitude</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Longitude histogram</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].hist(cleaned_ovitrap[<span class="st">'lon'</span>], bins<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'skyblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Longitude Distribution'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Longitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Frequency'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Latitude histogram</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].hist(cleaned_ovitrap[<span class="st">'lat'</span>], bins<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'salmon'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Latitude Distribution'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Latitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Frequency'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-24-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-24-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Restrict ovitrap datapoints to the six urban districts of Tainan City.</p>
<div id="cell-28" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify ovitrap data and shp file</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>ovitrap_filtered <span class="op">=</span> cleaned_ovitrap[cleaned_ovitrap[<span class="st">'District'</span>].isin(allowed_districts)]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>shp_filtered <span class="op">=</span> tn_shp[tn_shp[<span class="st">'TOWN'</span>].isin(allowed_districts)]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-29" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter Plot of Longitude and Latitude</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(ovitrap_filtered[<span class="st">'lon'</span>], ovitrap_filtered[<span class="st">'lat'</span>], alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolors<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Scatter Plot of Longitude and Latitude'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Longitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Latitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograms for Longitude and Latitude</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Longitude histogram</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].hist(ovitrap_filtered[<span class="st">'lon'</span>], bins<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'skyblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Longitude Distribution'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Longitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Frequency'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Latitude histogram</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].hist(ovitrap_filtered[<span class="st">'lat'</span>], bins<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'salmon'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Latitude Distribution'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Latitude'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Frequency'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleaning the data: Removing outliers</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>valid_lon_2 <span class="op">=</span> ovitrap_filtered[<span class="st">'lon'</span>].between(<span class="dv">120</span>, <span class="dv">121</span>)</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>valid_lat_2 <span class="op">=</span> ovitrap_filtered[<span class="st">'lat'</span>].between(<span class="dv">20</span>, <span class="dv">25</span>)</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>cleaned_ovitrap_2 <span class="op">=</span> ovitrap_filtered[valid_lon_2 <span class="op">&amp;</span> valid_lat_2]</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>invalid_lon_2 <span class="op">=</span> <span class="op">~</span>ovitrap_filtered[<span class="st">'lon'</span>].between(<span class="dv">120</span>, <span class="dv">121</span>)</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>invalid_lat_2 <span class="op">=</span> <span class="op">~</span>ovitrap_filtered[<span class="st">'lat'</span>].between(<span class="dv">20</span>, <span class="dv">25</span>)</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Outliers DataFrame</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>outliers_2 <span class="op">=</span> ovitrap_filtered[invalid_lon_2 <span class="op">|</span> invalid_lat_2]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-26-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Script to create heatmaps based on Ovitrap data.</p>
<div id="cell-31" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Point</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Point geometries for each event</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>events_gdf <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    cleaned_ovitrap_2,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    geometry<span class="op">=</span>gpd.points_from_xy(cleaned_ovitrap_2[<span class="st">'lon'</span>], cleaned_ovitrap_2[<span class="st">'lat'</span>]),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span><span class="st">"EPSG:4326"</span>  <span class="co"># Use your coordinate reference system</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Check yearly distribution after cleaning</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(events_gdf[<span class="st">'Year'</span>].value_counts())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Year
2018    145050
2024    135619
2023    135528
2022    133657
2020    132866
2021    132778
2019    131774
2017     32489
2016      2613
2025       159
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="cell-32" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>events_gdf</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SerialNo</th>
<th data-quarto-table-cell-role="th">X</th>
<th data-quarto-table-cell-role="th">Y</th>
<th data-quarto-table-cell-role="th">InvestigateUnit</th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">District</th>
<th data-quarto-table-cell-role="th">Village</th>
<th data-quarto-table-cell-role="th">Address</th>
<th data-quarto-table-cell-role="th">Outdoor</th>
<th data-quarto-table-cell-role="th">AddressComment</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">LatestTotalEggs</th>
<th data-quarto-table-cell-role="th">AvgEggs</th>
<th data-quarto-table-cell-role="th">TotalBuckets</th>
<th data-quarto-table-cell-role="th">StartTime</th>
<th data-quarto-table-cell-role="th">EndTime</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Week</th>
<th data-quarto-table-cell-role="th">lon</th>
<th data-quarto-table-cell-role="th">lat</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>20160725901</td>
<td>168197.000000</td>
<td>2.544049e+06</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>中西區</td>
<td>天后里</td>
<td>永福路二段203號</td>
<td>True</td>
<td>NaN</td>
<td>...</td>
<td>0</td>
<td>0.0</td>
<td>2</td>
<td>2016-08-01</td>
<td>2016/08/07</td>
<td>2016</td>
<td>31</td>
<td>120.202060</td>
<td>22.995876</td>
<td>POINT (120.20206 22.99588)</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>20160725902</td>
<td>168198.000000</td>
<td>2.544083e+06</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>中西區</td>
<td>天后里</td>
<td>武廟右前方柱子下</td>
<td>True</td>
<td>NaN</td>
<td>...</td>
<td>0</td>
<td>0.0</td>
<td>2</td>
<td>2016-08-01</td>
<td>2016/08/07</td>
<td>2016</td>
<td>31</td>
<td>120.202068</td>
<td>22.996183</td>
<td>POINT (120.20207 22.99618)</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>20160725903</td>
<td>168082.000000</td>
<td>2.544099e+06</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>中西區</td>
<td>天后里</td>
<td>永福路二段197巷15號</td>
<td>True</td>
<td>NaN</td>
<td>...</td>
<td>46</td>
<td>30.0</td>
<td>2</td>
<td>2016-08-01</td>
<td>2016/08/07</td>
<td>2016</td>
<td>31</td>
<td>120.200936</td>
<td>22.996322</td>
<td>POINT (120.20094 22.99632)</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>20160725904</td>
<td>167967.000000</td>
<td>2.544085e+06</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>中西區</td>
<td>天后里</td>
<td>西門路二段272號（水果行）</td>
<td>True</td>
<td>NaN</td>
<td>...</td>
<td>0</td>
<td>0.0</td>
<td>2</td>
<td>2016-08-01</td>
<td>2016/08/07</td>
<td>2016</td>
<td>31</td>
<td>120.199815</td>
<td>22.996190</td>
<td>POINT (120.19981 22.99619)</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>20160725905</td>
<td>168017.000000</td>
<td>2.544113e+06</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>中西區</td>
<td>天后里</td>
<td>西門路二段300巷21號</td>
<td>True</td>
<td>NaN</td>
<td>...</td>
<td>0</td>
<td>4.5</td>
<td>2</td>
<td>2016-08-01</td>
<td>2016/08/07</td>
<td>2016</td>
<td>31</td>
<td>120.200301</td>
<td>22.996445</td>
<td>POINT (120.2003 22.99645)</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">218531</th>
<td>1701TWMZ902</td>
<td>120.194053</td>
<td>2.299339e+01</td>
<td>台南市衛生局</td>
<td>台南市</td>
<td>中西區</td>
<td>民主里</td>
<td>中正路347號</td>
<td>True</td>
<td>NaN</td>
<td>...</td>
<td>0</td>
<td>0.0</td>
<td>2</td>
<td>2018-12-17</td>
<td>2018/12/23</td>
<td>2018</td>
<td>51</td>
<td>120.194053</td>
<td>22.993390</td>
<td>POINT (120.19405 22.99339)</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">220672</th>
<td>1647TWXH901</td>
<td>120.193792</td>
<td>2.300121e+01</td>
<td>台南市衛生局</td>
<td>台南市</td>
<td>中西區</td>
<td>協和里</td>
<td>臨安路一段212巷12號</td>
<td>True</td>
<td>NaN</td>
<td>...</td>
<td>0</td>
<td>0.0</td>
<td>2</td>
<td>2018-12-24</td>
<td>2018/12/30</td>
<td>2018</td>
<td>52</td>
<td>120.193792</td>
<td>23.001207</td>
<td>POINT (120.19379 23.00121)</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">222109</th>
<td>1701TWMZ902</td>
<td>120.194053</td>
<td>2.299339e+01</td>
<td>台南市衛生局</td>
<td>台南市</td>
<td>中西區</td>
<td>民主里</td>
<td>中正路347號</td>
<td>True</td>
<td>NaN</td>
<td>...</td>
<td>0</td>
<td>0.0</td>
<td>2</td>
<td>2018-12-24</td>
<td>2018/12/30</td>
<td>2018</td>
<td>52</td>
<td>120.194053</td>
<td>22.993390</td>
<td>POINT (120.19405 22.99339)</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">226544</th>
<td>1647TWXH901</td>
<td>120.193792</td>
<td>2.300121e+01</td>
<td>台南市衛生局</td>
<td>台南市</td>
<td>中西區</td>
<td>協和里</td>
<td>臨安路一段212巷12號</td>
<td>True</td>
<td>NaN</td>
<td>...</td>
<td>0</td>
<td>0.0</td>
<td>1</td>
<td>2018-12-31</td>
<td>2019/01/06</td>
<td>2018</td>
<td>1</td>
<td>120.193792</td>
<td>23.001207</td>
<td>POINT (120.19379 23.00121)</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">227068</th>
<td>1701TWMZ902</td>
<td>120.194053</td>
<td>2.299339e+01</td>
<td>台南市衛生局</td>
<td>台南市</td>
<td>中西區</td>
<td>民主里</td>
<td>中正路347號</td>
<td>True</td>
<td>NaN</td>
<td>...</td>
<td>0</td>
<td>0.0</td>
<td>1</td>
<td>2018-12-31</td>
<td>2019/01/06</td>
<td>2018</td>
<td>1</td>
<td>120.194053</td>
<td>22.993390</td>
<td>POINT (120.19405 22.99339)</td>
</tr>
</tbody>
</table>

<p>982533 rows × 21 columns</p>
</div>
</div>
</div>
<div id="cell-33" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>unique_years <span class="op">=</span> events_gdf[<span class="st">"Year"</span>].unique()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each year and generate a plot</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> unique_years:</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the shapefile</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    shp_filtered.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"lightgrey"</span>, edgecolor<span class="op">=</span><span class="st">"Black"</span>, linewidth <span class="op">=</span> <span class="fl">0.15</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the events for that year</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    events_gdf[events_gdf[<span class="st">"Year"</span>] <span class="op">==</span> year].plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"red"</span>, markersize<span class="op">=</span><span class="fl">0.75</span>, label<span class="op">=</span><span class="ss">f"Ovitrap Locations </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Formatting</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"Events in </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    ax.legend()</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define file path</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    file_path <span class="op">=</span> os.path.join(save_dir, <span class="ss">f'Ovitrap_Locations_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">.png'</span>)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save figure before showing</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    plt.savefig(file_path)  </span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    plt.close()  <span class="co"># Close to free memory</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[13]</span><span class="ansi-green-fg">, line 21</span>
<span class="ansi-green-fg">     18</span> file_path = os.path.join(save_dir, <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">Ovitrap_Locations_</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>year<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span class="ansi-yellow-fg">.png</span><span class="ansi-yellow-fg">'</span>)
<span class="ansi-green-fg">     20</span> <span style="font-style:italic;color:rgb(95,135,135)"># Save figure before showing</span>
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">21</span> <span class="ansi-yellow-bg">plt</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">savefig</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">file_path</span><span class="ansi-yellow-bg">)</span>  
<span class="ansi-green-fg">     22</span> plt.close()  <span style="font-style:italic;color:rgb(95,135,135)"># Close to free memory</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">d:\Projects\TMU\gee_dengue\.conda\Lib\site-packages\matplotlib\pyplot.py:1243</span>, in <span class="ansi-cyan-fg">savefig</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-fg">   1240</span> fig = gcf()
<span class="ansi-green-fg">   1241</span> <span style="font-style:italic;color:rgb(95,135,135)"># savefig default implementation has no return, so mypy is unhappy</span>
<span class="ansi-green-fg">   1242</span> <span style="font-style:italic;color:rgb(95,135,135)"># presumably this is here because subclasses can return?</span>
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1243</span> res = <span class="ansi-yellow-bg">fig</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">savefig</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>  <span style="font-style:italic;color:rgb(95,135,135)"># type: ignore[func-returns-value]</span>
<span class="ansi-green-fg">   1244</span> fig.canvas.draw_idle()  <span style="font-style:italic;color:rgb(95,135,135)"># Need this if 'transparent=True', to reset colors.</span>
<span class="ansi-green-fg">   1245</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> res

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">d:\Projects\TMU\gee_dengue\.conda\Lib\site-packages\matplotlib\figure.py:3490</span>, in <span class="ansi-cyan-fg">Figure.savefig</span><span class="ansi-blue-fg">(self, fname, transparent, **kwargs)</span>
<span class="ansi-green-fg">   3488</span>     <span style="font-weight:bold;color:rgb(0,135,0)">for</span> ax <span style="font-weight:bold;color:rgb(175,0,255)">in</span> <span style="color:rgb(0,135,0)">self</span>.axes:
<span class="ansi-green-fg">   3489</span>         _recursively_make_axes_transparent(stack, ax)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">3490</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">canvas</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">print_figure</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">fname</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">d:\Projects\TMU\gee_dengue\.conda\Lib\site-packages\matplotlib\backend_bases.py:2184</span>, in <span class="ansi-cyan-fg">FigureCanvasBase.print_figure</span><span class="ansi-blue-fg">(self, filename, dpi, facecolor, edgecolor, orientation, format, bbox_inches, pad_inches, bbox_extra_artists, backend, **kwargs)</span>
<span class="ansi-green-fg">   2180</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">   2181</span>     <span style="font-style:italic;color:rgb(95,135,135)"># _get_renderer may change the figure dpi (as vector formats</span>
<span class="ansi-green-fg">   2182</span>     <span style="font-style:italic;color:rgb(95,135,135)"># force the figure dpi to 72), so we need to set it again here.</span>
<span class="ansi-green-fg">   2183</span>     <span style="font-weight:bold;color:rgb(0,135,0)">with</span> cbook._setattr_cm(<span style="color:rgb(0,135,0)">self</span>.figure, dpi=dpi):
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">2184</span>         result = <span class="ansi-yellow-bg">print_method</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">   2185</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">filename</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   2186</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">facecolor</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">facecolor</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   2187</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">edgecolor</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">edgecolor</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   2188</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">orientation</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">orientation</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   2189</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">bbox_inches_restore</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">_bbox_inches_restore</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   2190</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   2191</span> <span style="font-weight:bold;color:rgb(0,135,0)">finally</span>:
<span class="ansi-green-fg">   2192</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> bbox_inches <span style="font-weight:bold;color:rgb(175,0,255)">and</span> restore_bbox:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">d:\Projects\TMU\gee_dengue\.conda\Lib\site-packages\matplotlib\backend_bases.py:2040</span>, in <span class="ansi-cyan-fg">FigureCanvasBase._switch_canvas_and_return_print_method.&lt;locals&gt;.&lt;lambda&gt;</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-fg">   2036</span>     optional_kws = {  <span style="font-style:italic;color:rgb(95,135,135)"># Passed by print_figure for other renderers.</span>
<span class="ansi-green-fg">   2037</span>         <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">dpi</span><span class="ansi-yellow-fg">"</span>, <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">facecolor</span><span class="ansi-yellow-fg">"</span>, <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">edgecolor</span><span class="ansi-yellow-fg">"</span>, <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">orientation</span><span class="ansi-yellow-fg">"</span>,
<span class="ansi-green-fg">   2038</span>         <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">bbox_inches_restore</span><span class="ansi-yellow-fg">"</span>}
<span class="ansi-green-fg">   2039</span>     skip = optional_kws - {*inspect.signature(meth).parameters}
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">2040</span>     print_method = functools.wraps(meth)(<span style="font-weight:bold;color:rgb(0,135,0)">lambda</span> *args, **kwargs: <span class="ansi-yellow-bg">meth</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">   2041</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">{</span><span class="ansi-yellow-bg">k</span><span class="ansi-yellow-bg">:</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">v</span><span class="ansi-yellow-bg"> </span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">for</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">k</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">v</span><span class="ansi-yellow-bg"> </span><span style="font-weight:bold;color:rgb(175,0,255)" class="ansi-yellow-bg">in</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">items</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg"> </span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">if</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">k</span><span class="ansi-yellow-bg"> </span><span style="font-weight:bold;color:rgb(175,0,255)" class="ansi-yellow-bg">not</span><span class="ansi-yellow-bg"> </span><span style="font-weight:bold;color:rgb(175,0,255)" class="ansi-yellow-bg">in</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">skip</span><span class="ansi-yellow-bg">}</span><span class="ansi-yellow-bg">)</span>)
<span class="ansi-green-fg">   2042</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:  <span style="font-style:italic;color:rgb(95,135,135)"># Let third-parties do as they see fit.</span>
<span class="ansi-green-fg">   2043</span>     print_method = meth

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">d:\Projects\TMU\gee_dengue\.conda\Lib\site-packages\matplotlib\backends\backend_agg.py:481</span>, in <span class="ansi-cyan-fg">FigureCanvasAgg.print_png</span><span class="ansi-blue-fg">(self, filename_or_obj, metadata, pil_kwargs)</span>
<span class="ansi-green-fg">    434</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">print_png</span>(<span style="color:rgb(0,135,0)">self</span>, filename_or_obj, *, metadata=<span style="font-weight:bold;color:rgb(0,135,0)">None</span>, pil_kwargs=<span style="font-weight:bold;color:rgb(0,135,0)">None</span>):
<span class="ansi-green-fg">    435</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">    436</span> <span style="font-style:italic" class="ansi-yellow-fg">    Write the figure to a PNG file.</span>
<span class="ansi-green-fg">    437</span> 
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    479</span> <span style="font-style:italic" class="ansi-yellow-fg">        *metadata*, including the default 'Software' key.</span>
<span class="ansi-green-fg">    480</span> <span style="font-style:italic" class="ansi-yellow-fg">    """</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">481</span>     <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_print_pil</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">filename_or_obj</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">"</span><span class="ansi-yellow-fg ansi-yellow-bg">png</span><span class="ansi-yellow-fg ansi-yellow-bg">"</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">pil_kwargs</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">metadata</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">d:\Projects\TMU\gee_dengue\.conda\Lib\site-packages\matplotlib\backends\backend_agg.py:430</span>, in <span class="ansi-cyan-fg">FigureCanvasAgg._print_pil</span><span class="ansi-blue-fg">(self, filename_or_obj, fmt, pil_kwargs, metadata)</span>
<span class="ansi-green-fg">    425</span> <span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">    426</span> <span style="font-style:italic" class="ansi-yellow-fg">Draw the canvas, then save it using `.image.imsave` (to which</span>
<span class="ansi-green-fg">    427</span> <span style="font-style:italic" class="ansi-yellow-fg">*pil_kwargs* and *metadata* are forwarded).</span>
<span class="ansi-green-fg">    428</span> <span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">    429</span> FigureCanvasAgg.draw(<span style="color:rgb(0,135,0)">self</span>)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">430</span> <span class="ansi-yellow-bg">mpl</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">image</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">imsave</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    431</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">filename_or_obj</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">buffer_rgba</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">format</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">fmt</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">origin</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-fg ansi-yellow-bg">"</span><span class="ansi-yellow-fg ansi-yellow-bg">upper</span><span class="ansi-yellow-fg ansi-yellow-bg">"</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    432</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">dpi</span><span class="ansi-yellow-bg">=</span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">figure</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">dpi</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">metadata</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">metadata</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">pil_kwargs</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">pil_kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">d:\Projects\TMU\gee_dengue\.conda\Lib\site-packages\matplotlib\image.py:1644</span>, in <span class="ansi-cyan-fg">imsave</span><span class="ansi-blue-fg">(fname, arr, vmin, vmax, cmap, format, origin, dpi, metadata, pil_kwargs)</span>
<span class="ansi-green-fg">   1642</span> pil_kwargs.setdefault(<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">format</span><span class="ansi-yellow-fg">"</span>, <span style="color:rgb(0,135,0)">format</span>)
<span class="ansi-green-fg">   1643</span> pil_kwargs.setdefault(<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">dpi</span><span class="ansi-yellow-fg">"</span>, (dpi, dpi))
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1644</span> <span class="ansi-yellow-bg">image</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">save</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">fname</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">pil_kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">d:\Projects\TMU\gee_dengue\.conda\Lib\site-packages\PIL\Image.py:2591</span>, in <span class="ansi-cyan-fg">Image.save</span><span class="ansi-blue-fg">(self, fp, format, **params)</span>
<span class="ansi-green-fg">   2589</span>         fp = builtins.open(filename, <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">r+b</span><span class="ansi-yellow-fg">"</span>)
<span class="ansi-green-fg">   2590</span>     <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">2591</span>         fp = builtins.open(filename, <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">w+b</span><span class="ansi-yellow-fg">"</span>)
<span class="ansi-green-fg">   2592</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">   2593</span>     fp = cast(IO[<span style="color:rgb(0,135,0)">bytes</span>], fp)

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] No such file or directory: 'D:/Projects/TMU/Ovitrap_Dengue\\Ovitrap_Locations_2016.png'</pre>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-29-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-34" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure both GeoDataFrames have the same CRS</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>segments_gdf <span class="op">=</span> shp_filtered.to_crs(events_gdf.crs)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial join: Assign each event to a segment</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>joined_gdf <span class="op">=</span> gpd.sjoin(events_gdf, segments_gdf, how<span class="op">=</span><span class="st">"inner"</span>, predicate<span class="op">=</span><span class="st">"intersects"</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate event counts by segment and year</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>aggregated_counts <span class="op">=</span> joined_gdf.groupby([<span class="st">'Year'</span>, <span class="st">'index_right'</span>])[<span class="st">'AvgEggs'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge aggregated counts back with the segments shapefile</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>segments_gdf[<span class="st">'index'</span>] <span class="op">=</span> segments_gdf.index  <span class="co"># Ensure a matching key</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>heatmap_data <span class="op">=</span> segments_gdf.merge(aggregated_counts, left_on<span class="op">=</span><span class="st">'index'</span>, right_on<span class="op">=</span><span class="st">'index_right'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill NaN counts with 0 for areas with no events in a given year</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>heatmap_data[<span class="st">'AvgEggs'</span>] <span class="op">=</span> heatmap_data[<span class="st">'AvgEggs'</span>].fillna(<span class="dv">0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-35" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>heatmap_data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U_ID</th>
<th data-quarto-table-cell-role="th">CODEBASE</th>
<th data-quarto-table-cell-role="th">CODE1</th>
<th data-quarto-table-cell-role="th">CODE2</th>
<th data-quarto-table-cell-role="th">TOWN_ID</th>
<th data-quarto-table-cell-role="th">TOWN</th>
<th data-quarto-table-cell-role="th">COUNTY_ID</th>
<th data-quarto-table-cell-role="th">COUNTY</th>
<th data-quarto-table-cell-role="th">X</th>
<th data-quarto-table-cell-role="th">Y</th>
<th data-quarto-table-cell-role="th">AREA</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">index_right</th>
<th data-quarto-table-cell-role="th">AvgEggs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>5144</td>
<td>A6733-0874-00</td>
<td>A6733-43-012</td>
<td>A6733-43</td>
<td>67000330</td>
<td>南區</td>
<td>67000</td>
<td>臺南市</td>
<td>166173.68829</td>
<td>2.535589e+06</td>
<td>25735.24733</td>
<td>POLYGON Z ((120.18422 22.92033 0, 120.1842 22....</td>
<td>1485</td>
<td>2017.0</td>
<td>1485.0</td>
<td>0.00</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>5144</td>
<td>A6733-0874-00</td>
<td>A6733-43-012</td>
<td>A6733-43</td>
<td>67000330</td>
<td>南區</td>
<td>67000</td>
<td>臺南市</td>
<td>166173.68829</td>
<td>2.535589e+06</td>
<td>25735.24733</td>
<td>POLYGON Z ((120.18422 22.92033 0, 120.1842 22....</td>
<td>1485</td>
<td>2018.0</td>
<td>1485.0</td>
<td>658.83</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>5144</td>
<td>A6733-0874-00</td>
<td>A6733-43-012</td>
<td>A6733-43</td>
<td>67000330</td>
<td>南區</td>
<td>67000</td>
<td>臺南市</td>
<td>166173.68829</td>
<td>2.535589e+06</td>
<td>25735.24733</td>
<td>POLYGON Z ((120.18422 22.92033 0, 120.1842 22....</td>
<td>1485</td>
<td>2019.0</td>
<td>1485.0</td>
<td>416.00</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>5144</td>
<td>A6733-0874-00</td>
<td>A6733-43-012</td>
<td>A6733-43</td>
<td>67000330</td>
<td>南區</td>
<td>67000</td>
<td>臺南市</td>
<td>166173.68829</td>
<td>2.535589e+06</td>
<td>25735.24733</td>
<td>POLYGON Z ((120.18422 22.92033 0, 120.1842 22....</td>
<td>1485</td>
<td>2020.0</td>
<td>1485.0</td>
<td>871.00</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>5144</td>
<td>A6733-0874-00</td>
<td>A6733-43-012</td>
<td>A6733-43</td>
<td>67000330</td>
<td>南區</td>
<td>67000</td>
<td>臺南市</td>
<td>166173.68829</td>
<td>2.535589e+06</td>
<td>25735.24733</td>
<td>POLYGON Z ((120.18422 22.92033 0, 120.1842 22....</td>
<td>1485</td>
<td>2021.0</td>
<td>1485.0</td>
<td>847.50</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18495</th>
<td>780</td>
<td>A6735-0759-00</td>
<td>A6735-26-005</td>
<td>A6735-26</td>
<td>67000350</td>
<td>安南區</td>
<td>67000</td>
<td>臺南市</td>
<td>167484.42419</td>
<td>2.549441e+06</td>
<td>7543.19820</td>
<td>POLYGON Z ((120.19443 23.04494 0, 120.19545 23...</td>
<td>7931</td>
<td>2023.0</td>
<td>7931.0</td>
<td>123.50</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">18496</th>
<td>780</td>
<td>A6735-0759-00</td>
<td>A6735-26-005</td>
<td>A6735-26</td>
<td>67000350</td>
<td>安南區</td>
<td>67000</td>
<td>臺南市</td>
<td>167484.42419</td>
<td>2.549441e+06</td>
<td>7543.19820</td>
<td>POLYGON Z ((120.19443 23.04494 0, 120.19545 23...</td>
<td>7931</td>
<td>2024.0</td>
<td>7931.0</td>
<td>49.00</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18497</th>
<td>781</td>
<td>A6735-0769-00</td>
<td>A6735-30-005</td>
<td>A6735-30</td>
<td>67000350</td>
<td>安南區</td>
<td>67000</td>
<td>臺南市</td>
<td>166722.60054</td>
<td>2.549380e+06</td>
<td>14166.79920</td>
<td>POLYGON Z ((120.18819 23.04477 0, 120.18805 23...</td>
<td>7932</td>
<td>NaN</td>
<td>NaN</td>
<td>0.00</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">18498</th>
<td>782</td>
<td>A6735-0771-00</td>
<td>A6735-31-003</td>
<td>A6735-31</td>
<td>67000350</td>
<td>安南區</td>
<td>67000</td>
<td>臺南市</td>
<td>170398.40330</td>
<td>2.549387e+06</td>
<td>13984.25205</td>
<td>POLYGON Z ((120.22266 23.04487 0, 120.22421 23...</td>
<td>7933</td>
<td>NaN</td>
<td>NaN</td>
<td>0.00</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18499</th>
<td>783</td>
<td>A6735-0854-00</td>
<td>A6735-27-008</td>
<td>A6735-27</td>
<td>67000350</td>
<td>安南區</td>
<td>67000</td>
<td>臺南市</td>
<td>162647.65552</td>
<td>2.549133e+06</td>
<td>218412.31759</td>
<td>POLYGON Z ((120.14718 23.044 0, 120.14814 23.0...</td>
<td>7934</td>
<td>NaN</td>
<td>NaN</td>
<td>0.00</td>
</tr>
</tbody>
</table>

<p>18500 rows × 16 columns</p>
</div>
</div>
</div>
<div id="cell-36" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>tn_shp</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U_ID</th>
<th data-quarto-table-cell-role="th">CODEBASE</th>
<th data-quarto-table-cell-role="th">CODE1</th>
<th data-quarto-table-cell-role="th">CODE2</th>
<th data-quarto-table-cell-role="th">TOWN_ID</th>
<th data-quarto-table-cell-role="th">TOWN</th>
<th data-quarto-table-cell-role="th">COUNTY_ID</th>
<th data-quarto-table-cell-role="th">COUNTY</th>
<th data-quarto-table-cell-role="th">X</th>
<th data-quarto-table-cell-role="th">Y</th>
<th data-quarto-table-cell-role="th">AREA</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1519</td>
<td>A6713-0044-00</td>
<td>A6713-03-004</td>
<td>A6713-03</td>
<td>67000130</td>
<td>學甲區</td>
<td>67000</td>
<td>臺南市</td>
<td>167095.16348</td>
<td>2.573509e+06</td>
<td>2.409279e+06</td>
<td>POLYGON Z ((120.17383 23.2717 0, 120.17414 23....</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1520</td>
<td>A6706-0169-00</td>
<td>A6706-10-004</td>
<td>A6706-10</td>
<td>67000060</td>
<td>東山區</td>
<td>67000</td>
<td>臺南市</td>
<td>195790.88048</td>
<td>2.574560e+06</td>
<td>1.871302e+05</td>
<td>POLYGON Z ((120.46841 23.27525 0, 120.46847 23...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1521</td>
<td>A6704-0124-00</td>
<td>A6704-07-007</td>
<td>A6704-07</td>
<td>67000040</td>
<td>柳營區</td>
<td>67000</td>
<td>臺南市</td>
<td>178154.64243</td>
<td>2.574746e+06</td>
<td>5.917852e+04</td>
<td>POLYGON Z ((120.29947 23.27444 0, 120.29947 23...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1522</td>
<td>A6701-0425-00</td>
<td>A6701-27-006</td>
<td>A6701-27</td>
<td>67000010</td>
<td>新營區</td>
<td>67000</td>
<td>臺南市</td>
<td>175860.08597</td>
<td>2.574747e+06</td>
<td>2.694759e+04</td>
<td>POLYGON Z ((120.27531 23.27419 0, 120.27567 23...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1593</td>
<td>A6706-0182-00</td>
<td>A6706-10-005</td>
<td>A6706-10</td>
<td>67000060</td>
<td>東山區</td>
<td>67000</td>
<td>臺南市</td>
<td>195370.86654</td>
<td>2.573953e+06</td>
<td>1.849167e+05</td>
<td>POLYGON Z ((120.4688 23.26962 0, 120.46887 23....</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12769</th>
<td>3108</td>
<td>A6710-0138-00</td>
<td>A6710-07-004</td>
<td>A6710-07</td>
<td>67000100</td>
<td>官田區</td>
<td>67000</td>
<td>臺南市</td>
<td>179864.54916</td>
<td>2.564638e+06</td>
<td>4.500631e+05</td>
<td>POLYGON Z ((120.31738 23.1852 0, 120.31813 23....</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">12770</th>
<td>3109</td>
<td>A6707-0157-00</td>
<td>A6707-05-006</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173376.00015</td>
<td>2.564946e+06</td>
<td>1.006336e+04</td>
<td>POLYGON Z ((120.25085 23.18521 0, 120.25103 23...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12771</th>
<td>3110</td>
<td>A6707-0163-00</td>
<td>A6707-05-007</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173493.29866</td>
<td>2.564901e+06</td>
<td>2.001176e+04</td>
<td>POLYGON Z ((120.2524 23.18523 0, 120.25242 23....</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">12772</th>
<td>3111</td>
<td>A6707-0164-00</td>
<td>A6707-05-008</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173594.45705</td>
<td>2.564904e+06</td>
<td>1.244706e+04</td>
<td>POLYGON Z ((120.25325 23.18522 0, 120.25395 23...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12773</th>
<td>3112</td>
<td>A6707-0165-00</td>
<td>A6707-05-009</td>
<td>A6707-05</td>
<td>67000070</td>
<td>麻豆區</td>
<td>67000</td>
<td>臺南市</td>
<td>173714.55187</td>
<td>2.564907e+06</td>
<td>1.894120e+04</td>
<td>POLYGON Z ((120.25395 23.18522 0, 120.25414 23...</td>
</tr>
</tbody>
</table>

<p>12774 rows × 12 columns</p>
</div>
</div>
</div>
<div id="cell-37" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define years to plot </span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> [<span class="dv">2015</span>, <span class="dv">2016</span>, <span class="dv">2017</span>, <span class="dv">2018</span>, <span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>, <span class="dv">2024</span>]</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame with all combinations of years and segments</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>all_segments <span class="op">=</span> pd.DataFrame({</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Year'</span>: [year <span class="cf">for</span> year <span class="kw">in</span> years <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(segments_gdf))],</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'index'</span>: [index <span class="cf">for</span> _ <span class="kw">in</span> years <span class="cf">for</span> index <span class="kw">in</span> segments_gdf.index]</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure geometry is correctly managed</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>segments_gdf <span class="op">=</span> segments_gdf.reset_index()  <span class="co"># Reset index to ensure clean merging</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with the shapefile to ensure all segments are included for each year</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>full_template <span class="op">=</span> pd.merge(</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    all_segments,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    segments_gdf[[<span class="st">'index'</span>, <span class="st">'geometry'</span>]],  <span class="co"># Select only required columns</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">'index'</span>,</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with aggregated data to fill in missing combinations with NaN</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>heatmap_data_full <span class="op">=</span> pd.merge(</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    full_template,</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    heatmap_data,</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span>[<span class="st">'Year'</span>, <span class="st">'index'</span>],</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing values for AvgEggs with 0</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>heatmap_data_full[<span class="st">'AvgEggs'</span>] <span class="op">=</span> heatmap_data_full[<span class="st">'AvgEggs'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop any duplicate or conflicting geometry columns</span></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'geometry_x'</span> <span class="kw">in</span> heatmap_data_full.columns <span class="kw">or</span> <span class="st">'geometry_y'</span> <span class="kw">in</span> heatmap_data_full.columns:</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>    heatmap_data_full[<span class="st">'geometry'</span>] <span class="op">=</span> heatmap_data_full[<span class="st">'geometry_x'</span>].combine_first(heatmap_data_full[<span class="st">'geometry_y'</span>])</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>    heatmap_data_full <span class="op">=</span> heatmap_data_full.drop(columns<span class="op">=</span>[<span class="st">'geometry_x'</span>, <span class="st">'geometry_y'</span>])</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to GeoDataFrame for plotting</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>full_gdf <span class="op">=</span> gpd.GeoDataFrame(heatmap_data_full, geometry<span class="op">=</span><span class="st">'geometry'</span>, crs<span class="op">=</span>segments_gdf.crs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-38" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting heatmaps</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> years:</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data for the current year</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    year_data <span class="op">=</span> full_gdf[full_gdf[<span class="st">'Year'</span>] <span class="op">==</span> year]</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(save_dir):</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>        os.makedirs(save_dir)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a plot</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the shapefile with counts as a heatmap</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    year_data.plot(</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>        column<span class="op">=</span><span class="st">'AvgEggs'</span>,       <span class="co"># The column to color by (event counts)</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>        cmap<span class="op">=</span><span class="st">'OrRd'</span>,           <span class="co"># Color map for the heatmap</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>        legend<span class="op">=</span><span class="va">True</span>,           <span class="co"># Show a legend</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>        edgecolor<span class="op">=</span><span class="va">None</span>,        <span class="co"># Remove borders</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>        missing_kwds<span class="op">=</span>{</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"color"</span>: <span class="st">"lightgray"</span>,  <span class="co"># Set the color for missing values</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"label"</span>: <span class="st">"No data"</span>     <span class="co"># Add a label for missing data in the legend</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Customize plot</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"Aggregated AvgEggs in each BSA in </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>    ax.set_axis_off()  <span class="co"># Remove axis for better visual appeal</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save the heatmap</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>    save_path <span class="op">=</span> os.path.join(save_dir, <span class="ss">f"heatmap_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">.png"</span>)</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    plt.savefig(save_path, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>    plt.close(fig)  <span class="co"># Close the figure to free memory</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Heatmap for </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss"> saved to </span><span class="sc">{</span>save_path<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Heatmap for 2015 saved to D:/Projects/TMU/Ovitrap_Dengue\heatmap_2015.png
Heatmap for 2016 saved to D:/Projects/TMU/Ovitrap_Dengue\heatmap_2016.png
Heatmap for 2017 saved to D:/Projects/TMU/Ovitrap_Dengue\heatmap_2017.png
Heatmap for 2018 saved to D:/Projects/TMU/Ovitrap_Dengue\heatmap_2018.png
Heatmap for 2019 saved to D:/Projects/TMU/Ovitrap_Dengue\heatmap_2019.png
Heatmap for 2020 saved to D:/Projects/TMU/Ovitrap_Dengue\heatmap_2020.png
Heatmap for 2021 saved to D:/Projects/TMU/Ovitrap_Dengue\heatmap_2021.png
Heatmap for 2022 saved to D:/Projects/TMU/Ovitrap_Dengue\heatmap_2022.png
Heatmap for 2023 saved to D:/Projects/TMU/Ovitrap_Dengue\heatmap_2023.png
Heatmap for 2024 saved to D:/Projects/TMU/Ovitrap_Dengue\heatmap_2024.png</code></pre>
</div>
</div>
<p>Script to create time series plot for weekly aggregated AvgEggs.</p>
<div id="cell-40" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by year and week, and sum AvgEggs</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>weekly_aggregated <span class="op">=</span> ovitrap_filtered.groupby([<span class="st">'Year'</span>, <span class="st">'Week'</span>])[<span class="st">'AvgEggs'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate individual plots for each year</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>unique_years <span class="op">=</span> weekly_aggregated[<span class="st">'Year'</span>].unique()</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> unique_years:</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    yearly_data <span class="op">=</span> weekly_aggregated[weekly_aggregated[<span class="st">'Year'</span>] <span class="op">==</span> year]</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    plt.plot(yearly_data[<span class="st">'Week'</span>], yearly_data[<span class="st">'AvgEggs'</span>], marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Weekly Aggregated AvgEggs Counts - Year </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Week Number'</span>)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Aggregated AvgEggs Count'</span>)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>)</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save the plot</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    file_path <span class="op">=</span> os.path.join(save_dir, <span class="ss">f'weekly_avg_eggs_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">.png'</span>)</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    plt.savefig(file_path)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    plt.close()  <span class="co"># Close the plot to free up memory</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-41" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting a version where Weekly AvgEggs curves are overlayed atop each other</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> weekly_aggregated[<span class="st">'Year'</span>].unique():</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    yearly_data <span class="op">=</span> weekly_aggregated[weekly_aggregated[<span class="st">'Year'</span>] <span class="op">==</span> year]</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    plt.plot(yearly_data[<span class="st">'Week'</span>], yearly_data[<span class="st">'AvgEggs'</span>], label<span class="op">=</span><span class="ss">f'Year </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Weekly Aggregated AvgEggs Counts All Years'</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Week Number'</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Aggregated AvgEggs Count'</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> os.path.join(save_dir, <span class="ss">f'weekly_avgs_eggs_all.png'</span>)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>plt.savefig(file_path)</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>plt.close()  <span class="co"># Close the plot to free up memory</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Script to create whole year aggregated egg counts.</p>
<div id="cell-43" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate the total AvgEggs count per year</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>yearly_aggregated <span class="op">=</span> ovitrap_filtered.groupby(<span class="st">'Year'</span>)[<span class="st">'AvgEggs'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for the range 2018-2024</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>yearly_aggregated <span class="op">=</span> yearly_aggregated[(yearly_aggregated[<span class="st">'Year'</span>] <span class="op">&gt;=</span> <span class="dv">2016</span>) <span class="op">&amp;</span> (yearly_aggregated[<span class="st">'Year'</span>] <span class="op">&lt;=</span> <span class="dv">2024</span>)]</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the yearly trend</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>plt.plot(yearly_aggregated[<span class="st">'Year'</span>], yearly_aggregated[<span class="st">'AvgEggs'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Total Aggregated AvgEggs Count Per Year (2018-2024)'</span>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year'</span>)</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Aggregated AvgEggs Count'</span>)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the plot</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> os.path.join(save_dir, <span class="st">'yearly_avg_eggs_2018_2024.png'</span>)</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>plt.savefig(file_path)</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>plt.show()  <span class="co"># Show the plot</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-37-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-44" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by Year and Week to count entries</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>weekly_counts <span class="op">=</span> ovitrap_filtered.groupby([<span class="st">'Year'</span>, <span class="st">'Week'</span>]).size().unstack(level<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot each year's weekly data</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> weekly_counts.columns:</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    plt.plot(weekly_counts.index, weekly_counts[year], label<span class="op">=</span>year, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Week Number"</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Number of Entries"</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Weekly Number of Entries (2016-2025)"</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">"Year"</span>)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Save plot instead of showing</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Change this to your desired directory</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>os.makedirs(save_dir, exist_ok<span class="op">=</span><span class="va">True</span>)  <span class="co"># Ensure directory exists</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>save_path <span class="op">=</span> os.path.join(save_dir, <span class="st">"weekly_entries.png"</span>)</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>plt.savefig(save_path, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Plot saved to </span><span class="sc">{</span>save_path<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Plot saved to D:/Projects/TMU/Ovitrap_Dengue\weekly_entries.png</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-38-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As 2016 and 2017 have way less base ovitraps set up, we exclude these two years from subsequent plotting.</p>
<div id="cell-46" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we create a version that shows weekly aggregated but chains together all years between 2018 and 2025.</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data to include only 2018 onwards (without modifying original data)</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>plot_data <span class="op">=</span> ovitrap_filtered[ovitrap_filtered[<span class="st">'Year'</span>] <span class="op">&gt;=</span> <span class="dv">2018</span>].copy()</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a continuous week index for plotting</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>plot_data[<span class="st">'Continuous_Week'</span>] <span class="op">=</span> (plot_data[<span class="st">'Year'</span>] <span class="op">-</span> <span class="dv">2018</span>) <span class="op">*</span> <span class="dv">52</span> <span class="op">+</span> plot_data[<span class="st">'Week'</span>]</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate data by continuous week index</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>weekly_aggregated <span class="op">=</span> (</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    plot_data</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'Continuous_Week'</span>)[<span class="st">'AvgEggs'</span>]</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Define year transition points</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>year_start_weeks <span class="op">=</span> {year: (year <span class="op">-</span> <span class="dv">2018</span>) <span class="op">*</span> <span class="dv">52</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">for</span> year <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2018</span>, <span class="dv">2025</span>)}</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>plt.plot(weekly_aggregated[<span class="st">'Continuous_Week'</span>], weekly_aggregated[<span class="st">'AvgEggs'</span>], marker<span class="op">=</span><span class="va">None</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Add vertical lines for year boundaries</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year, week <span class="kw">in</span> year_start_weeks.items():</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>    plt.axvline(x<span class="op">=</span>week, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>    plt.text(week <span class="op">+</span> <span class="dv">1</span>, weekly_aggregated[<span class="st">'AvgEggs'</span>].<span class="bu">max</span>() <span class="op">*</span> <span class="fl">0.9</span>, <span class="bu">str</span>(year), color<span class="op">=</span><span class="st">'red'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Total Aggregated AvgEggs Count Per Week (2018-2024)'</span>)</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Continuous Week Number'</span>)</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Aggregated AvgEggs Count'</span>)</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the plot</span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> os.path.join(save_dir, <span class="st">'weekly_avg_eggs_2018_2024.png'</span>)</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>plt.savefig(file_path)</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>plt.show()  <span class="co"># Show the plot</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This section performs IDW interpolation, comment out to use.</p>
<div id="cell-48" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import os</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># import numpy as np</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># import geopandas as gpd</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># import matplotlib.pyplot as plt</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># from scipy.spatial import distance_matrix</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co"># from rasterio.mask import mask</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># import rasterio</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co"># from rasterio.transform import from_origin</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # Function to perform IDW interpolation</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co"># # Process data in chunks to avoid memory issues</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co"># def idw_interpolation(coords, values, grid_x, grid_y, power=2, chunk_size=50):</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     grid_shape = grid_x.shape</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     grid_points = np.column_stack([grid_x.flatten(), grid_y.flatten()])</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     idw_values = np.zeros(grid_points.shape[0])</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Process grid points in smaller chunks</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     for i in range(0, len(grid_points), chunk_size):</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="co">#         chunk = grid_points[i:i + chunk_size]</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="co">#         dist_matrix = distance_matrix(coords, chunk)</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="co">#         # Avoid division by zero by setting zero distances to a very small value</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="co">#         dist_matrix[dist_matrix == 0] = 1e-10</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="co">#         weights = 1 / (dist_matrix ** power)</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="co">#         weights_sum = weights.sum(axis=0)</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="co">#         # Normalize weights and compute IDW</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a><span class="co">#         normalized_weights = weights / weights_sum</span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a><span class="co">#         idw_values[i:i + chunk_size] = np.dot(normalized_weights.T, values)</span></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     return idw_values.reshape(grid_shape)</span></span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a><span class="co"># # Ensure coordinate systems match</span></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a><span class="co"># shp_filtered = shp_filtered.to_crs("EPSG:4326")</span></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a><span class="co"># events_gdf = events_gdf.to_crs("EPSG:4326")</span></span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a><span class="co"># # Set the year range</span></span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a><span class="co"># years = list(range(2015, 2025))</span></span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a><span class="co"># # Grid resolution (adjust as needed)</span></span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a><span class="co"># grid_resolution = 500  # Number of grid cells per dimension</span></span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # Iterate over the years</span></span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a><span class="co"># for year in years:</span></span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"Processing year {year}...")</span></span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Filter events for the specific year</span></span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a><span class="co">#     filtered_events = events_gdf[events_gdf['year'] == year]</span></span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a><span class="co">#     if filtered_events.empty:</span></span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(f"No data available for year {year}. Skipping.")</span></span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a><span class="co">#         continue</span></span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Generate a grid of points within the bounds of the filtered shapefile</span></span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a><span class="co">#     minx, miny, maxx, maxy = shp_filtered.total_bounds</span></span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a><span class="co">#     grid_x, grid_y = np.meshgrid(np.linspace(minx, maxx, grid_resolution),</span></span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  np.linspace(miny, maxy, grid_resolution))</span></span>
<span id="cb49-61"><a href="#cb49-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-62"><a href="#cb49-62" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Extract the coordinates and values</span></span>
<span id="cb49-63"><a href="#cb49-63" aria-hidden="true" tabindex="-1"></a><span class="co">#     coords = np.array(list(zip(filtered_events['lon'], filtered_events['lat'])))</span></span>
<span id="cb49-64"><a href="#cb49-64" aria-hidden="true" tabindex="-1"></a><span class="co">#     values = filtered_events['AvgEggs'].values</span></span>
<span id="cb49-65"><a href="#cb49-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-66"><a href="#cb49-66" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Perform IDW interpolation</span></span>
<span id="cb49-67"><a href="#cb49-67" aria-hidden="true" tabindex="-1"></a><span class="co">#     idw_values = idw_interpolation(coords, values, grid_x, grid_y)</span></span>
<span id="cb49-68"><a href="#cb49-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-69"><a href="#cb49-69" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Create a raster for the IDW surface</span></span>
<span id="cb49-70"><a href="#cb49-70" aria-hidden="true" tabindex="-1"></a><span class="co">#     transform = from_origin(minx, maxy, (maxx - minx) / grid_resolution, (maxy - miny) / grid_resolution)</span></span>
<span id="cb49-71"><a href="#cb49-71" aria-hidden="true" tabindex="-1"></a><span class="co">#     raster_path = os.path.join(save_dir, f"idw_{year}.tif")</span></span>
<span id="cb49-72"><a href="#cb49-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-73"><a href="#cb49-73" aria-hidden="true" tabindex="-1"></a><span class="co">#     with rasterio.open(raster_path, 'w', driver='GTiff', count=1, dtype='float32',</span></span>
<span id="cb49-74"><a href="#cb49-74" aria-hidden="true" tabindex="-1"></a><span class="co">#                        crs=shp_filtered.crs.to_string(), transform=transform,</span></span>
<span id="cb49-75"><a href="#cb49-75" aria-hidden="true" tabindex="-1"></a><span class="co">#                        width=grid_x.shape[1], height=grid_x.shape[0]) as dst:</span></span>
<span id="cb49-76"><a href="#cb49-76" aria-hidden="true" tabindex="-1"></a><span class="co">#         dst.write(idw_values.astype('float32'), 1)</span></span>
<span id="cb49-77"><a href="#cb49-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-78"><a href="#cb49-78" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Mask the IDW raster using the shapefile</span></span>
<span id="cb49-79"><a href="#cb49-79" aria-hidden="true" tabindex="-1"></a><span class="co">#     with rasterio.open(raster_path) as src:</span></span>
<span id="cb49-80"><a href="#cb49-80" aria-hidden="true" tabindex="-1"></a><span class="co">#         out_image, out_transform = mask(src, shp_filtered.geometry, crop=True)</span></span>
<span id="cb49-81"><a href="#cb49-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-82"><a href="#cb49-82" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Save the masked raster</span></span>
<span id="cb49-83"><a href="#cb49-83" aria-hidden="true" tabindex="-1"></a><span class="co">#     masked_raster_path = os.path.join(save_dir, f"idw_{year}_masked.tif")</span></span>
<span id="cb49-84"><a href="#cb49-84" aria-hidden="true" tabindex="-1"></a><span class="co">#     with rasterio.open(masked_raster_path, 'w', driver='GTiff', count=1, dtype='float32',</span></span>
<span id="cb49-85"><a href="#cb49-85" aria-hidden="true" tabindex="-1"></a><span class="co">#                        crs=shp_filtered.crs.to_string(), transform=out_transform,</span></span>
<span id="cb49-86"><a href="#cb49-86" aria-hidden="true" tabindex="-1"></a><span class="co">#                        width=out_image.shape[2], height=out_image.shape[1]) as dst:</span></span>
<span id="cb49-87"><a href="#cb49-87" aria-hidden="true" tabindex="-1"></a><span class="co">#         dst.write(out_image[0], 1)</span></span>
<span id="cb49-88"><a href="#cb49-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-89"><a href="#cb49-89" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Plot the result</span></span>
<span id="cb49-90"><a href="#cb49-90" aria-hidden="true" tabindex="-1"></a><span class="co">#     plot_path = os.path.join(save_dir, f"idw_{year}.png")</span></span>
<span id="cb49-91"><a href="#cb49-91" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.figure(figsize=(10, 8))</span></span>
<span id="cb49-92"><a href="#cb49-92" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.imshow(out_image[0], cmap='viridis', extent=[minx, maxx, miny, maxy])</span></span>
<span id="cb49-93"><a href="#cb49-93" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.colorbar(label='Average Eggs Count')</span></span>
<span id="cb49-94"><a href="#cb49-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-95"><a href="#cb49-95" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Plot the filtered shapefile boundary</span></span>
<span id="cb49-96"><a href="#cb49-96" aria-hidden="true" tabindex="-1"></a><span class="co">#     shp_filtered.plot(ax=plt.gca(), facecolor='none', edgecolor='none')</span></span>
<span id="cb49-97"><a href="#cb49-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-98"><a href="#cb49-98" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.title(f'Mosquito Egg Distribution (IDW) in Tainan City - {year}')</span></span>
<span id="cb49-99"><a href="#cb49-99" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.xlabel('Longitude')</span></span>
<span id="cb49-100"><a href="#cb49-100" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.ylabel('Latitude')</span></span>
<span id="cb49-101"><a href="#cb49-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-102"><a href="#cb49-102" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Save the plot as a PNG file</span></span>
<span id="cb49-103"><a href="#cb49-103" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.savefig(plot_path, dpi=300)</span></span>
<span id="cb49-104"><a href="#cb49-104" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.close()</span></span>
<span id="cb49-105"><a href="#cb49-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-106"><a href="#cb49-106" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"Outputs saved for year {year} in {save_dir}")</span></span>
<span id="cb49-107"><a href="#cb49-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-108"><a href="#cb49-108" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Processing complete.")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This section performs kriging, comment out to run.</p>
<div id="cell-50" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import os</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># import numpy as np</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># import geopandas as gpd</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># import matplotlib.pyplot as plt</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># from pykrige.ok import OrdinaryKriging</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co"># from rasterio.transform import from_origin</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># from rasterio.mask import mask</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># import rasterio</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # Function to perform Kriging interpolation in chunks</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># def kriging_interpolation(coords, values, grid_x, grid_y, variogram_model="linear"):</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     grid_shape = grid_x.shape</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Set up Kriging</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     krige = OrdinaryKriging(</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="co">#         coords[:, 0], coords[:, 1], values,</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="co">#         variogram_model=variogram_model,</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="co">#         verbose=False, enable_plotting=False</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Perform Kriging</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="co">#     z, ss = krige.execute("grid", grid_x[0], grid_y[:, 0])</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="co">#     return z</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="co"># # Set the year range</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="co"># years = list(range(2015, 2025))</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="co"># # Grid resolution (adjust as needed)</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="co"># grid_resolution = 70</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a><span class="co"># # Iterate over the years</span></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a><span class="co"># for year in years:</span></span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"Processing year {year}...")</span></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Filter events for the specific year</span></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a><span class="co">#     filtered_events = events_gdf[events_gdf['year'] == year]</span></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a><span class="co">#     if filtered_events.empty:</span></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(f"No data available for year {year}. Skipping.")</span></span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a><span class="co">#         continue</span></span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Generate a grid of points within the bounds of the filtered shapefile</span></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a><span class="co">#     minx, miny, maxx, maxy = shp_filtered.total_bounds</span></span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a><span class="co">#     grid_x, grid_y = np.meshgrid(np.linspace(minx, maxx, grid_resolution),</span></span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  np.linspace(miny, maxy, grid_resolution))</span></span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Extract the coordinates and values</span></span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a><span class="co">#     coords = np.array(list(zip(filtered_events['lon'], filtered_events['lat'])))</span></span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a><span class="co">#     values = filtered_events['AvgEggs'].values</span></span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Perform Kriging interpolation</span></span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a><span class="co">#     kriging_values = kriging_interpolation(coords, values, grid_x, grid_y)</span></span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Create a raster for the Kriging surface</span></span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a><span class="co">#     transform = from_origin(minx, maxy, (maxx - minx) / grid_resolution, (maxy - miny) / grid_resolution)</span></span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a><span class="co">#     raster_path = os.path.join(save_dir, f"kriging_{year}.tif")</span></span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a><span class="co">#     with rasterio.open(raster_path, 'w', driver='GTiff', count=1, dtype='float32',</span></span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a><span class="co">#                        crs=shp_filtered.crs.to_string(), transform=transform,</span></span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true" tabindex="-1"></a><span class="co">#                        width=grid_x.shape[1], height=grid_x.shape[0]) as dst:</span></span>
<span id="cb50-61"><a href="#cb50-61" aria-hidden="true" tabindex="-1"></a><span class="co">#         dst.write(kriging_values.astype('float32'), 1)</span></span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Mask the Kriging raster using the shapefile</span></span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true" tabindex="-1"></a><span class="co">#     with rasterio.open(raster_path) as src:</span></span>
<span id="cb50-65"><a href="#cb50-65" aria-hidden="true" tabindex="-1"></a><span class="co">#         out_image, out_transform = mask(src, shp_filtered.geometry, crop=True)</span></span>
<span id="cb50-66"><a href="#cb50-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-67"><a href="#cb50-67" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Save the masked raster</span></span>
<span id="cb50-68"><a href="#cb50-68" aria-hidden="true" tabindex="-1"></a><span class="co">#     masked_raster_path = os.path.join(save_dir, f"kriging_{year}_masked.tif")</span></span>
<span id="cb50-69"><a href="#cb50-69" aria-hidden="true" tabindex="-1"></a><span class="co">#     with rasterio.open(masked_raster_path, 'w', driver='GTiff', count=1, dtype='float32',</span></span>
<span id="cb50-70"><a href="#cb50-70" aria-hidden="true" tabindex="-1"></a><span class="co">#                        crs=shp_filtered.crs.to_string(), transform=out_transform,</span></span>
<span id="cb50-71"><a href="#cb50-71" aria-hidden="true" tabindex="-1"></a><span class="co">#                        width=out_image.shape[2], height=out_image.shape[1]) as dst:</span></span>
<span id="cb50-72"><a href="#cb50-72" aria-hidden="true" tabindex="-1"></a><span class="co">#         dst.write(out_image[0], 1)</span></span>
<span id="cb50-73"><a href="#cb50-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-74"><a href="#cb50-74" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Plot the result</span></span>
<span id="cb50-75"><a href="#cb50-75" aria-hidden="true" tabindex="-1"></a><span class="co">#     plot_path = os.path.join(save_dir, f"kriging_{year}.png")</span></span>
<span id="cb50-76"><a href="#cb50-76" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.figure(figsize=(10, 8))</span></span>
<span id="cb50-77"><a href="#cb50-77" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.imshow(out_image[0], cmap='viridis', extent=[minx, maxx, miny, maxy])</span></span>
<span id="cb50-78"><a href="#cb50-78" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.colorbar(label='Average Eggs Count')</span></span>
<span id="cb50-79"><a href="#cb50-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-80"><a href="#cb50-80" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Plot the filtered shapefile boundary</span></span>
<span id="cb50-81"><a href="#cb50-81" aria-hidden="true" tabindex="-1"></a><span class="co">#     shp_filtered.plot(ax=plt.gca(), facecolor='none', edgecolor='black', linewidth=1)</span></span>
<span id="cb50-82"><a href="#cb50-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-83"><a href="#cb50-83" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.title(f'Mosquito Egg Distribution (Kriging) in Tainan City - {year}')</span></span>
<span id="cb50-84"><a href="#cb50-84" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.xlabel('Longitude')</span></span>
<span id="cb50-85"><a href="#cb50-85" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.ylabel('Latitude')</span></span>
<span id="cb50-86"><a href="#cb50-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-87"><a href="#cb50-87" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Save the plot as a PNG file</span></span>
<span id="cb50-88"><a href="#cb50-88" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.savefig(plot_path, dpi=300)</span></span>
<span id="cb50-89"><a href="#cb50-89" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.close()</span></span>
<span id="cb50-90"><a href="#cb50-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-91"><a href="#cb50-91" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"Outputs saved for year {year} in {save_dir}")</span></span>
<span id="cb50-92"><a href="#cb50-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-93"><a href="#cb50-93" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Processing complete.")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Inpsecting Dengue Fever Infection Data.</p>
<div id="cell-52" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">'''Import CSV Files of Basic Statistics Area and their Population'''</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Directory containing the nested folders</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>BSA_dir <span class="op">=</span> <span class="st">"D:/Projects/TMU/BSA_population_TN"</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Walk through the directory to find all CSV files</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> root, dirs, files <span class="kw">in</span> os.walk(BSA_dir):</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">".csv"</span>):</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extract the first number from the filename</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>            number <span class="op">=</span> <span class="bu">int</span>(<span class="st">''</span>.join(<span class="bu">filter</span>(<span class="bu">str</span>.isdigit, <span class="bu">file</span>.split(<span class="st">"年"</span>)[<span class="dv">0</span>])))  <span class="co"># Get the number before '年'</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>            year <span class="op">=</span> number <span class="op">+</span> <span class="dv">1911</span>  <span class="co"># Add 1911</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Full path to the CSV file</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>            file_path <span class="op">=</span> os.path.join(root, <span class="bu">file</span>)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Attempt to load the CSV file with both encodings</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> encoding <span class="kw">in</span> [<span class="st">"utf-8"</span>, <span class="st">"big5"</span>]:</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>                    df_name <span class="op">=</span> <span class="ss">f"df_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">globals</span>()[df_name] <span class="op">=</span> pd.read_csv(file_path, encoding<span class="op">=</span>encoding)</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Successfully loaded </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss"> as </span><span class="sc">{</span>df_name<span class="sc">}</span><span class="ss"> using </span><span class="sc">{</span>encoding<span class="sc">}</span><span class="ss"> encoding."</span>)</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span>  <span class="co"># Exit the loop if successfully loaded</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Failed to load </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss"> with </span><span class="sc">{</span>encoding<span class="sc">}</span><span class="ss"> encoding. Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Failed to load 104年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 104年12月臺南市統計區人口統計_最小統計區.csv as df_2015 using big5 encoding.
Failed to load 105年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 105年12月臺南市統計區人口統計_最小統計區.csv as df_2016 using big5 encoding.
Successfully loaded 106年12月臺南市統計區人口統計_最小統計區.csv as df_2017 using utf-8 encoding.
Failed to load 107年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 107年12月臺南市統計區人口統計_最小統計區.csv as df_2018 using big5 encoding.
Failed to load 108年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 108年12月臺南市統計區人口統計_最小統計區.csv as df_2019 using big5 encoding.
Failed to load 109年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 109年12月臺南市統計區人口統計_最小統計區.csv as df_2020 using big5 encoding.
Failed to load 110年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 110年12月臺南市統計區人口統計_最小統計區.csv as df_2021 using big5 encoding.
Failed to load 111年6月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 111年6月臺南市統計區人口統計_最小統計區.csv as df_2022 using big5 encoding.
Successfully loaded 112年12月臺南市統計區人口統計_最小統計區.csv as df_2023 using utf-8 encoding.</code></pre>
</div>
</div>
<div id="cell-53" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Dengue Cases by Tainan</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>dengue_local <span class="op">=</span> dengue[dengue[<span class="st">'是否境外移入'</span>]<span class="op">==</span><span class="st">'否'</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>tn_dengue <span class="op">=</span> dengue_local[dengue_local[<span class="st">'居住縣市'</span>]<span class="op">==</span><span class="st">'台南市'</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>urban_tn_dengue <span class="op">=</span> tn_dengue[</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    (tn_dengue[<span class="st">'居住鄉鎮'</span>].isin(allowed_districts)) <span class="op">&amp;</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    (tn_dengue[<span class="st">'Year'</span>] <span class="op">&gt;=</span> <span class="dv">2015</span>) <span class="op">&amp;</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    (tn_dengue[<span class="st">'Year'</span>] <span class="op">&lt;=</span> <span class="dv">2023</span>) ].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(urban_tn_dengue.shape)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(34134, 28)</code></pre>
</div>
</div>
<p>Creating heatmaps of dengue fever infection for the three highest years.</p>
<div id="cell-55" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tallying dengue infections by year and CODEBASE</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>dengue_2015 <span class="op">=</span> urban_tn_dengue[urban_tn_dengue[<span class="st">'Year'</span>] <span class="op">==</span> <span class="dv">2015</span>].groupby(<span class="st">'CODEBASE'</span>).size().reset_index(name<span class="op">=</span><span class="st">'Infections_2015'</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>dengue_2019 <span class="op">=</span> urban_tn_dengue[urban_tn_dengue[<span class="st">'Year'</span>] <span class="op">==</span> <span class="dv">2019</span>].groupby(<span class="st">'CODEBASE'</span>).size().reset_index(name<span class="op">=</span><span class="st">'Infections_2019'</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>dengue_2023 <span class="op">=</span> urban_tn_dengue[urban_tn_dengue[<span class="st">'Year'</span>] <span class="op">==</span> <span class="dv">2023</span>].groupby(<span class="st">'CODEBASE'</span>).size().reset_index(name<span class="op">=</span><span class="st">'Infections_2023'</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Merging population data with infection counts for each year</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>df_2015_pop <span class="op">=</span> df_2015[[<span class="st">'CODEBASE'</span>, <span class="st">'P_CNT'</span>]].rename(columns<span class="op">=</span>{<span class="st">'P_CNT'</span>: <span class="st">'Population_2015'</span>})</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>df_2019_pop <span class="op">=</span> df_2019[[<span class="st">'CODEBASE'</span>, <span class="st">'P_CNT'</span>]].rename(columns<span class="op">=</span>{<span class="st">'P_CNT'</span>: <span class="st">'Population_2019'</span>})</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>df_2023_pop <span class="op">=</span> df_2023[[<span class="st">'CODEBASE'</span>, <span class="st">'P_CNT'</span>]].rename(columns<span class="op">=</span>{<span class="st">'P_CNT'</span>: <span class="st">'Population_2023'</span>})</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Merging infection data with population data for each year</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>df_2015_incidence <span class="op">=</span> pd.merge(dengue_2015, df_2015_pop, on<span class="op">=</span><span class="st">'CODEBASE'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>df_2019_incidence <span class="op">=</span> pd.merge(dengue_2019, df_2019_pop, on<span class="op">=</span><span class="st">'CODEBASE'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>df_2023_incidence <span class="op">=</span> pd.merge(dengue_2023, df_2023_pop, on<span class="op">=</span><span class="st">'CODEBASE'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-56" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure all infection and population columns are numeric</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>df_2015_incidence[<span class="st">'Infections_2015'</span>] <span class="op">=</span> pd.to_numeric(df_2015_incidence[<span class="st">'Infections_2015'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>df_2015_incidence[<span class="st">'Population_2015'</span>] <span class="op">=</span> pd.to_numeric(df_2015_incidence[<span class="st">'Population_2015'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>df_2019_incidence[<span class="st">'Infections_2019'</span>] <span class="op">=</span> pd.to_numeric(df_2019_incidence[<span class="st">'Infections_2019'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>df_2019_incidence[<span class="st">'Population_2019'</span>] <span class="op">=</span> pd.to_numeric(df_2019_incidence[<span class="st">'Population_2019'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>df_2023_incidence[<span class="st">'Infections_2023'</span>] <span class="op">=</span> pd.to_numeric(df_2023_incidence[<span class="st">'Infections_2023'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>df_2023_incidence[<span class="st">'Population_2023'</span>] <span class="op">=</span> pd.to_numeric(df_2023_incidence[<span class="st">'Population_2023'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Now calculate the incidence rates</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>df_2015_incidence[<span class="st">'Incidence_Rate_2015'</span>] <span class="op">=</span> (df_2015_incidence[<span class="st">'Infections_2015'</span>] <span class="op">/</span> df_2015_incidence[<span class="st">'Population_2015'</span>]) <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>df_2019_incidence[<span class="st">'Incidence_Rate_2019'</span>] <span class="op">=</span> (df_2019_incidence[<span class="st">'Infections_2019'</span>] <span class="op">/</span> df_2019_incidence[<span class="st">'Population_2019'</span>]) <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>df_2023_incidence[<span class="st">'Incidence_Rate_2023'</span>] <span class="op">=</span> (df_2023_incidence[<span class="st">'Infections_2023'</span>] <span class="op">/</span> df_2023_incidence[<span class="st">'Population_2023'</span>]) <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>high_incidence_2015 <span class="op">=</span> df_2015_incidence[df_2015_incidence[<span class="st">'Incidence_Rate_2015'</span>] <span class="op">&gt;</span> <span class="dv">1000</span>]</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>high_incidence_2019 <span class="op">=</span> df_2019_incidence[df_2019_incidence[<span class="st">'Incidence_Rate_2019'</span>] <span class="op">&gt;</span> <span class="dv">1000</span>]</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>high_incidence_2023 <span class="op">=</span> df_2023_incidence[df_2023_incidence[<span class="st">'Incidence_Rate_2023'</span>] <span class="op">&gt;</span> <span class="dv">1000</span>]</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a><span class="co"># (Optional) Remove high incidence rows from original dataframes</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>df_2015_incidence <span class="op">=</span> df_2015_incidence[df_2015_incidence[<span class="st">'Incidence_Rate_2015'</span>] <span class="op">&lt;=</span> <span class="dv">1000</span>]</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>df_2019_incidence <span class="op">=</span> df_2019_incidence[df_2019_incidence[<span class="st">'Incidence_Rate_2019'</span>] <span class="op">&lt;=</span> <span class="dv">1000</span>]</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>df_2023_incidence <span class="op">=</span> df_2023_incidence[df_2023_incidence[<span class="st">'Incidence_Rate_2023'</span>] <span class="op">&lt;=</span> <span class="dv">1000</span>]</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Create histograms for incidence rate distribution</span></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram for 2015</span></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>plt.hist(df_2015_incidence[<span class="st">'Incidence_Rate_2015'</span>], bins<span class="op">=</span><span class="dv">20</span>, color<span class="op">=</span><span class="st">'blue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Incidence Rate Distribution - 2015'</span>)</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Incidence Rate'</span>)</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram for 2019</span></span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>plt.hist(df_2019_incidence[<span class="st">'Incidence_Rate_2019'</span>], bins<span class="op">=</span><span class="dv">20</span>, color<span class="op">=</span><span class="st">'green'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Incidence Rate Distribution - 2019'</span>)</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Incidence Rate'</span>)</span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram for 2023</span></span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>plt.hist(df_2023_incidence[<span class="st">'Incidence_Rate_2023'</span>], bins<span class="op">=</span><span class="dv">20</span>, color<span class="op">=</span><span class="st">'red'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Incidence Rate Distribution - 2023'</span>)</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Incidence Rate'</span>)</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plots</span></span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-45-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-57" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define years to plot</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>years_to_plot <span class="op">=</span> [<span class="dv">2015</span>, <span class="dv">2019</span>, <span class="dv">2023</span>]</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colormap limits</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>vmin, vmax <span class="op">=</span> <span class="dv">5</span>, <span class="dv">140</span>  <span class="co"># Focus the color gradient on values </span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Dictionary to store merged data for each year</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>merged_data <span class="op">=</span> {</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2015</span>: pd.merge(shp_filtered, df_2015_incidence[[<span class="st">'CODEBASE'</span>, <span class="st">'Incidence_Rate_2015'</span>]], on<span class="op">=</span><span class="st">'CODEBASE'</span>, how<span class="op">=</span><span class="st">'left'</span>).fillna({<span class="st">'Incidence_Rate_2015'</span>: <span class="dv">0</span>}),</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2019</span>: pd.merge(shp_filtered, df_2019_incidence[[<span class="st">'CODEBASE'</span>, <span class="st">'Incidence_Rate_2019'</span>]], on<span class="op">=</span><span class="st">'CODEBASE'</span>, how<span class="op">=</span><span class="st">'left'</span>).fillna({<span class="st">'Incidence_Rate_2019'</span>: <span class="dv">0</span>}),</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2023</span>: pd.merge(shp_filtered, df_2023_incidence[[<span class="st">'CODEBASE'</span>, <span class="st">'Incidence_Rate_2023'</span>]], on<span class="op">=</span><span class="st">'CODEBASE'</span>, how<span class="op">=</span><span class="st">'left'</span>).fillna({<span class="st">'Incidence_Rate_2023'</span>: <span class="dv">0</span>})</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each year and generate/save the plots</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> years_to_plot:</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    column_name <span class="op">=</span> <span class="ss">f"Incidence_Rate_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    merged_data[year].plot(column<span class="op">=</span>column_name, ax<span class="op">=</span>ax, legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>                           legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: <span class="ss">f"Dengue Incidence Rate (per 1000 people) in </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>},</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>                           cmap<span class="op">=</span><span class="st">'Blues'</span>, vmin<span class="op">=</span>vmin, vmax<span class="op">=</span>vmax,</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>                           missing_kwds<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'gray'</span>})</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"Dengue Incidence Rate in </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="ss">f"</span><span class="sc">{</span>save_dir<span class="sc">}</span><span class="ss">/dengue_incidence_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">.png"</span>)  <span class="co"># Save the figure to save_dir</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>    plt.close()  <span class="co"># Close the figure to free memory</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-58" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>years_to_plot <span class="op">=</span> [<span class="dv">2023</span>]</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to generate weekly aggregated plot for a given year</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_weekly_aggregated_counts(df, year, output_dir):</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    df_year <span class="op">=</span> df[df[<span class="st">'Year'</span>] <span class="op">==</span> year]</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    df_year[<span class="st">'Week'</span>] <span class="op">=</span> df_year[<span class="st">'發病日'</span>].dt.isocalendar().week</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    weekly_counts <span class="op">=</span> df_year.groupby(<span class="st">'Week'</span>).size()</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    plt.plot(weekly_counts.index, weekly_counts.values, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Weekly Dengue Cases - </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Week Number'</span>)</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Number of Cases'</span>)</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>)</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'dengue_weekly_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">.png'</span>)</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>    plt.savefig(output_path)</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output_path</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>plot_weekly_aggregated_counts(urban_tn_dengue, <span class="dv">2015</span>, save_dir)</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>plot_weekly_aggregated_counts(urban_tn_dengue, <span class="dv">2019</span>, save_dir)</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>plot_weekly_aggregated_counts(urban_tn_dengue, <span class="dv">2023</span>, save_dir)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Patrick\AppData\Local\Temp\ipykernel_14536\3320036197.py:6: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_year['Week'] = df_year['發病日'].dt.isocalendar().week
C:\Users\Patrick\AppData\Local\Temp\ipykernel_14536\3320036197.py:6: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_year['Week'] = df_year['發病日'].dt.isocalendar().week
C:\Users\Patrick\AppData\Local\Temp\ipykernel_14536\3320036197.py:6: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_year['Week'] = df_year['發病日'].dt.isocalendar().week</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="135">
<pre><code>'D:/Projects/TMU/Ovitrap_Dengue\\dengue_weekly_2023.png'</code></pre>
</div>
</div>
<p>Focus on 2023 to compare ovitrap data to dengue infection data curves.</p>
<div id="cell-60" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the years to plot</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>years_to_plot <span class="op">=</span> [<span class="dv">2023</span>]</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate weekly aggregated ovitrap data</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>ovitrap_filtered[<span class="st">'Week'</span>] <span class="op">=</span> ovitrap_filtered[<span class="st">'StartTime'</span>].dt.isocalendar().week</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>weekly_aggregated <span class="op">=</span> ovitrap_filtered.groupby([<span class="st">'Year'</span>, <span class="st">'Week'</span>])[<span class="st">'AvgEggs'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to plot both ovitrap egg counts (log scale) and dengue cases (linear scale)</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_combined_weekly_counts(ovitrap_df, dengue_df, year, output_dir):</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data for the specific year</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    ovitrap_yearly <span class="op">=</span> ovitrap_df[ovitrap_df[<span class="st">'Year'</span>] <span class="op">==</span> year]</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    dengue_yearly <span class="op">=</span> dengue_df[dengue_df[<span class="st">'Year'</span>] <span class="op">==</span> year]</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract week numbers</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    dengue_yearly[<span class="st">'Week'</span>] <span class="op">=</span> dengue_yearly[<span class="st">'發病日'</span>].dt.isocalendar().week</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Aggregate weekly data</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>    weekly_dengue_counts <span class="op">=</span> dengue_yearly.groupby(<span class="st">'Week'</span>).size()</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>    weekly_ovitrap_counts <span class="op">=</span> ovitrap_yearly.groupby(<span class="st">'Week'</span>)[<span class="st">'AvgEggs'</span>].<span class="bu">sum</span>()</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create figure and axis</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>    fig, ax1 <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot ovitrap egg counts (log scale)</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>    ax1.plot(weekly_ovitrap_counts.index, weekly_ovitrap_counts.values, marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">"blue"</span>, label<span class="op">=</span><span class="st">"AvgEggs Count (Log)"</span>)</span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>    ax1.set_yscale(<span class="st">"log"</span>)  <span class="co"># Set log scale for egg counts</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">'Week Number'</span>)</span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'AvgEggs Count (Log Scale)'</span>, color<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>    ax1.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>    ax1.grid(<span class="va">True</span>, which<span class="op">=</span><span class="st">"both"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create second y-axis for dengue cases</span></span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>    ax2.plot(weekly_dengue_counts.index, weekly_dengue_counts.values, marker<span class="op">=</span><span class="st">'s'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">"red"</span>, label<span class="op">=</span><span class="st">"Dengue Cases"</span>)</span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Dengue Cases (Linear Scale)'</span>, color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a>    ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Title and legends</span></span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Weekly Dengue Cases &amp; AvgEggs Counts (Log) - </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a>    fig.tight_layout()</span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save the plot</span></span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'Logarithmic curves of ovitrap AvgEggs and Dengue infetions</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">.png'</span>)</span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a>    plt.savefig(output_path)</span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output_path</span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plots for 2015 and 2023</span></span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> years_to_plot:</span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a>    plot_combined_weekly_counts(weekly_aggregated, urban_tn_dengue, year, save_dir)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Patrick\AppData\Local\Temp\ipykernel_14536\4102680299.py:5: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  ovitrap_filtered['Week'] = ovitrap_filtered['StartTime'].dt.isocalendar().week
C:\Users\Patrick\AppData\Local\Temp\ipykernel_14536\4102680299.py:15: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  dengue_yearly['Week'] = dengue_yearly['發病日'].dt.isocalendar().week</code></pre>
</div>
</div>
<div id="cell-61" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the years to plot</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>years_to_plot <span class="op">=</span> [<span class="dv">2023</span>]</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate weekly aggregated ovitrap data</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>ovitrap_filtered[<span class="st">'Week'</span>] <span class="op">=</span> ovitrap_filtered[<span class="st">'StartTime'</span>].dt.isocalendar().week</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>weekly_aggregated <span class="op">=</span> ovitrap_filtered.groupby([<span class="st">'Year'</span>, <span class="st">'Week'</span>])[<span class="st">'AvgEggs'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to plot both ovitrap egg counts (log scale) and dengue cases (linear scale) within the defined time frame</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_filtered_weekly_counts(ovitrap_df, dengue_df, year, output_dir):</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data for the specific year</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    ovitrap_yearly <span class="op">=</span> ovitrap_df[ovitrap_df[<span class="st">'Year'</span>] <span class="op">==</span> year]</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    dengue_yearly <span class="op">=</span> dengue_df[dengue_df[<span class="st">'Year'</span>] <span class="op">==</span> year]</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract week numbers</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    dengue_yearly[<span class="st">'Week'</span>] <span class="op">=</span> dengue_yearly[<span class="st">'發病日'</span>].dt.isocalendar().week</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Aggregate weekly data</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>    weekly_dengue_counts <span class="op">=</span> dengue_yearly.groupby(<span class="st">'Week'</span>).size()</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>    weekly_ovitrap_counts <span class="op">=</span> ovitrap_yearly.groupby(<span class="st">'Week'</span>)[<span class="st">'AvgEggs'</span>].<span class="bu">sum</span>()</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the first week where new dengue cases appear</span></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>    first_case_week <span class="op">=</span> weekly_dengue_counts[weekly_dengue_counts <span class="op">&gt;</span> <span class="dv">0</span>].index.<span class="bu">min</span>()</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the valid range (from first case to week 40)</span></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>    valid_weeks <span class="op">=</span> <span class="bu">range</span>(first_case_week, <span class="dv">41</span>)</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data to include only valid weeks</span></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>    weekly_dengue_counts <span class="op">=</span> weekly_dengue_counts.loc[weekly_dengue_counts.index.isin(valid_weeks)]</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>    weekly_ovitrap_counts <span class="op">=</span> weekly_ovitrap_counts.loc[weekly_ovitrap_counts.index.isin(valid_weeks)]</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create figure and axis</span></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>    fig, ax1 <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot ovitrap egg counts (log scale)</span></span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>    ax1.plot(weekly_ovitrap_counts.index, weekly_ovitrap_counts.values, marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">"blue"</span>, label<span class="op">=</span><span class="st">"AvgEggs Count (Log)"</span>)</span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>    ax1.set_yscale(<span class="st">"log"</span>)  <span class="co"># Set log scale for egg counts</span></span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">'Week Number'</span>)</span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'AvgEggs Count (Log Scale)'</span>, color<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>    ax1.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>    ax1.grid(<span class="va">True</span>, which<span class="op">=</span><span class="st">"both"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create second y-axis for dengue cases</span></span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a>    ax2.plot(weekly_dengue_counts.index, weekly_dengue_counts.values, marker<span class="op">=</span><span class="st">'s'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">"red"</span>, label<span class="op">=</span><span class="st">"Dengue Cases"</span>)</span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Dengue Cases (Linear Scale)'</span>, color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a>    ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Title and legends</span></span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Weekly Dengue Cases &amp; AvgEggs Counts (Log) - </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss"> (Week </span><span class="sc">{</span>first_case_week<span class="sc">}</span><span class="ss"> to 40)'</span>)</span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a>    fig.tight_layout()</span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save the plot</span></span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'early weeks dengue and ovitrap curves </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss"> - Logarithmic.png'</span>)</span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a>    plt.savefig(output_path)</span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb63-56"><a href="#cb63-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-57"><a href="#cb63-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output_path</span>
<span id="cb63-58"><a href="#cb63-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-59"><a href="#cb63-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plots</span></span>
<span id="cb63-60"><a href="#cb63-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> years_to_plot:</span>
<span id="cb63-61"><a href="#cb63-61" aria-hidden="true" tabindex="-1"></a>    plot_filtered_weekly_counts(weekly_aggregated, urban_tn_dengue, year, save_dir)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Patrick\AppData\Local\Temp\ipykernel_14536\3873476054.py:5: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  ovitrap_filtered['Week'] = ovitrap_filtered['StartTime'].dt.isocalendar().week
C:\Users\Patrick\AppData\Local\Temp\ipykernel_14536\3873476054.py:15: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  dengue_yearly['Week'] = dengue_yearly['發病日'].dt.isocalendar().week</code></pre>
</div>
</div>
<div id="cell-62" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the years to plot</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>years_to_plot <span class="op">=</span> [<span class="dv">2023</span>]</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate weekly aggregated ovitrap data</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>ovitrap_filtered[<span class="st">'Week'</span>] <span class="op">=</span> ovitrap_filtered[<span class="st">'StartTime'</span>].dt.isocalendar().week</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>weekly_aggregated <span class="op">=</span> ovitrap_filtered.groupby([<span class="st">'Year'</span>, <span class="st">'Week'</span>])[<span class="st">'AvgEggs'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to plot both ovitrap egg counts and dengue cases (both on linear scale)</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_filtered_weekly_counts_linear(ovitrap_df, dengue_df, year, output_dir):</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data for the specific year</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>    ovitrap_yearly <span class="op">=</span> ovitrap_df[ovitrap_df[<span class="st">'Year'</span>] <span class="op">==</span> year]</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>    dengue_yearly <span class="op">=</span> dengue_df[dengue_df[<span class="st">'Year'</span>] <span class="op">==</span> year]</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract week numbers</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>    dengue_yearly[<span class="st">'Week'</span>] <span class="op">=</span> dengue_yearly[<span class="st">'發病日'</span>].dt.isocalendar().week</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Aggregate weekly data</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>    weekly_dengue_counts <span class="op">=</span> dengue_yearly.groupby(<span class="st">'Week'</span>).size()</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>    weekly_ovitrap_counts <span class="op">=</span> ovitrap_yearly.groupby(<span class="st">'Week'</span>)[<span class="st">'AvgEggs'</span>].<span class="bu">sum</span>()</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the first week where new dengue cases appear</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>    first_case_week <span class="op">=</span> weekly_dengue_counts[weekly_dengue_counts <span class="op">&gt;</span> <span class="dv">0</span>].index.<span class="bu">min</span>()</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the valid range (from first case to week 40)</span></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>    valid_weeks <span class="op">=</span> <span class="bu">range</span>(first_case_week, <span class="dv">41</span>)</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data to include only valid weeks</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>    weekly_dengue_counts <span class="op">=</span> weekly_dengue_counts.loc[weekly_dengue_counts.index.isin(valid_weeks)]</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>    weekly_ovitrap_counts <span class="op">=</span> weekly_ovitrap_counts.loc[weekly_ovitrap_counts.index.isin(valid_weeks)]</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create figure and axis</span></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>    fig, ax1 <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot ovitrap egg counts (linear scale)</span></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>    ax1.plot(weekly_ovitrap_counts.index, weekly_ovitrap_counts.values, marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">"blue"</span>, label<span class="op">=</span><span class="st">"AvgEggs Count"</span>)</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">'Week Number'</span>)</span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'AvgEggs Count (Linear Scale)'</span>, color<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>    ax1.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>    ax1.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create second y-axis for dengue cases</span></span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>    ax2.plot(weekly_dengue_counts.index, weekly_dengue_counts.values, marker<span class="op">=</span><span class="st">'s'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">"red"</span>, label<span class="op">=</span><span class="st">"Dengue Cases"</span>)</span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Dengue Cases (Linear Scale)'</span>, color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>    ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Title and legends</span></span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Weekly Dengue Cases &amp; AvgEggs Counts - </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss"> (Week </span><span class="sc">{</span>first_case_week<span class="sc">}</span><span class="ss"> to 40)'</span>)</span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a>    fig.tight_layout()</span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-51"><a href="#cb65-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save the plot</span></span>
<span id="cb65-52"><a href="#cb65-52" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'early weeks dengue and ovitrap curves </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss"> - Linear.png'</span>)</span>
<span id="cb65-53"><a href="#cb65-53" aria-hidden="true" tabindex="-1"></a>    plt.savefig(output_path)</span>
<span id="cb65-54"><a href="#cb65-54" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb65-55"><a href="#cb65-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-56"><a href="#cb65-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output_path</span>
<span id="cb65-57"><a href="#cb65-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-58"><a href="#cb65-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plots </span></span>
<span id="cb65-59"><a href="#cb65-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> years_to_plot:</span>
<span id="cb65-60"><a href="#cb65-60" aria-hidden="true" tabindex="-1"></a>    plot_filtered_weekly_counts_linear(weekly_aggregated, urban_tn_dengue, year, save_dir)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Patrick\AppData\Local\Temp\ipykernel_14536\1076489049.py:12: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  ovitrap_filtered['week'] = ovitrap_filtered['StartTime'].dt.isocalendar().week
C:\Users\Patrick\AppData\Local\Temp\ipykernel_14536\1076489049.py:22: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  dengue_yearly['Week'] = dengue_yearly['發病日'].dt.isocalendar().week
C:\Users\Patrick\AppData\Local\Temp\ipykernel_14536\1076489049.py:22: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  dengue_yearly['Week'] = dengue_yearly['發病日'].dt.isocalendar().week</code></pre>
</div>
</div>
<div id="cell-63" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure and axis</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot AvgEggs heatmap</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>year_data <span class="op">=</span> full_gdf[full_gdf[<span class="st">'year'</span>] <span class="op">==</span> <span class="dv">2023</span>]</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>year_data.plot(</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">'AvgEggs'</span>, </span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'OrRd'</span>, </span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax, </span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.6</span>,  <span class="co"># Make it semi-transparent</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="va">None</span>, </span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>    missing_kwds<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"lightgray"</span>, <span class="st">"label"</span>: <span class="st">"No data"</span>}</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Overlay Dengue Incidence Rate</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>merged_2023.plot(</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">'Incidence_Rate_2023'</span>, </span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'viridis'</span>, </span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax, </span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.6</span>,  <span class="co"># Transparency for overlay</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="va">None</span>, </span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>    missing_kwds<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'gray'</span>}</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Set title</span></span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Aggregated AvgEggs &amp; Dengue Incidence Rate in 2023"</span>)</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove axis</span></span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Save combined heatmap</span></span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a>save_path <span class="op">=</span> os.path.join(save_dir, <span class="st">"combined_heatmap_2023.png"</span>)</span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a>plt.savefig(save_path, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a>plt.close()</span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Combined heatmap for 2023 saved to </span><span class="sc">{</span>save_path<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Combined heatmap for 2023 saved to D:/Projects/TMU/Ovitrap\combined_heatmap_2023.png</code></pre>
</div>
</div>
<div id="cell-64" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.colors <span class="im">as</span> mcolors</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject data to EPSG:4326</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>full_gdf_4326 <span class="op">=</span> full_gdf.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>merged_2023_4326 <span class="op">=</span> merged_2023.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract relevant year data</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>year_data <span class="op">=</span> full_gdf_4326[full_gdf_4326[<span class="st">'Year'</span>] <span class="op">==</span> <span class="dv">2023</span>]</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop NaN values before processing</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>year_data <span class="op">=</span> year_data.dropna(subset<span class="op">=</span>[<span class="st">"AvgEggs"</span>])</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>merged_2023_4326 <span class="op">=</span> merged_2023_4326.dropna(subset<span class="op">=</span>[<span class="st">"Incidence_Rate_2023"</span>])</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Add small random noise to prevent duplicate bin edges</span></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>year_data[<span class="st">"AvgEggs_adj"</span>] <span class="op">=</span> year_data[<span class="st">"AvgEggs"</span>].fillna(year_data[<span class="st">"AvgEggs"</span>].median()) <span class="op">+</span> np.random.uniform(<span class="dv">0</span>, <span class="fl">0.0001</span>, size<span class="op">=</span><span class="bu">len</span>(year_data))</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>merged_2023_4326[<span class="st">"Incidence_adj"</span>] <span class="op">=</span> merged_2023_4326[<span class="st">"Incidence_Rate_2023"</span>].fillna(merged_2023_4326[<span class="st">"Incidence_Rate_2023"</span>].median()) <span class="op">+</span> np.random.uniform(<span class="dv">0</span>, <span class="fl">0.0001</span>, size<span class="op">=</span><span class="bu">len</span>(merged_2023_4326))</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize data using rank before qcut</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>year_data[<span class="st">"AvgEggs_q"</span>] <span class="op">=</span> pd.qcut(year_data[<span class="st">"AvgEggs_adj"</span>].rank(method<span class="op">=</span><span class="st">'average'</span>), q<span class="op">=</span><span class="dv">3</span>, labels<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>], duplicates<span class="op">=</span><span class="st">"drop"</span>)</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>merged_2023_4326[<span class="st">"Incidence_q"</span>] <span class="op">=</span> pd.qcut(merged_2023_4326[<span class="st">"Incidence_adj"</span>].rank(method<span class="op">=</span><span class="st">'average'</span>), q<span class="op">=</span><span class="dv">3</span>, labels<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>], duplicates<span class="op">=</span><span class="st">"drop"</span>)</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge datasets on the same geographic area</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>merged <span class="op">=</span> year_data.merge(merged_2023_4326, on<span class="op">=</span><span class="st">"geometry"</span>, how<span class="op">=</span><span class="st">"inner"</span>)</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop NaN values post merge</span></span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>merged <span class="op">=</span> merged.dropna(subset<span class="op">=</span>[<span class="st">"AvgEggs_q"</span>, <span class="st">"Incidence_q"</span>])</span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a 3x3 bivariate colormap</span></span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>bivariate_cmap_hex <span class="op">=</span> np.array([</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"#e8e8e8"</span>, <span class="st">"#ace4e4"</span>, <span class="st">"#5ac8c8"</span>],  <span class="co"># Low Dengue</span></span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"#dfb0d6"</span>, <span class="st">"#a5add3"</span>, <span class="st">"#5698b9"</span>],  <span class="co"># Medium Dengue</span></span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"#be64ac"</span>, <span class="st">"#8c62aa"</span>, <span class="st">"#3b4994"</span>]   <span class="co"># High Dengue</span></span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert hex colors to RGB</span></span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>bivariate_cmap <span class="op">=</span> mcolors.to_rgba_array(bivariate_cmap_hex.flatten().tolist())</span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the colormap based on quantile values</span></span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>merged[<span class="st">"color"</span>] <span class="op">=</span> merged.<span class="bu">apply</span>(<span class="kw">lambda</span> row: bivariate_cmap[<span class="bu">int</span>(row[<span class="st">"Incidence_q"</span>]), <span class="bu">int</span>(row[<span class="st">"AvgEggs_q"</span>])], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the map</span></span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot polygons with bivariate colors</span></span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a>merged.plot(color<span class="op">=</span>merged[<span class="st">"color"</span>], ax<span class="op">=</span>ax, edgecolor<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title</span></span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Bivariate Map: AvgEggs &amp; Dengue Incidence Rate (2023)"</span>)</span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-56"><a href="#cb69-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove axis for cleaner visualization</span></span>
<span id="cb69-57"><a href="#cb69-57" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb69-58"><a href="#cb69-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-59"><a href="#cb69-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Create legend</span></span>
<span id="cb69-60"><a href="#cb69-60" aria-hidden="true" tabindex="-1"></a>fig_leg, ax_leg <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb69-61"><a href="#cb69-61" aria-hidden="true" tabindex="-1"></a>ax_leg.set_xticks([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb69-62"><a href="#cb69-62" aria-hidden="true" tabindex="-1"></a>ax_leg.set_yticks([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb69-63"><a href="#cb69-63" aria-hidden="true" tabindex="-1"></a>ax_leg.set_xticklabels([<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>])</span>
<span id="cb69-64"><a href="#cb69-64" aria-hidden="true" tabindex="-1"></a>ax_leg.set_yticklabels([<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>])</span>
<span id="cb69-65"><a href="#cb69-65" aria-hidden="true" tabindex="-1"></a>ax_leg.imshow(bivariate_cmap, aspect<span class="op">=</span><span class="st">"auto"</span>)</span>
<span id="cb69-66"><a href="#cb69-66" aria-hidden="true" tabindex="-1"></a>ax_leg.set_xlabel(<span class="st">"AvgEggs"</span>)</span>
<span id="cb69-67"><a href="#cb69-67" aria-hidden="true" tabindex="-1"></a>ax_leg.set_ylabel(<span class="st">"Dengue Incidence"</span>)</span>
<span id="cb69-68"><a href="#cb69-68" aria-hidden="true" tabindex="-1"></a>ax_leg.set_title(<span class="st">"Bivariate Legend"</span>)</span>
<span id="cb69-69"><a href="#cb69-69" aria-hidden="true" tabindex="-1"></a>plt.savefig(os.path.join(save_dir, <span class="st">"bivariate_legend.png"</span>), dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb69-70"><a href="#cb69-70" aria-hidden="true" tabindex="-1"></a>plt.close()</span>
<span id="cb69-71"><a href="#cb69-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-72"><a href="#cb69-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the figure</span></span>
<span id="cb69-73"><a href="#cb69-73" aria-hidden="true" tabindex="-1"></a>save_path <span class="op">=</span> os.path.join(save_dir, <span class="st">"bivariate_heatmap_2023.png"</span>)</span>
<span id="cb69-74"><a href="#cb69-74" aria-hidden="true" tabindex="-1"></a>plt.savefig(save_path, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb69-75"><a href="#cb69-75" aria-hidden="true" tabindex="-1"></a>plt.close()</span>
<span id="cb69-76"><a href="#cb69-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-77"><a href="#cb69-77" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Bivariate heatmap for 2023 saved to </span><span class="sc">{</span>save_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-78"><a href="#cb69-78" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg ansi-bold">ValueError</span>                                Traceback (most recent call last)
Cell <span class="ansi-green-fg ansi-bold">In[97], line 51</span>
<span class="ansi-green-fg">     48</span> fig, ax <span style="color:rgb(98,98,98)">=</span> plt<span style="color:rgb(98,98,98)">.</span>subplots(figsize<span style="color:rgb(98,98,98)">=</span>(<span style="color:rgb(98,98,98)">10</span>, <span style="color:rgb(98,98,98)">10</span>))
<span class="ansi-green-fg">     50</span> <span style="font-style:italic;color:rgb(95,135,135)"># Plot polygons with bivariate colors</span>
<span class="ansi-green-fg ansi-bold">---&gt; 51</span> merged<span style="color:rgb(98,98,98)">.</span>plot(color<span style="color:rgb(98,98,98)">=</span>merged[<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">color</span><span style="color:rgb(175,0,0)">"</span>], ax<span style="color:rgb(98,98,98)">=</span>ax, edgecolor<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>)
<span class="ansi-green-fg">     53</span> <span style="font-style:italic;color:rgb(95,135,135)"># Add title</span>
<span class="ansi-green-fg">     54</span> ax<span style="color:rgb(98,98,98)">.</span>set_title(<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Bivariate Map: AvgEggs &amp; Dengue Incidence Rate (2023)</span><span style="color:rgb(175,0,0)">"</span>)

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\geopandas\plotting.py:968</span>, in <span class="ansi-cyan-fg">GeoplotAccessor.__call__</span><span class="ansi-blue-fg ansi-bold">(self, *args, **kwargs)</span>
<span class="ansi-green-fg">    966</span> kind <span style="color:rgb(98,98,98)">=</span> kwargs<span style="color:rgb(98,98,98)">.</span>pop(<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">kind</span><span style="color:rgb(175,0,0)">"</span>, <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">geo</span><span style="color:rgb(175,0,0)">"</span>)
<span class="ansi-green-fg">    967</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> kind <span style="color:rgb(98,98,98)">==</span> <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">geo</span><span style="color:rgb(175,0,0)">"</span>:
<span class="ansi-green-fg ansi-bold">--&gt; 968</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> plot_dataframe(data, <span style="color:rgb(98,98,98)">*</span>args, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-fg">    969</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> kind <span style="font-weight:bold;color:rgb(175,0,255)">in</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_pandas_kinds:
<span class="ansi-green-fg">    970</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Access pandas plots</span>
<span class="ansi-green-fg">    971</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> PlotAccessor(data)(kind<span style="color:rgb(98,98,98)">=</span>kind, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwargs)

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\geopandas\plotting.py:690</span>, in <span class="ansi-cyan-fg">plot_dataframe</span><span class="ansi-blue-fg ansi-bold">(df, column, cmap, color, ax, cax, categorical, legend, scheme, k, vmin, vmax, markersize, figsize, legend_kwds, categories, classification_kwds, missing_kwds, aspect, autolim, **style_kwds)</span>
<span class="ansi-green-fg">    687</span>     markersize <span style="color:rgb(98,98,98)">=</span> df[markersize]<span style="color:rgb(98,98,98)">.</span>values
<span class="ansi-green-fg">    689</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> column <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>:
<span class="ansi-green-fg ansi-bold">--&gt; 690</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> plot_series(
<span class="ansi-green-fg">    691</span>         df<span style="color:rgb(98,98,98)">.</span>geometry,
<span class="ansi-green-fg">    692</span>         cmap<span style="color:rgb(98,98,98)">=</span>cmap,
<span class="ansi-green-fg">    693</span>         color<span style="color:rgb(98,98,98)">=</span>color,
<span class="ansi-green-fg">    694</span>         ax<span style="color:rgb(98,98,98)">=</span>ax,
<span class="ansi-green-fg">    695</span>         figsize<span style="color:rgb(98,98,98)">=</span>figsize,
<span class="ansi-green-fg">    696</span>         markersize<span style="color:rgb(98,98,98)">=</span>markersize,
<span class="ansi-green-fg">    697</span>         aspect<span style="color:rgb(98,98,98)">=</span>aspect,
<span class="ansi-green-fg">    698</span>         autolim<span style="color:rgb(98,98,98)">=</span>autolim,
<span class="ansi-green-fg">    699</span>         <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>style_kwds,
<span class="ansi-green-fg">    700</span>     )
<span class="ansi-green-fg">    702</span> <span style="font-style:italic;color:rgb(95,135,135)"># To accept pd.Series and np.arrays as column</span>
<span class="ansi-green-fg">    703</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(column, (np<span style="color:rgb(98,98,98)">.</span>ndarray, pd<span style="color:rgb(98,98,98)">.</span>Series)):

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\geopandas\plotting.py:452</span>, in <span class="ansi-cyan-fg">plot_series</span><span class="ansi-blue-fg ansi-bold">(s, cmap, color, ax, figsize, aspect, autolim, **style_kwds)</span>
<span class="ansi-green-fg">    449</span>         facecolor <span style="color:rgb(98,98,98)">=</span> color_
<span class="ansi-green-fg">    451</span>     values_ <span style="color:rgb(98,98,98)">=</span> values[poly_idx] <span style="font-weight:bold;color:rgb(0,135,0)">if</span> cmap <span style="font-weight:bold;color:rgb(0,135,0)">else</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>
<span class="ansi-green-fg ansi-bold">--&gt; 452</span>     _plot_polygon_collection(
<span class="ansi-green-fg">    453</span>         ax,
<span class="ansi-green-fg">    454</span>         polys,
<span class="ansi-green-fg">    455</span>         values_,
<span class="ansi-green-fg">    456</span>         facecolor<span style="color:rgb(98,98,98)">=</span>facecolor,
<span class="ansi-green-fg">    457</span>         cmap<span style="color:rgb(98,98,98)">=</span>cmap,
<span class="ansi-green-fg">    458</span>         autolim<span style="color:rgb(98,98,98)">=</span>autolim,
<span class="ansi-green-fg">    459</span>         <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>style_kwds,
<span class="ansi-green-fg">    460</span>     )
<span class="ansi-green-fg">    462</span> <span style="font-style:italic;color:rgb(95,135,135)"># plot all LineStrings and MultiLineString components in same collection</span>
<span class="ansi-green-fg">    463</span> lines <span style="color:rgb(98,98,98)">=</span> expl_series[line_idx]

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\geopandas\plotting.py:172</span>, in <span class="ansi-cyan-fg">_plot_polygon_collection</span><span class="ansi-blue-fg ansi-bold">(ax, geoms, values, color, cmap, vmin, vmax, autolim, **kwargs)</span>
<span class="ansi-green-fg">    168</span>     kwargs[<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">color</span><span style="color:rgb(175,0,0)">"</span>] <span style="color:rgb(98,98,98)">=</span> color
<span class="ansi-green-fg">    170</span> _expand_kwargs(kwargs, multiindex)
<span class="ansi-green-fg ansi-bold">--&gt; 172</span> collection <span style="color:rgb(98,98,98)">=</span> PatchCollection([_PolygonPatch(poly) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> poly <span style="font-weight:bold;color:rgb(175,0,255)">in</span> geoms], <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-fg">    174</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> values <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>:
<span class="ansi-green-fg">    175</span>     collection<span style="color:rgb(98,98,98)">.</span>set_array(np<span style="color:rgb(98,98,98)">.</span>asarray(values))

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\matplotlib\_api\deprecation.py:454</span>, in <span class="ansi-cyan-fg">make_keyword_only.&lt;locals&gt;.wrapper</span><span class="ansi-blue-fg ansi-bold">(*args, **kwargs)</span>
<span class="ansi-green-fg">    448</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">len</span>(args) <span style="color:rgb(98,98,98)">&gt;</span> name_idx:
<span class="ansi-green-fg">    449</span>     warn_deprecated(
<span class="ansi-green-fg">    450</span>         since, message<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Passing the </span><span style="font-weight:bold;color:rgb(175,95,135)">%(name)s</span><span style="color:rgb(175,0,0)"> </span><span style="font-weight:bold;color:rgb(175,95,135)">%(obj_type)s</span><span style="color:rgb(175,0,0)"> </span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg">    451</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">positionally is deprecated since Matplotlib </span><span style="font-weight:bold;color:rgb(175,95,135)">%(since)s</span><span style="color:rgb(175,0,0)">; the </span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg">    452</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">parameter will become keyword-only </span><span style="font-weight:bold;color:rgb(175,95,135)">%(removal)s</span><span style="color:rgb(175,0,0)">.</span><span style="color:rgb(175,0,0)">"</span>,
<span class="ansi-green-fg">    453</span>         name<span style="color:rgb(98,98,98)">=</span>name, obj_type<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">parameter of </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>func<span style="color:rgb(98,98,98)">.</span><span style="color:rgb(0,0,135)">__name__</span><span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">()</span><span style="color:rgb(175,0,0)">"</span>)
<span class="ansi-green-fg ansi-bold">--&gt; 454</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> func(<span style="color:rgb(98,98,98)">*</span>args, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwargs)

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\matplotlib\collections.py:1819</span>, in <span class="ansi-cyan-fg">PatchCollection.__init__</span><span class="ansi-blue-fg ansi-bold">(self, patches, match_original, **kwargs)</span>
<span class="ansi-green-fg">   1816</span>     kwargs[<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">linestyles</span><span style="color:rgb(175,0,0)">'</span>] <span style="color:rgb(98,98,98)">=</span> [p<span style="color:rgb(98,98,98)">.</span>get_linestyle() <span style="font-weight:bold;color:rgb(0,135,0)">for</span> p <span style="font-weight:bold;color:rgb(175,0,255)">in</span> patches]
<span class="ansi-green-fg">   1817</span>     kwargs[<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">antialiaseds</span><span style="color:rgb(175,0,0)">'</span>] <span style="color:rgb(98,98,98)">=</span> [p<span style="color:rgb(98,98,98)">.</span>get_antialiased() <span style="font-weight:bold;color:rgb(0,135,0)">for</span> p <span style="font-weight:bold;color:rgb(175,0,255)">in</span> patches]
<span class="ansi-green-fg ansi-bold">-&gt; 1819</span> <span style="color:rgb(0,135,0)">super</span>()<span style="color:rgb(98,98,98)">.</span><span style="color:rgb(0,0,255)">__init__</span>(<span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-fg">   1821</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>set_paths(patches)

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\matplotlib\_api\deprecation.py:454</span>, in <span class="ansi-cyan-fg">make_keyword_only.&lt;locals&gt;.wrapper</span><span class="ansi-blue-fg ansi-bold">(*args, **kwargs)</span>
<span class="ansi-green-fg">    448</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">len</span>(args) <span style="color:rgb(98,98,98)">&gt;</span> name_idx:
<span class="ansi-green-fg">    449</span>     warn_deprecated(
<span class="ansi-green-fg">    450</span>         since, message<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Passing the </span><span style="font-weight:bold;color:rgb(175,95,135)">%(name)s</span><span style="color:rgb(175,0,0)"> </span><span style="font-weight:bold;color:rgb(175,95,135)">%(obj_type)s</span><span style="color:rgb(175,0,0)"> </span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg">    451</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">positionally is deprecated since Matplotlib </span><span style="font-weight:bold;color:rgb(175,95,135)">%(since)s</span><span style="color:rgb(175,0,0)">; the </span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg">    452</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">parameter will become keyword-only </span><span style="font-weight:bold;color:rgb(175,95,135)">%(removal)s</span><span style="color:rgb(175,0,0)">.</span><span style="color:rgb(175,0,0)">"</span>,
<span class="ansi-green-fg">    453</span>         name<span style="color:rgb(98,98,98)">=</span>name, obj_type<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">parameter of </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>func<span style="color:rgb(98,98,98)">.</span><span style="color:rgb(0,0,135)">__name__</span><span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">()</span><span style="color:rgb(175,0,0)">"</span>)
<span class="ansi-green-fg ansi-bold">--&gt; 454</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> func(<span style="color:rgb(98,98,98)">*</span>args, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwargs)

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\matplotlib\collections.py:201</span>, in <span class="ansi-cyan-fg">Collection.__init__</span><span class="ansi-blue-fg ansi-bold">(self, edgecolors, facecolors, linewidths, linestyles, capstyle, joinstyle, antialiaseds, offsets, offset_transform, norm, cmap, pickradius, hatch, urls, zorder, **kwargs)</span>
<span class="ansi-green-fg">    198</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_offset_transform <span style="color:rgb(98,98,98)">=</span> offset_transform
<span class="ansi-green-fg">    200</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_path_effects <span style="color:rgb(98,98,98)">=</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>
<span class="ansi-green-fg ansi-bold">--&gt; 201</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_internal_update(kwargs)
<span class="ansi-green-fg">    202</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_paths <span style="color:rgb(98,98,98)">=</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\matplotlib\artist.py:1223</span>, in <span class="ansi-cyan-fg">Artist._internal_update</span><span class="ansi-blue-fg ansi-bold">(self, kwargs)</span>
<span class="ansi-green-fg">   1216</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">_internal_update</span>(<span style="color:rgb(0,135,0)">self</span>, kwargs):
<span class="ansi-green-fg">   1217</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic;color:rgb(175,0,0)">"""</span>
<span class="ansi-green-fg">   1218</span> <span style="font-style:italic;color:rgb(175,0,0)">    Update artist properties without prenormalizing them, but generating</span>
<span class="ansi-green-fg">   1219</span> <span style="font-style:italic;color:rgb(175,0,0)">    errors as if calling `set`.</span>
<span class="ansi-green-fg">   1220</span> 
<span class="ansi-green-fg">   1221</span> <span style="font-style:italic;color:rgb(175,0,0)">    The lack of prenormalization is to maintain backcompatibility.</span>
<span class="ansi-green-fg">   1222</span> <span style="font-style:italic;color:rgb(175,0,0)">    """</span>
<span class="ansi-green-fg ansi-bold">-&gt; 1223</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_update_props(
<span class="ansi-green-fg">   1224</span>         kwargs, <span style="color:rgb(175,0,0)">"</span><span style="font-weight:bold;color:rgb(175,95,135)">{cls.__name__}</span><span style="color:rgb(175,0,0)">.set() got an unexpected keyword argument </span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg">   1225</span>         <span style="color:rgb(175,0,0)">"</span><span style="font-weight:bold;color:rgb(175,95,135)">{prop_name!r}</span><span style="color:rgb(175,0,0)">"</span>)

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\matplotlib\artist.py:1199</span>, in <span class="ansi-cyan-fg">Artist._update_props</span><span class="ansi-blue-fg ansi-bold">(self, props, errfmt)</span>
<span class="ansi-green-fg">   1196</span>             <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="color:rgb(0,135,0)">callable</span>(func):
<span class="ansi-green-fg">   1197</span>                 <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">AttributeError</span>(
<span class="ansi-green-fg">   1198</span>                     errfmt<span style="color:rgb(98,98,98)">.</span>format(<span style="color:rgb(0,135,0)">cls</span><span style="color:rgb(98,98,98)">=</span><span style="color:rgb(0,135,0)">type</span>(<span style="color:rgb(0,135,0)">self</span>), prop_name<span style="color:rgb(98,98,98)">=</span>k))
<span class="ansi-green-fg ansi-bold">-&gt; 1199</span>             ret<span style="color:rgb(98,98,98)">.</span>append(func(v))
<span class="ansi-green-fg">   1200</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> ret:
<span class="ansi-green-fg">   1201</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>pchanged()

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\matplotlib\collections.py:751</span>, in <span class="ansi-cyan-fg">Collection.set_facecolor</span><span class="ansi-blue-fg ansi-bold">(self, c)</span>
<span class="ansi-green-fg">    749</span>     c <span style="color:rgb(98,98,98)">=</span> c<span style="color:rgb(98,98,98)">.</span>lower()
<span class="ansi-green-fg">    750</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_original_facecolor <span style="color:rgb(98,98,98)">=</span> c
<span class="ansi-green-fg ansi-bold">--&gt; 751</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_set_facecolor(c)

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\matplotlib\collections.py:733</span>, in <span class="ansi-cyan-fg">Collection._set_facecolor</span><span class="ansi-blue-fg ansi-bold">(self, c)</span>
<span class="ansi-green-fg">    730</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> c <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>:
<span class="ansi-green-fg">    731</span>     c <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_get_default_facecolor()
<span class="ansi-green-fg ansi-bold">--&gt; 733</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_facecolors <span style="color:rgb(98,98,98)">=</span> mcolors<span style="color:rgb(98,98,98)">.</span>to_rgba_array(c, <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_alpha)
<span class="ansi-green-fg">    734</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>stale <span style="color:rgb(98,98,98)">=</span> <span style="font-weight:bold;color:rgb(0,135,0)">True</span>

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\matplotlib\colors.py:487</span>, in <span class="ansi-cyan-fg">to_rgba_array</span><span class="ansi-blue-fg ansi-bold">(c, alpha)</span>
<span class="ansi-green-fg">    485</span>         rgba <span style="color:rgb(98,98,98)">=</span> np<span style="color:rgb(98,98,98)">.</span>array([to_rgba(cc) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> cc <span style="font-weight:bold;color:rgb(175,0,255)">in</span> c])
<span class="ansi-green-fg">    486</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg ansi-bold">--&gt; 487</span>     rgba <span style="color:rgb(98,98,98)">=</span> np<span style="color:rgb(98,98,98)">.</span>array([to_rgba(cc) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> cc <span style="font-weight:bold;color:rgb(175,0,255)">in</span> c])
<span class="ansi-green-fg">    489</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> alpha <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>:
<span class="ansi-green-fg">    490</span>     rgba[:, <span style="color:rgb(98,98,98)">3</span>] <span style="color:rgb(98,98,98)">=</span> alpha

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\matplotlib\colors.py:487</span>, in <span class="ansi-cyan-fg">&lt;listcomp&gt;</span><span class="ansi-blue-fg ansi-bold">(.0)</span>
<span class="ansi-green-fg">    485</span>         rgba <span style="color:rgb(98,98,98)">=</span> np<span style="color:rgb(98,98,98)">.</span>array([to_rgba(cc) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> cc <span style="font-weight:bold;color:rgb(175,0,255)">in</span> c])
<span class="ansi-green-fg">    486</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg ansi-bold">--&gt; 487</span>     rgba <span style="color:rgb(98,98,98)">=</span> np<span style="color:rgb(98,98,98)">.</span>array([to_rgba(cc) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> cc <span style="font-weight:bold;color:rgb(175,0,255)">in</span> c])
<span class="ansi-green-fg">    489</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> alpha <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>:
<span class="ansi-green-fg">    490</span>     rgba[:, <span style="color:rgb(98,98,98)">3</span>] <span style="color:rgb(98,98,98)">=</span> alpha

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\matplotlib\colors.py:299</span>, in <span class="ansi-cyan-fg">to_rgba</span><span class="ansi-blue-fg ansi-bold">(c, alpha)</span>
<span class="ansi-green-fg">    297</span>     rgba <span style="color:rgb(98,98,98)">=</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>
<span class="ansi-green-fg">    298</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> rgba <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>:  <span style="font-style:italic;color:rgb(95,135,135)"># Suppress exception chaining of cache lookup failure.</span>
<span class="ansi-green-fg ansi-bold">--&gt; 299</span>     rgba <span style="color:rgb(98,98,98)">=</span> _to_rgba_no_colorcycle(c, alpha)
<span class="ansi-green-fg">    300</span>     <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">    301</span>         _colors_full_map<span style="color:rgb(98,98,98)">.</span>cache[c, alpha] <span style="color:rgb(98,98,98)">=</span> rgba

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\matplotlib\colors.py:381</span>, in <span class="ansi-cyan-fg">_to_rgba_no_colorcycle</span><span class="ansi-blue-fg ansi-bold">(c, alpha)</span>
<span class="ansi-green-fg">    379</span> <span style="font-style:italic;color:rgb(95,135,135)"># tuple color.</span>
<span class="ansi-green-fg">    380</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> np<span style="color:rgb(98,98,98)">.</span>iterable(c):
<span class="ansi-green-fg ansi-bold">--&gt; 381</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>(<span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Invalid RGBA argument: </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>orig_c<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span style="color:rgb(175,0,0)">"</span>)
<span class="ansi-green-fg">    382</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">len</span>(c) <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="font-weight:bold;color:rgb(175,0,255)">in</span> [<span style="color:rgb(98,98,98)">3</span>, <span style="color:rgb(98,98,98)">4</span>]:
<span class="ansi-green-fg">    383</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>(<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">RGBA sequence should have length 3 or 4</span><span style="color:rgb(175,0,0)">"</span>)

<span class="ansi-red-fg ansi-bold">ValueError</span>: Invalid RGBA argument: 0.9098039215686274</pre>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TN_Script_files/figure-html/cell-52-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-66" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.colors <span class="im">as</span> mcolors</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Rank BSAs based on the change in dengue infections (2023)</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>dengue_comparison[<span class="st">'dengue_rank'</span>] <span class="op">=</span> dengue_comparison[<span class="st">'change'</span>].rank(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Rank BSAs based on Ovitrap Egg count (2023)</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have a DataFrame called `ovitrap_data` with a 'CODEBASE' column and 'Ovitrap_2023' column</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to merge this Ovitrap Egg count data with the dengue comparison data</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>map_data <span class="op">=</span> map_data.merge(ovitrap_filtered[[<span class="st">'CODEBASE'</span>, <span class="st">'Ovitrap_2023'</span>]], on<span class="op">=</span><span class="st">'CODEBASE'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Rank BSAs based on Ovitrap Egg count (2023)</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>map_data[<span class="st">'ovitrap_rank'</span>] <span class="op">=</span> map_data[<span class="st">'Ovitrap_2023'</span>].rank(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Compare rankings and assign colors</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> assign_color(row):</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="st">'dengue_rank'</span>] <span class="op">&lt;</span> row[<span class="st">'ovitrap_rank'</span>]:  <span class="co"># dengue rank is better (lower)</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'blue'</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'red'</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>map_data[<span class="st">'color'</span>] <span class="op">=</span> map_data.<span class="bu">apply</span>(assign_color, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Create a map with the appropriate colors</span></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>map_data.plot(ax<span class="op">=</span>ax, color<span class="op">=</span>map_data[<span class="st">'color'</span>], legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title and display</span></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Dengue vs Ovitrap Egg Count Rank Comparison (2023)'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="ss">f"</span><span class="sc">{</span>output_directory<span class="sc">}</span><span class="ss">/Dengue_vs_Ovitrap_Rank_Comparison_2023.png"</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>plt.close()</span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the weekly aggregated counts for 2023 (already included in your original code)</span></span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a>plot_weekly_aggregated_counts(filtered_tn_dengue, <span class="dv">2023</span>, output_directory)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg ansi-bold">KeyError</span>                                  Traceback (most recent call last)
Cell <span class="ansi-green-fg ansi-bold">In[172], line 12</span>
<span class="ansi-green-fg">      7</span> dengue_comparison[<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">dengue_rank</span><span style="color:rgb(175,0,0)">'</span>] <span style="color:rgb(98,98,98)">=</span> dengue_comparison[<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">change</span><span style="color:rgb(175,0,0)">'</span>]<span style="color:rgb(98,98,98)">.</span>rank(ascending<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">False</span>)
<span class="ansi-green-fg">      9</span> <span style="font-style:italic;color:rgb(95,135,135)"># Step 2: Rank BSAs based on Ovitrap Egg count (2023)</span>
<span class="ansi-green-fg">     10</span> <span style="font-style:italic;color:rgb(95,135,135)"># Assuming you have a DataFrame called `ovitrap_data` with a 'CODEBASE' column and 'Ovitrap_2023' column</span>
<span class="ansi-green-fg">     11</span> <span style="font-style:italic;color:rgb(95,135,135)"># We need to merge this Ovitrap Egg count data with the dengue comparison data</span>
<span class="ansi-green-fg ansi-bold">---&gt; 12</span> map_data <span style="color:rgb(98,98,98)">=</span> map_data<span style="color:rgb(98,98,98)">.</span>merge(ovitrap_filtered[[<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">CODEBASE</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">Ovitrap_2023</span><span style="color:rgb(175,0,0)">'</span>]], on<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">CODEBASE</span><span style="color:rgb(175,0,0)">'</span>, how<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">left</span><span style="color:rgb(175,0,0)">'</span>)
<span class="ansi-green-fg">     14</span> <span style="font-style:italic;color:rgb(95,135,135)"># Rank BSAs based on Ovitrap Egg count (2023)</span>
<span class="ansi-green-fg">     15</span> map_data[<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">ovitrap_rank</span><span style="color:rgb(175,0,0)">'</span>] <span style="color:rgb(98,98,98)">=</span> map_data[<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">Ovitrap_2023</span><span style="color:rgb(175,0,0)">'</span>]<span style="color:rgb(98,98,98)">.</span>rank(ascending<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">False</span>)

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\pandas\core\frame.py:3813</span>, in <span class="ansi-cyan-fg">DataFrame.__getitem__</span><span class="ansi-blue-fg ansi-bold">(self, key)</span>
<span class="ansi-green-fg">   3811</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> is_iterator(key):
<span class="ansi-green-fg">   3812</span>         key <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">list</span>(key)
<span class="ansi-green-fg ansi-bold">-&gt; 3813</span>     indexer <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>columns<span style="color:rgb(98,98,98)">.</span>_get_indexer_strict(key, <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">columns</span><span style="color:rgb(175,0,0)">"</span>)[<span style="color:rgb(98,98,98)">1</span>]
<span class="ansi-green-fg">   3815</span> <span style="font-style:italic;color:rgb(95,135,135)"># take() does not accept boolean indexers</span>
<span class="ansi-green-fg">   3816</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">getattr</span>(indexer, <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">dtype</span><span style="color:rgb(175,0,0)">"</span>, <span style="font-weight:bold;color:rgb(0,135,0)">None</span>) <span style="color:rgb(98,98,98)">==</span> <span style="color:rgb(0,135,0)">bool</span>:

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\pandas\core\indexes\base.py:6070</span>, in <span class="ansi-cyan-fg">Index._get_indexer_strict</span><span class="ansi-blue-fg ansi-bold">(self, key, axis_name)</span>
<span class="ansi-green-fg">   6067</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">   6068</span>     keyarr, indexer, new_indexer <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_reindex_non_unique(keyarr)
<span class="ansi-green-fg ansi-bold">-&gt; 6070</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_raise_if_missing(keyarr, indexer, axis_name)
<span class="ansi-green-fg">   6072</span> keyarr <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>take(indexer)
<span class="ansi-green-fg">   6073</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(key, Index):
<span class="ansi-green-fg">   6074</span>     <span style="font-style:italic;color:rgb(95,135,135)"># GH 42790 - Preserve name from an Index</span>

File <span class="ansi-green-fg ansi-bold">c:\Users\Patrick\anaconda3\Lib\site-packages\pandas\core\indexes\base.py:6130</span>, in <span class="ansi-cyan-fg">Index._raise_if_missing</span><span class="ansi-blue-fg ansi-bold">(self, key, indexer, axis_name)</span>
<span class="ansi-green-fg">   6128</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> use_interval_msg:
<span class="ansi-green-fg">   6129</span>         key <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">list</span>(key)
<span class="ansi-green-fg ansi-bold">-&gt; 6130</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(<span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">None of [</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>key<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">] are in the [</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>axis_name<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">]</span><span style="color:rgb(175,0,0)">"</span>)
<span class="ansi-green-fg">   6132</span> not_found <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">list</span>(ensure_index(key)[missing_mask<span style="color:rgb(98,98,98)">.</span>nonzero()[<span style="color:rgb(98,98,98)">0</span>]]<span style="color:rgb(98,98,98)">.</span>unique())
<span class="ansi-green-fg">   6133</span> <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(<span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>not_found<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)"> not in index</span><span style="color:rgb(175,0,0)">"</span>)

<span class="ansi-red-fg ansi-bold">KeyError</span>: "None of [Index(['CODEBASE', 'Ovitrap_2023'], dtype='object')] are in the [columns]"</pre>
</div>
</div>
</div>
<div id="cell-67" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ovitrap_filtered.columns)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['SerialNo', 'X', 'Y', 'InvestigateUnit', 'City', 'District', 'Village',
       'Address', 'Outdoor', 'AddressComment', 'TotalEggs', 'LatestTotalEggs',
       'AvgEggs', 'TotalBuckets', 'StartTime', 'EndTime', 'Year', 'Week',
       'lon', 'lat'],
      dtype='object')</code></pre>
</div>
</div>
<div id="cell-68" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>ovitrap_filtered</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="174">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SerialNo</th>
<th data-quarto-table-cell-role="th">X</th>
<th data-quarto-table-cell-role="th">Y</th>
<th data-quarto-table-cell-role="th">InvestigateUnit</th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">District</th>
<th data-quarto-table-cell-role="th">Village</th>
<th data-quarto-table-cell-role="th">Address</th>
<th data-quarto-table-cell-role="th">Outdoor</th>
<th data-quarto-table-cell-role="th">AddressComment</th>
<th data-quarto-table-cell-role="th">TotalEggs</th>
<th data-quarto-table-cell-role="th">LatestTotalEggs</th>
<th data-quarto-table-cell-role="th">AvgEggs</th>
<th data-quarto-table-cell-role="th">TotalBuckets</th>
<th data-quarto-table-cell-role="th">StartTime</th>
<th data-quarto-table-cell-role="th">EndTime</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Week</th>
<th data-quarto-table-cell-role="th">lon</th>
<th data-quarto-table-cell-role="th">lat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>20160725901</td>
<td>168197.000000</td>
<td>2.544049e+06</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>中西區</td>
<td>天后里</td>
<td>永福路二段203號</td>
<td>True</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>2</td>
<td>2016-08-01</td>
<td>2016/08/07</td>
<td>2016</td>
<td>31</td>
<td>120.202060</td>
<td>22.995876</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>20160725902</td>
<td>168198.000000</td>
<td>2.544083e+06</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>中西區</td>
<td>天后里</td>
<td>武廟右前方柱子下</td>
<td>True</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>2</td>
<td>2016-08-01</td>
<td>2016/08/07</td>
<td>2016</td>
<td>31</td>
<td>120.202068</td>
<td>22.996183</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>20160725903</td>
<td>168082.000000</td>
<td>2.544099e+06</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>中西區</td>
<td>天后里</td>
<td>永福路二段197巷15號</td>
<td>True</td>
<td>NaN</td>
<td>60</td>
<td>46</td>
<td>30.0</td>
<td>2</td>
<td>2016-08-01</td>
<td>2016/08/07</td>
<td>2016</td>
<td>31</td>
<td>120.200936</td>
<td>22.996322</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>20160725904</td>
<td>167967.000000</td>
<td>2.544085e+06</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>中西區</td>
<td>天后里</td>
<td>西門路二段272號（水果行）</td>
<td>True</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>2</td>
<td>2016-08-01</td>
<td>2016/08/07</td>
<td>2016</td>
<td>31</td>
<td>120.199815</td>
<td>22.996190</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>20160725905</td>
<td>168017.000000</td>
<td>2.544113e+06</td>
<td>國衛院蚊媒中心_台南</td>
<td>台南市</td>
<td>中西區</td>
<td>天后里</td>
<td>西門路二段300巷21號</td>
<td>True</td>
<td>NaN</td>
<td>9</td>
<td>0</td>
<td>4.5</td>
<td>2</td>
<td>2016-08-01</td>
<td>2016/08/07</td>
<td>2016</td>
<td>31</td>
<td>120.200301</td>
<td>22.996445</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">218531</th>
<td>1701TWMZ902</td>
<td>120.194053</td>
<td>2.299339e+01</td>
<td>台南市衛生局</td>
<td>台南市</td>
<td>中西區</td>
<td>民主里</td>
<td>中正路347號</td>
<td>True</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>2</td>
<td>2018-12-17</td>
<td>2018/12/23</td>
<td>2018</td>
<td>51</td>
<td>120.194053</td>
<td>22.993390</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">220672</th>
<td>1647TWXH901</td>
<td>120.193792</td>
<td>2.300121e+01</td>
<td>台南市衛生局</td>
<td>台南市</td>
<td>中西區</td>
<td>協和里</td>
<td>臨安路一段212巷12號</td>
<td>True</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>2</td>
<td>2018-12-24</td>
<td>2018/12/30</td>
<td>2018</td>
<td>52</td>
<td>120.193792</td>
<td>23.001207</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">222109</th>
<td>1701TWMZ902</td>
<td>120.194053</td>
<td>2.299339e+01</td>
<td>台南市衛生局</td>
<td>台南市</td>
<td>中西區</td>
<td>民主里</td>
<td>中正路347號</td>
<td>True</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>2</td>
<td>2018-12-24</td>
<td>2018/12/30</td>
<td>2018</td>
<td>52</td>
<td>120.194053</td>
<td>22.993390</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">226544</th>
<td>1647TWXH901</td>
<td>120.193792</td>
<td>2.300121e+01</td>
<td>台南市衛生局</td>
<td>台南市</td>
<td>中西區</td>
<td>協和里</td>
<td>臨安路一段212巷12號</td>
<td>True</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>1</td>
<td>2018-12-31</td>
<td>2019/01/06</td>
<td>2018</td>
<td>1</td>
<td>120.193792</td>
<td>23.001207</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">227068</th>
<td>1701TWMZ902</td>
<td>120.194053</td>
<td>2.299339e+01</td>
<td>台南市衛生局</td>
<td>台南市</td>
<td>中西區</td>
<td>民主里</td>
<td>中正路347號</td>
<td>True</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>1</td>
<td>2018-12-31</td>
<td>2019/01/06</td>
<td>2018</td>
<td>1</td>
<td>120.194053</td>
<td>22.993390</td>
</tr>
</tbody>
</table>

<p>982533 rows × 20 columns</p>
</div>
</div>
</div>
<div id="cell-70" class="cell" data-execution_count="43">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the output folder and file name</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="vs">r"D:</span><span class="er">\</span><span class="vs">Projects</span><span class="er">\</span><span class="vs">TMU</span><span class="er">\</span><span class="vs">gee_dengue</span><span class="dv">\d</span><span class="vs">ata</span><span class="er">\</span><span class="vs">external</span><span class="er">\</span><span class="vs">geojson"</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>output_file <span class="op">=</span> os.path.join(output_folder, <span class="st">"vil_gjs.geojson"</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the folder if it does not exist</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>os.makedirs(output_folder, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the GeoDataFrame</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>vil_gjs.to_file(output_file, driver<span class="op">=</span><span class="st">"GeoJSON"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-71" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of features: </span><span class="sc">{</span><span class="bu">len</span>(tn_shp)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Estimated memory usage: </span><span class="sc">{</span>tn_shp<span class="sc">.</span>memory_usage(deep<span class="op">=</span><span class="va">True</span>)<span class="sc">.</span><span class="bu">sum</span>() <span class="op">/</span> (<span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span>)<span class="sc">:.2f}</span><span class="ss"> MB"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of features: 12774
Estimated memory usage: 6.66 MB</code></pre>
</div>
</div>
<div id="cell-72" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>tn_shp[<span class="st">"geometry"</span>] <span class="op">=</span> tn_shp[<span class="st">"geometry"</span>].simplify(tolerance<span class="op">=</span><span class="fl">1.0</span>, preserve_topology<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-73" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gc</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> tn_shp  <span class="co"># Delete old variable</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>gc.collect()  <span class="co"># Force garbage collection</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>tn_shp <span class="op">=</span> gpd.read_file(<span class="st">"simplified.shp"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-74" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>tn_shp<span class="op">=</span>tn_shp.copy()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-75" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Estimated memory usage: </span><span class="sc">{</span>sys<span class="sc">.</span>getsizeof(tn_shp) <span class="op">/</span> (<span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span>)<span class="sc">:.2f}</span><span class="ss"> MB"</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimated memory usage: 6.66 MB</code></pre>
</div>
</div>
<div id="cell-77" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>new_epsg <span class="op">=</span> <span class="st">"EPSG:4326"</span>  <span class="co"># Change to your target EPSG</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>tn_shp_4326 <span class="op">=</span> tn_shp.to_crs(new_epsg)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>tn_shp_4326.to_file(<span class="st">"tn_shp_4326.shp"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-78" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">'''Import CSV Files of Basic Statistics Area and their Population'''</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Directory containing the nested folders</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>base_dir <span class="op">=</span> <span class="st">"D:</span><span class="er">\</span><span class="st">Projects</span><span class="er">\</span><span class="st">TMU</span><span class="er">\</span><span class="st">gee_dengue</span><span class="er">\</span><span class="st">Dengue_TW</span><span class="er">\</span><span class="st">BSA_population_TN"</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Walk through the directory to find all CSV files</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> root, dirs, files <span class="kw">in</span> os.walk(base_dir):</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">".csv"</span>):</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extract the first number from the filename</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>            number <span class="op">=</span> <span class="bu">int</span>(<span class="st">''</span>.join(<span class="bu">filter</span>(<span class="bu">str</span>.isdigit, <span class="bu">file</span>.split(<span class="st">"年"</span>)[<span class="dv">0</span>])))  <span class="co"># Get the number before '年'</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>            year <span class="op">=</span> number <span class="op">+</span> <span class="dv">1911</span>  <span class="co"># Add 1911</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Full path to the CSV file</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>            file_path <span class="op">=</span> os.path.join(root, <span class="bu">file</span>)</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Attempt to load the CSV file with both encodings</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> encoding <span class="kw">in</span> [<span class="st">"utf-8"</span>, <span class="st">"big5"</span>]:</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>                    df_name <span class="op">=</span> <span class="ss">f"df_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">globals</span>()[df_name] <span class="op">=</span> pd.read_csv(file_path, encoding<span class="op">=</span>encoding)</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Successfully loaded </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss"> as </span><span class="sc">{</span>df_name<span class="sc">}</span><span class="ss"> using </span><span class="sc">{</span>encoding<span class="sc">}</span><span class="ss"> encoding."</span>)</span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span>  <span class="co"># Exit the loop if successfully loaded</span></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Failed to load </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss"> with </span><span class="sc">{</span>encoding<span class="sc">}</span><span class="ss"> encoding. Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Failed to load 104年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 104年12月臺南市統計區人口統計_最小統計區.csv as df_2015 using big5 encoding.
Failed to load 105年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 105年12月臺南市統計區人口統計_最小統計區.csv as df_2016 using big5 encoding.
Successfully loaded 106年12月臺南市統計區人口統計_最小統計區.csv as df_2017 using utf-8 encoding.
Failed to load 107年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 107年12月臺南市統計區人口統計_最小統計區.csv as df_2018 using big5 encoding.
Failed to load 108年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 108年12月臺南市統計區人口統計_最小統計區.csv as df_2019 using big5 encoding.
Failed to load 109年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 109年12月臺南市統計區人口統計_最小統計區.csv as df_2020 using big5 encoding.
Failed to load 110年12月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 110年12月臺南市統計區人口統計_最小統計區.csv as df_2021 using big5 encoding.
Failed to load 111年6月臺南市統計區人口統計_最小統計區.csv with utf-8 encoding. Error: 'utf-8' codec can't decode byte 0xa4 in position 0: invalid start byte
Successfully loaded 111年6月臺南市統計區人口統計_最小統計區.csv as df_2022 using big5 encoding.
Successfully loaded 112年12月臺南市統計區人口統計_最小統計區.csv as df_2023 using utf-8 encoding.</code></pre>
</div>
</div>
<div id="cell-80" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> <span class="bu">range</span>(<span class="dv">2015</span>, <span class="dv">2024</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each year to calculate infections, population, and incidence rates</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> years:</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tally infections by CODEBASE</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    dengue_year <span class="op">=</span> filtered_tn_dengue[filtered_tn_dengue[<span class="st">'Year'</span>] <span class="op">==</span> year]</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>    infections <span class="op">=</span> dengue_year.groupby(<span class="st">'CODEBASE'</span>).size().reset_index(name<span class="op">=</span><span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get population data</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>    population <span class="op">=</span> <span class="bu">eval</span>(<span class="ss">f"df_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">[['CODEBASE', 'P_CNT']]"</span>).rename(columns<span class="op">=</span>{<span class="st">'P_CNT'</span>: <span class="ss">f'Pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>})</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge infection and population data</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>    incidence <span class="op">=</span> pd.merge(infections, population, on<span class="op">=</span><span class="st">'CODEBASE'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure columns are numeric</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>    incidence[<span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> pd.to_numeric(incidence[<span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>    incidence[<span class="ss">f'Pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> pd.to_numeric(incidence[<span class="ss">f'Pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate incidence rate</span></span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>    incidence[<span class="ss">f'IR_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> (incidence[<span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>] <span class="op">/</span> incidence[<span class="ss">f'Pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>]) <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge infection count, population, and incidence rate data into the main shapefile DataFrame</span></span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>    filtered_tn_shp <span class="op">=</span> pd.merge(filtered_tn_shp, incidence[[<span class="st">'CODEBASE'</span>, <span class="ss">f'Inf_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>, <span class="ss">f'Pop_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>, <span class="ss">f'IR_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>]], on<span class="op">=</span><span class="st">'CODEBASE'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Now filtered_tn_shp contains infections, population, and incidence rates from 2015 to 2023 for all CODEBASEs</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg ansi-bold">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg ansi-bold">In[25], line 6</span>
<span class="ansi-green-fg">      3</span> <span style="font-style:italic;color:rgb(95,135,135)"># Loop through each year to calculate infections, population, and incidence rates</span>
<span class="ansi-green-fg">      4</span> <span style="font-weight:bold;color:rgb(0,135,0)">for</span> year <span style="font-weight:bold;color:rgb(175,0,255)">in</span> years:
<span class="ansi-green-fg">      5</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Tally infections by CODEBASE</span>
<span class="ansi-green-fg ansi-bold">----&gt; 6</span>     dengue_year <span style="color:rgb(98,98,98)">=</span> filtered_tn_dengue[filtered_tn_dengue[<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">Year</span><span style="color:rgb(175,0,0)">'</span>] <span style="color:rgb(98,98,98)">==</span> year]
<span class="ansi-green-fg">      7</span>     infections <span style="color:rgb(98,98,98)">=</span> dengue_year<span style="color:rgb(98,98,98)">.</span>groupby(<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">CODEBASE</span><span style="color:rgb(175,0,0)">'</span>)<span style="color:rgb(98,98,98)">.</span>size()<span style="color:rgb(98,98,98)">.</span>reset_index(name<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">Inf_</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>year<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">'</span>)
<span class="ansi-green-fg">      9</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Get population data</span>

<span class="ansi-red-fg ansi-bold">NameError</span>: name 'filtered_tn_dengue' is not defined</pre>
</div>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>